<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeHub v6 - Integrated Terminal</title>
    
    <!-- Memuat Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Memuat Font Awesome untuk ikon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Memuat Chart.js untuk grafik -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Memuat jsPDF & AutoTable untuk ekspor PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <!-- Memuat html2canvas untuk konversi HTML ke gambar (diperlukan untuk PDF) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Memuat PDF.js & JSZip untuk fitur ekspor gambar dan backup ZIP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>

    <!-- Gaya Kustom -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Alfa+Slab+One&family=Anton&family=Bebas+Neue&family=Bitter&family=Caveat&family=Cormorant+Garamond&family=Dancing+Script&family=EB+Garamond&family=Fira+Code&family=Indie+Flower&family=Inconsolata&family=JetBrains+Mono&family=Lato&family=Lobster&family=Lora&family=Merriweather&family=Montserrat&family=Nunito+Sans&family=Open+Sans&family=Orbitron&family=Oswald&family=Pacifico&family=Playfair+Display&family=Poppins&family=Raleway&family=Roboto&family=Shadows+Into+Light+Two&family=Source+Code+Pro&family=Space+Mono&family=Ubuntu&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap');
        
        :root {
            /* [DEFAULT] Dark Purple Theme */
            --bg-gradient: linear-gradient(135deg, #0F0A20, #1A1033, #2E0B4D, #4A148C);
            --text-primary: #e5e7eb;
            --text-secondary: #9ca3af;
            --card-bg: rgba(15, 10, 32, 0.4);
            --card-border: rgba(255, 255, 255, 0.05);
            --sidebar-bg: rgba(26, 16, 51, 0.8);
            --sidebar-border: rgba(192, 132, 252, 0.1);
            --input-bg: rgba(15, 10, 32, 0.5);
            --input-border: rgba(192, 132, 252, 0.2);
            --input-focus-border: #c084fc;
            --active-nav-bg: rgba(192, 132, 252, 0.2);
            --active-nav-border: #c084fc;
            --hover-nav-bg: rgba(192, 132, 252, 0.1);
            --hover-nav-border: #a855f7;
            --primary-brand: #c084fc;
            --danger-brand: #f472b6;
            --button-bg: linear-gradient(90deg, #9333ea, #7e22ce);
            --button-shadow: 0 4px 15px rgba(147, 51, 234, 0.3);
            --tab-active-bg: rgba(192, 132, 252, 0.2);
            --tab-active-border: #c084fc;
            --tab-hover-bg: rgba(192, 132, 252, 0.1);
        }

        body.light-mode {
            /* Light Theme */
            --bg-gradient: linear-gradient(135deg, #f3e8ff, #faf5ff, #f5f3ff);
            --text-primary: #1f2937;
            --text-secondary: #4b5563;
            --card-bg: rgba(255, 255, 255, 0.8);
            --card-border: rgba(0, 0, 0, 0.1);
            --sidebar-bg: #ffffff;
            --sidebar-border: #e5e7eb;
            --input-bg: #f9fafb;
            --input-border: #d1d5db;
            --input-focus-border: #9333ea;
            --active-nav-bg: rgba(147, 51, 234, 0.1);
            --active-nav-border: #9333ea;
            --hover-nav-bg: rgba(147, 51, 234, 0.05);
            --hover-nav-border: #a855f7;
            --primary-brand: #9333ea;
            --danger-brand: #ec4899;
        }

        body.black-mode {
            --bg-gradient: linear-gradient(135deg, #111, #000);
            --text-primary: #e5e7eb;
            --text-secondary: #9ca3af;
            --card-bg: rgba(20, 20, 20, 0.6);
            --card-border: rgba(255, 255, 255, 0.1);
            --sidebar-bg: rgba(10, 10, 10, 0.85);
            --sidebar-border: rgba(255, 255, 255, 0.1);
            --input-bg: rgba(25, 25, 25, 0.7);
            --input-border: rgba(255, 255, 255, 0.15);
            --input-focus-border: #00f0ff; /* Cyan glow */
            --active-nav-bg: rgba(0, 240, 255, 0.15);
            --active-nav-border: #00f0ff;
            --hover-nav-bg: rgba(0, 240, 255, 0.1);
            --hover-nav-border: #00f0ff;
            --primary-brand: #00f0ff; /* Cyan as primary brand */
            --danger-brand: #ff2a6d; /* Neon Pink for danger */
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-gradient);
            color: var(--text-primary);
            transition: background 0.5s, color 0.5s;
            overflow-x: hidden;
        }

        @keyframes gradientFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .gradient-bg {
            background-size: 400% 400%;
            animation: gradientFlow 15s ease infinite;
        }
        body.light-mode .gradient-bg,
        body.black-mode .gradient-bg {
            animation: none;
        }
        
        .glass-effect {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 12px;
            border: 1px solid var(--card-border);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        body.light-mode .glass-effect {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .glass-effect:hover {
            border-color: rgba(192, 132, 252, 0.2);
        }
        .black-mode .glass-effect:hover {
            border-color: var(--hover-nav-border);
        }

        .custom-input, .custom-select, .code-textarea {
            background-color: var(--input-bg);
            border: 1px solid var(--input-border);
            color: var(--text-primary);
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            width: 100%;
            transition: all 0.3s ease;
        }
        .custom-input:focus, .custom-select:focus, .code-textarea:focus {
            outline: none;
            border-color: var(--input-focus-border);
            box-shadow: 0 0 10px var(--input-focus-border, 0.3);
        }
        .custom-input::placeholder {
            color: var(--text-secondary);
        }

        .custom-button {
            background: var(--button-bg);
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: var(--button-shadow);
            border: none;
            cursor: pointer;
        }
        .custom-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(147, 51, 234, 0.5);
        }
        .custom-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .custom-button-danger {
            background: linear-gradient(90deg, #ef4444, #dc2626);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }
        .custom-button-danger:hover:not(:disabled) {
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.5);
        }
        .custom-button-secondary {
            background: linear-gradient(90deg, #374151, #1f2937);
            box-shadow: 0 4px 15px rgba(55, 65, 81, 0.3);
        }
        .custom-button-secondary:hover:not(:disabled) {
            box-shadow: 0 6px 20px rgba(55, 65, 81, 0.5);
        }

        .black-mode .custom-button {
            background: linear-gradient(90deg, #00c3ff, #008cff);
            box-shadow: 0 4px 15px rgba(0, 200, 255, 0.3);
        }
        .black-mode .custom-button:hover:not(:disabled) {
            box-shadow: 0 6px 20px rgba(0, 200, 255, 0.5);
        }
        .black-mode .custom-button-danger {
            background: linear-gradient(90deg, #ff4d4d, #ff0000);
            box-shadow: 0 4px 15px rgba(255, 0, 0, 0.3);
        }
        .black-mode .custom-button-danger:hover:not(:disabled) {
            box-shadow: 0 6px 20px rgba(255, 0, 0, 0.5);
        }

        .nav-item {
            transition: all 0.3s ease;  
            cursor: pointer;  
            padding: 0.75rem 1rem;
            margin: 0.25rem 0;  
            border-radius: 0.5rem;  
            border-left: 3px solid transparent;
        }
        .nav-item:hover {  
            background-color: var(--hover-nav-bg);  
            border-left-color: var(--hover-nav-border);  
        }
        .nav-item.active {  
            background-color: var(--active-nav-bg);  
            border-left-color: var(--active-nav-border);  
            color: var(--primary-brand);  
            font-weight: 500;
        }
        body.light-mode .nav-item.active {
            color: var(--primary-brand);
        }

        .black-mode h1,
        .black-mode h2,
        .black-mode h3,
        .black-mode .font-bold,
        .black-mode .nav-item.active {
            text-shadow: 0 0 8px rgba(0, 240, 255, 0.4);
        }
        .black-mode #logo-icon {
            background: linear-gradient(to br, #00f0ff, #00a2ff);
        }
        .black-mode #logo-icon i {
            color: #002d3c;
        }
        .black-mode h1.text-purple-300,
        .black-mode h2.text-purple-300,
        .black-mode h3.text-purple-300,
        .black-mode .text-purple-300,
        .black-mode .text-purple-400 {
            color: var(--primary-brand);
        }
        .black-mode .text-pink-400 {
            color: #ff80c0;
        }
        .black-mode .text-blue-400 {
            color: #80bfff;
        }


        .modal {  
            display: none;  
            position: fixed;  
            top: 0;  
            left: 0;  
            width: 100%;  
            height: 100%;  
            background-color: rgba(0, 0, 0, 0.7);  
            backdrop-filter: blur(5px);
            z-index: 1000;  
            animation: fadeIn 0.3s ease;  
        }
        .modal.show {  
            display: flex;  
            align-items: center;  
            justify-content: center;  
        }
        .modal-content {
            max-width: 90vw;  
            max-height: 90vh;  
            overflow-y: auto;  
            animation: modalAppear 0.5s;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes modalAppear { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        
        .income { border-left: 4px solid #4ade80; }
        .expense { border-left: 4px solid #f472b6; }
        
        .task-item.completed { opacity: 0.6; text-decoration: line-through; }

        .hidden { display: none !important; }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            height: 100vh;  
            overflow-y: auto;  
            position: fixed;  
            left: -250px;  
            top: 0;  
            width: 250px;
            background-color: var(--sidebar-bg);
            backdrop-filter: blur(10px);
            border-right: 1px solid var(--sidebar-border);  
            z-index: 100;  
            transition: left 0.3s ease, opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        .sidebar.open { left: 0; }
        
        .overlay {  
            display: none;  
            position: fixed;  
            top: 0;  
            left: 0;  
            width: 100%;  
            height: 100%;  
            background-color: rgba(0, 0, 0, 0.5);  
            z-index: 99;  
        }
        .overlay.show { display: block; }
        
        .main-content {  
            flex-grow: 1;
            width: 100%;
            transition: margin-left 0.3s ease;  
        }
        
        .main-content > .p-6 {
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        
        @media (min-width: 768px) {  
            .sidebar {  
                position: relative;
                left: 0;  
                flex-shrink: 0;
                height: auto; 
            }
            .main-content {
                width: calc(100% - 250px);
            }
            #mobileMenuBtn, .overlay, .main-header {
                display: none;
            }
        }
        
        @media (max-width: 767px) {
            .app-container {
                display: block;
            }
             .main-content {
                padding-top: 70px;
            }
        }

        #bg-video, #bg-image-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -2;
            display: none;
        }
        #bg-image-layer {
            background-size: cover;
            background-position: center;
        }

        #mobileMenuBtn {
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }

        body.preview-mode .sidebar,
        body.preview-mode .main-content > .p-6,
        body.preview-mode #mobileMenuBtn,
        body.preview-mode .main-header {
            opacity: 0;
            transform: translateY(15px);
            pointer-events: none;
        }

        .range-btn {
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            color: var(--text-secondary);
        }
        .range-btn:hover {
            background-color: var(--hover-nav-bg);
            color: var(--text-primary);
        }
        .range-btn.active {
            background-color: var(--primary-brand);
            color: white;
            box-shadow: 0 2px 10px rgba(192, 132, 252, 0.4);
        }
        body.light-mode .range-btn.active,
        body.black-mode .range-btn.active {
            color: white;
        }
        body.black-mode .range-btn.active {
             box-shadow: 0 2px 10px rgba(0, 240, 255, 0.4);
        }


        .chart-container {
            height: 350px;
            position: relative;
        }

        #notes-section .notes-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .note-item {
            border: 1px solid var(--card-border);
            transition: background-color 0.3s ease;
        }
        .note-item:hover {
            background-color: var(--hover-nav-bg);
        }
        .tag {
            background-color: var(--primary-brand);
            color: white;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-weight: 600;
        }

        #hack-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 9999;
            display: none;
            color: #0f0;
            font-family: 'Fira Code', monospace;
            padding: 2rem;
            overflow: hidden;
        }
        .hack-text {
            white-space: pre-wrap;
            font-size: 1.1rem;
            line-height: 1.5;
            text-shadow: 0 0 5px #0f0;
        }
        .hack-text.glitch {
            animation: glitch 0.1s infinite;
        }
        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }
        .typewriter-cursor {
            display: inline-block;
            background-color: #0f0;
            width: 10px;
            height: 1.2em;
            animation: blink 1s step-end infinite;
            margin-left: 5px;
        }
        @keyframes blink {
            from, to { background-color: transparent; }
            50% { background-color: #0f0; }
        }

        .sidebar-portal-item {
            display: flex;
            align-items: center;
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            text-decoration: none;
            color: var(--text-secondary);
            background-color: transparent;
            border: 1px solid transparent;
        }

        .sidebar-portal-item:hover {
            background-color: var(--hover-nav-bg);
            color: var(--text-primary);
            border-color: var(--hover-nav-border);
        }

        .sidebar-portal-item .portal-icon {
            width: 1.5rem;
            height: 1.5rem;
            margin-right: 0.75rem;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .sidebar-portal-item .portal-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 4px;
        }

        .sidebar-portal-item .portal-name {
            flex-grow: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 0.875rem;
        }

        .sidebar-portal-item .delete-portal-btn {
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
            margin-left: 0.5rem;
            color: var(--danger-brand);
        }

        .sidebar-portal-item:hover .delete-portal-btn {
            opacity: 1;
        }

        .portal-modal-label {
            color: var(--primary-brand);
            text-shadow: 0 0 5px var(--primary-brand);
        }
        .portal-color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-block;
            margin: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border: 2px solid transparent;
        }
        .portal-color-option:hover {
            transform: scale(1.1);
        }
        .portal-color-option.selected {
            border-color: var(--primary-brand);
            transform: scale(1.1);
        }
        .portal-color-option.selected::after {
            content: "âœ“";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #000;
            font-weight: bold;
            font-size: 16px;
            text-shadow: 0 0 2px white;
        }
        .portal-custom-color-input {
            width: 100%;
            height: 40px;
            border: none;
            background: transparent;
            cursor: pointer;
            padding: 0;
        }
        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        input[type="color"]::-webkit-color-swatch {
            border: none;
            border-radius: 8px;
        }

        #avatar-container {
            background-image: url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?q=80&w=2071&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            position: relative;
            box-shadow: 0 0 15px rgba(192, 132, 252, 0.4);
        }
        #user-picture {
            object-fit: cover;
        }

        #user-email {
            transition: filter 0.3s ease-in-out;
        }
        .email-blur {
            filter: blur(5px);
            user-select: none;
        }

        .pro-editor-container {
            position: relative;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--input-border);
            border-radius: 0.5rem;
            background-color: var(--input-bg);
            transition: all 0.3s ease;
        }
        .pro-editor-container:focus-within {
            border-color: var(--input-focus-border);
            box-shadow: 0 0 10px var(--input-focus-border, 0.3);
        }

        #editor-master-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            color: var(--text-secondary);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        #editor-master-btn:hover {
            color: var(--primary-brand);
            border-color: var(--primary-brand);
            transform: scale(1.1);
        }

        .pro-toolbar {
            display: none;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            border-bottom: 1px solid var(--input-border);
            background-color: var(--sidebar-bg);
            border-radius: 0.5rem 0.5rem 0 0;
        }
        .pro-toolbar.visible {
            display: flex;
        }

        .pro-toolbar-group {
            display: flex;
            align-items: center;
            gap: 0.2rem;
            padding: 0 0.5rem;
            border-right: 1px solid var(--input-border);
        }
        .pro-toolbar-group:last-child {
            border-right: none;
        }
        @media (max-width: 768px) {
            .pro-toolbar-group {
                border-right: none;
                padding: 0.25rem;
                background: rgba(0,0,0,0.1);
                border-radius: 6px;
            }
        }


        .pro-toolbar-button, .pro-toolbar-select, .pro-toolbar-color-wrapper {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            min-width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0 0.5rem;
            font-size: 0.9rem;
        }
        .pro-toolbar-button:hover, .pro-toolbar-select:hover {
            background-color: var(--hover-nav-bg);
            color: var(--text-primary);
        }
        .pro-toolbar-button.active {
            background-color: var(--active-nav-bg);
            color: var(--primary-brand);
        }
        .pro-toolbar-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%239ca3af' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.25rem center;
            background-repeat: no-repeat;
            background-size: 1.25em 1.25em;
            padding-right: 1.5rem;
        }
        .pro-toolbar-color-wrapper {
            position: relative;
            padding: 0;
        }
        .pro-toolbar-color-wrapper input[type="color"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        .paste-dropdown-container {
            position: relative;
            display: flex;
            align-items: center;
        }
        .paste-dropdown-menu {
            display: none;
            position: absolute;
            top: 110%;
            left: 0;
            z-index: 20;
            background-color: var(--sidebar-bg);
            border: 1px solid var(--card-border);
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            padding: 0.5rem;
            width: max-content;
        }
        .paste-dropdown-container:hover .paste-dropdown-menu {
            display: block;
        }
        .paste-dropdown-menu button {
            display: block;
            width: 100%;
            text-align: left;
            padding: 0.5rem 0.75rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 0.8rem;
            border-radius: 4px;
            cursor: pointer;
        }
        .paste-dropdown-menu button:hover {
            background-color: var(--hover-nav-bg);
            color: var(--text-primary);
        }

        .pro-editor-content {
            min-height: 400px;
            max-height: 65vh;
            padding: 1.5rem;
            overflow-y: auto;
            outline: none;
            color: var(--text-primary);
            line-height: 1.7;
            caret-color: var(--primary-brand);
        }
        .pro-editor-content[contenteditable="true"]:empty:before {
            content: attr(placeholder);
            color: var(--text-secondary);
            pointer-events: none;
            display: block;
        }
        .pro-editor-content h1, .pro-editor-content h2, .pro-editor-content h3 { border-bottom: 1px solid var(--input-border); padding-bottom: 0.3em; margin-bottom: 0.5em; }
        .pro-editor-content blockquote { border-left: 3px solid var(--primary-brand); margin-left: 0; padding-left: 1rem; color: var(--text-secondary); font-style: italic; }
        .pro-editor-content code { background: var(--card-bg); padding: 0.2em 0.4em; border-radius: 4px; font-family: 'Fira Code', monospace; font-size: 0.9em; }
        .pro-editor-content pre { background: #000; color: #f8f8f2; padding: 1rem; border-radius: 0.5rem; white-space: pre-wrap; font-family: 'Fira Code', monospace; }
        .pro-editor-content table { width: 100%; border-collapse: collapse; }
        .pro-editor-content th, .pro-editor-content td { border: 1px solid var(--input-border); padding: 0.5rem; }
        .pro-editor-content th { background-color: var(--card-bg); }
        .pro-editor-content img, .pro-editor-content video { max-width: 100%; height: auto; border-radius: 8px; }
        .pro-editor-content .embedded-zip {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: 0.5rem;
            background-color: var(--input-bg);
            border: 1px solid var(--input-border);
            margin: 1rem 0;
            cursor: default;
        }
        .pro-editor-content .embedded-zip i {
            font-size: 2.5rem;
            color: var(--primary-brand);
        }
        .pro-editor-content .zip-info {
            flex-grow: 1;
        }
        .pro-editor-content .zip-name {
            font-weight: 600;
            color: var(--text-primary);
        }
        .pro-editor-content .zip-details {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }


        .pro-editor-statusbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
            border-top: 1px solid var(--input-border);
            background-color: var(--sidebar-bg);
            border-radius: 0 0 0.5rem 0.5rem;
            flex-wrap: wrap;
        }
        .pro-statusbar-segment {
            cursor: default;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        .pro-statusbar-segment:hover {
            background-color: var(--hover-nav-bg);
        }
        .pro-statusbar-segment i {
            margin-right: 0.5em;
        }
        
        .upload-progress-item {
            background-color: var(--input-bg);
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid var(--input-border);
        }
        .upload-progress-bar-bg {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 9999px;
            overflow: hidden;
            height: 6px;
        }
        .upload-progress-bar-fg {
            background: linear-gradient(90deg, #9333ea, #7e22ce);
            height: 100%;
            border-radius: 9999px;
            transition: width 0.3s ease;
        }
        .black-mode .upload-progress-bar-fg {
            background: linear-gradient(90deg, #00c3ff, #008cff);
        }

        #filePreviewModal .modal-content {
            height: 90vh;
            width: 90vw;
            max-width: 1200px;
        }
        #preview-content-container {
            position: relative;
        }
        #preview-content-container img,
        #preview-content-container video,
        #preview-content-container iframe,
        #preview-content-container canvas {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            display: block;
            margin: auto;
        }
        #preview-content-container iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: #fff; /* Latar belakang untuk dokumen */
        }
        #preview-content-container pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--text-primary);
            background-color: var(--input-bg);
            padding: 1rem;
            border-radius: 0.5rem;
            height: 100%;
            width: 100%;
            overflow-y: auto;
            font-family: 'Fira Code', monospace;
        }
        
        /* Gaya untuk Editor HTML yang Diperbarui */
        .code-textarea {
            font-family: 'Fira Code', 'JetBrains Mono', monospace;
            min-height: 300px;
            height: 55vh; /* Tinggi yang disesuaikan */
            resize: vertical;
            line-height: 1.6;
            font-size: 14px;
        }
        .tab-btn {
            padding: 0.5rem 1rem;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 6px 6px 0 0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: var(--text-secondary);
            background-color: transparent;
        }
        .tab-btn:hover {
            background-color: var(--tab-hover-bg);
        }
        .tab-btn.active {
            color: var(--primary-brand);
            border-color: var(--input-border);
            background-color: var(--input-bg);
        }
        #html-preview-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background-color: white;
            border-radius: 0.5rem;
        }
        #preview-panel {
            position: relative;
        }
        #preview-controls {
            position: absolute;
            top: 1rem;
            right: 1rem;
            z-index: 10;
            display: flex;
            gap: 0.5rem;
        }
        .control-btn {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .control-btn:hover {
            color: var(--primary-brand);
            border-color: var(--primary-brand);
        }
        .html-note-item {
            border: 1px solid var(--card-border);
            transition: background-color 0.3s ease;
        }
        .html-note-item:hover {
            background-color: var(--hover-nav-bg);
        }
        .html-note-item.active {
            background-color: var(--active-nav-bg);
            border-left: 3px solid var(--active-nav-border);
        }

        #html-editor-toolbar {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border-bottom: 1px solid var(--input-border);
        }
        .toolbar-group {
            display: flex;
            align-items: center;
            gap: 0.2rem;
            padding: 0 0.5rem;
        }
        .toolbar-separator {
            width: 1px;
            height: 20px;
            background-color: var(--input-border);
            margin: 0 0.5rem;
        }
        .toolbar-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .toolbar-btn:hover:not(:disabled) {
            background-color: var(--hover-nav-bg);
            color: var(--text-primary);
        }
        .toolbar-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        .toolbar-search-wrapper {
            position: relative;
            display: none;
        }
        .toolbar-search-wrapper input {
            background-color: var(--input-bg);
            border: 1px solid var(--input-border);
            color: var(--text-primary);
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            width: 150px;
            font-size: 0.875rem;
        }

        /* --- WATERMARK CSS START --- */
         :root {
            --glow-color: hsl(186, 100%, 50%);
            --background-color: rgba(10, 25, 40, 0.85);
            --border-color: rgba(127, 255, 212, 0.3);
            --text-color: rgba(230, 255, 255, 0.95);
            --particle-base-hue: 186;
            --particle-base-lightness: 60;
         }

         @keyframes slideUpFadeIn {
             from { opacity: 0; transform: translateY(15px); }
             to { opacity: 1; transform: translateY(0); }
         }

         @keyframes logo3DFlip {
             0% { transform: rotateY(0deg); filter: brightness(1); }
             50% { transform: rotateY(180deg); filter: brightness(2) drop-shadow(0 0 8px var(--glow-color)); }
             100% { transform: rotateY(360deg); filter: brightness(1); }
         }
        
         #futuristic-watermark {
             position: fixed;
             bottom: 25px;
             left: 25px;
             padding: 8px 15px;
             min-width: 212px;
             background: var(--background-color);
             color: var(--text-color);
             font-family: 'Roboto Mono', monospace;
             font-weight: 500;
             backdrop-filter: blur(18px);
             -webkit-backdrop-filter: blur(18px);
             border: 1px solid var(--border-color);
             border-radius: 10px;
             box-shadow: 0 0 15px rgba(var(--glow-color), 0.15),
                         0 0 30px rgba(var(--glow-color), 0.1),
                         inset 0 0 10px rgba(var(--glow-color), 0.1);
             z-index: 9999;
             cursor: pointer;
             user-select: none;
             overflow: hidden;
             opacity: 0;
             animation: slideUpFadeIn 1s ease-out 0.5s forwards;
             transition: opacity 0.3s ease 0.2s, transform 0.3s ease 0.2s, background-color 0.5s ease, color 0.5s ease, box-shadow 0.3s ease, border-color 0.3s ease;
         }
        
         #futuristic-watermark:hover {
             transform: translateY(-5px) scale(1.03);
             border-color: rgba(127, 255, 212, 0.8);
             box-shadow: 0 0 25px rgba(var(--glow-color), 0.4),
                         0 0 50px rgba(var(--glow-color), 0.25),
                         inset 0 0 12px rgba(var(--glow-color), 0.2);
         }

         #futuristic-watermark.light-mode {
             --glow-color: hsl(220, 90%, 60%);
             --background-color: rgba(245, 248, 252, 0.85);
             --border-color: rgba(60, 100, 150, 0.3);
             --text-color: rgba(10, 25, 40, 0.95);
             --particle-base-hue: 220;
             --particle-base-lightness: 40;
         }
        
         #particle-canvas {
             position: absolute;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             z-index: 1;
             pointer-events: none;
         }

         .f-content-wrapper {
             position: relative;
             z-index: 2;
             display: flex;
             align-items: center;
             justify-content: center;
             min-height: 18px;
         }

         .f-content {
             display: flex;
             align-items: center;
             gap: 10px;
             transition: opacity 0.4s ease, transform 0.4s ease;
         }

         .f-content.hidden {
             opacity: 0;
             pointer-events: none;
             position: absolute;
             transform: scale(0.9);
         }

         .f-logo-container {
             width: 18px;
             height: 18px;
             transition: transform 0.4s ease;
             flex-shrink: 0;
         }

         .f-logo-container.reacting {
             animation: logo3DFlip 0.7s cubic-bezier(0.22, 1, 0.36, 1);
         }
        
         .f-logo-container svg {
              width: 100%;
              height: 100%;
              stroke: var(--glow-color);
              stroke-width: 8;
              transition: stroke 0.5s ease;
         }
        
         #f-watermark-text, #f-follow-message {
              transition: color 0.5s ease;
         }

         #f-watermark-text {
              font-size: 12px;
              letter-spacing: 1px;
              text-transform: uppercase;
         }
        
         #f-follow-message {
             font-size: 11px;
             letter-spacing: 0.2px;
             font-weight: 700;
             text-align: center;
             white-space: nowrap;
         }
        /* --- WATERMARK CSS END --- */
        
        /* [BARU] Aturan untuk menyembunyikan watermark saat menu mobile terbuka */
        body.sidebar-is-open #futuristic-watermark {
            opacity: 0;
            transform: translateX(-120%); /* Efek geser keluar */
            pointer-events: none;
        }

        /* [BARU] CSS untuk Modal Premium */
        #premiumModalContent {
            animation: bounceIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.5); }
            70% { opacity: 1; transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        #premium-icon {
            animation: gemShine 2s infinite;
        }

        @keyframes gemShine {
            0%, 100% { transform: scale(1); text-shadow: 0 0 10px #facc15; }
            50% { transform: scale(1.1); text-shadow: 0 0 20px #fde047; }
        }

        .glowing-button {
            background: linear-gradient(90deg, #f59e0b, #d97706);
            box-shadow: 0 0 5px #f59e0b, 0 0 15px #f59e0b, 0 0 25px #f59e0b;
            animation: glowPulse 1.5s infinite alternate;
        }

        @keyframes glowPulse {
            from { box-shadow: 0 0 5px #f59e0b, 0 0 15px #f59e0b, 0 0 25px #f59e0b; }
            to { box-shadow: 0 0 10px #fde047, 0 0 30px #fde047, 0 0 50px #fde047; }
        }

    </style>
</head>
<body class="gradient-bg">
    <!-- Elemen untuk background media -->
    <div id="bg-image-layer"></div>
    <video autoplay loop muted id="bg-video"></video>

    <!-- PENAMBAHAN: Overlay untuk Fake Hack Effect -->
    <div id="hack-overlay">
        <pre id="hack-text" class="hack-text"></pre>
    </div>

    <!-- Overlay for mobile -->
    <div id="overlay" class="overlay"></div>

    <div class="app-container">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar">
            <div class="p-6 h-full flex flex-col">
                <!-- Bagian Atas (Logo, Judul, Mode) -->
                <div>
                    <div class="flex items-center justify-between mb-8">
                        <div class="flex items-center space-x-3">
                            <div id="logo-container" class="w-14 h-14 rounded-full flex items-center justify-center cursor-pointer" title="Masuk Mode Pratinjau">
                                <img src="https://i.imghippo.com/files/YXY6439eaY.png" alt="Uranus Space Logo" class="w-full h-full object-cover rounded-full">
                            </div>
                            <h1 class="text-3xl font-bold text-purple-300">Uranus Space</h1>
                        </div>
                        <button id="themeToggle" class="w-10 h-10 rounded-full flex items-center justify-center hover:bg-purple-500/10 text-purple-300" title="Toggle Theme">
                            <i class="fas fa-sun"></i>
                        </button>
                    </div>
                    
                    <div class="mb-6">
                        <label for="modeSelect" class="block text-sm font-medium mb-2 text-purple-300">Mode Terminal</label>
                        <select id="modeSelect" class="custom-input">
                            <option value="personal">Pribadi</option>
                            <option value="business">Bisnis</option>
                        </select>
                    </div>
                    
                    <!-- Navigasi Utama -->
                    <nav>
                        <div class="nav-item active" data-section="dashboard"><i class="fas fa-tachometer-alt mr-3 w-5"></i>Dashboard</div>
                        <div class="nav-item" data-section="finance"><i class="fas fa-wallet mr-3 w-5"></i>Manajemen Keuangan</div>
                        <div class="nav-item" data-section="tasks"><i class="fas fa-tasks mr-3 w-5"></i>Manajemen Waktu</div>
                        <div class="nav-item" data-section="split"><i class="fas fa-receipt mr-3 w-5"></i>Split Bill</div>
                        <div class="nav-item flex justify-between items-center" data-section="notes"><div><i class="fas fa-book mr-3 w-5"></i>Catatan</div><span class="text-xs text-yellow-400">ðŸ”’</span></div>
                        <div class="nav-item flex justify-between items-center" data-section="html-editor"><div><i class="fas fa-code mr-3 w-5"></i>Editor HTML</div><span class="text-xs text-yellow-400">ðŸ”’</span></div>
                        <div class="nav-item" data-section="settings"><i class="fas fa-cog mr-3 w-5"></i>Pengaturan</div>
                    </nav>
                </div>

                <!-- Container untuk Portal di Sidebar -->
                <div class="mt-8 pt-6 border-t border-[var(--sidebar-border)] flex-grow flex flex-col min-h-0">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-purple-300">Portal Tautan <span class="text-xs text-yellow-400">ðŸ”’</span></h3>
                        <button id="addNewPortalBtn" class="custom-button !p-2 !text-xs" title="Tambah Portal Baru">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <!-- Daftar Portal akan dirender di sini oleh JavaScript -->
                    <div id="sidebar-portals-container" class="flex-grow overflow-y-auto pr-2 space-y-2">
                        <!-- Konten portal akan diisi oleh JS -->
                    </div>
                </div>

            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
             <!-- Header baru ditambahkan untuk menampung tombol hamburger dan judul di mobile -->
            <header class="main-header p-4 glass-effect md:hidden fixed top-0 left-0 right-0 z-40">
                <div class="flex items-center justify-between">
                    <button id="mobileMenuBtn" class="custom-button !p-3">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="flex items-center space-x-2">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center">
                             <img src="https://i.imghippo.com/files/YXY6439eaY.png" alt="Uranus Space Logo" class="w-full h-full object-cover rounded-full">
                        </div>
                        <h1 class="text-2xl font-bold text-purple-300">Uranus Space</h1>
                    </div>
                    <!-- Placeholder to balance the flexbox -->
                    <div class="w-12"></div>
                </div>
            </header>

            <div class="p-6 relative z-10">
                <!-- Dashboard Section -->
                <div id="dashboard-section" class="section">
                    <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                        <h2 class="text-3xl font-bold text-purple-300">Dashboard</h2>
                        <div id="master-range-selector" class="flex items-center gap-1 bg-purple-900/30 p-1 rounded-md glass-effect">
                            <button data-range="7d" class="range-btn active" title="7 Hari">7H</button>
                            <button data-range="1m" class="range-btn" title="1 Bulan">1B</button>
                            <button data-range="3m" class="range-btn" title="3 Bulan">3B</button>
                            <button data-range="1y" class="range-btn" title="1 Tahun">1T</button>
                            <button data-range="all" class="range-btn" title="Selamanya">âˆž</button>
                            <button data-range="custom" class="range-btn" title="Pilih Rentang"><i class="fas fa-calendar-alt"></i></button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="glass-effect p-6 text-center"><h3 class="text-lg font-semibold mb-2 text-pink-400">Saldo Total</h3><p class="text-2xl font-bold" id="totalBalance">Rp 0</p></div>
                        <div class="glass-effect p-6 text-center"><h3 class="text-lg font-semibold mb-2 text-pink-400">Tugas Hari Ini</h3><p class="text-2xl font-bold" id="todayTasksCount">0</p></div>
                        <div class="glass-effect p-6 text-center"><h3 class="text-lg font-semibold mb-2 text-pink-400">Tugas Tertunda</h3><p class="text-2xl font-bold" id="pendingTasks">0</p></div>
                        <div class="glass-effect p-6 text-center"><h3 class="text-lg font-semibold mb-2 text-pink-400">Mode Aktif</h3><p class="text-2xl font-bold" id="activeMode">Pribadi</p></div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="glass-effect p-6">
                            <h3 class="text-xl font-semibold text-blue-400 mb-4">Arus Kas</h3>
                            <canvas id="cashFlowChart"></canvas>
                        </div>
                        <div class="glass-effect p-6">
                            <h3 class="text-xl font-semibold text-pink-400 mb-4">Produktivitas</h3>
                            <canvas id="productivityChart"></canvas>
                        </div>
                    </div>

                    <div class="glass-effect p-6 mb-8">
                        <h3 class="text-xl font-semibold mb-4 text-blue-400">Aktivitas Terkini</h3>
                        <div id="recentActivities" class="space-y-2"></div>
                    </div>

                    <h2 class="text-3xl font-bold mb-6 mt-10 text-purple-300">Analisis Mendalam</h2>
                    <div class="grid grid-cols-1 gap-6">
                        <div class="glass-effect p-6">
                            <h3 class="text-xl font-semibold mb-4 text-purple-400">Analisis Gabungan Fitur</h3>
                            <div class="chart-container" style="height: 450px;">
                                <canvas id="combinedAnalysisChart"></canvas>
                            </div>
                        </div>

                        <div class="glass-effect p-6">
                            <h3 class="text-xl font-semibold mb-4 text-blue-400">Analisis Keuangan</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="md:col-span-2">
                                    <p class="text-md font-medium text-purple-300 mb-2">Pemasukan vs Pengeluaran</p>
                                    <div class="chart-container h-64">
                                        <canvas id="incomeVsExpenseChart"></canvas>
                                    </div>
                                </div>
                                <div>
                                     <p class="text-md font-medium text-purple-300 mb-2">Alokasi Pengeluaran</p>
                                    <div class="chart-container h-64">
                                        <canvas id="spendingByCategoryChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="glass-effect p-6">
                             <h3 class="text-xl font-semibold mb-4 text-pink-400">Analisis Produktivitas</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="md:col-span-2">
                                    <p class="text-md font-medium text-purple-300 mb-2">Tren Penyelesaian Tugas</p>
                                    <div class="chart-container h-64">
                                        <canvas id="taskCompletionTrendChart"></canvas>
                                    </div>
                                </div>
                                <div>
                                    <p class="text-md font-medium text-purple-300 mb-2">Distribusi Prioritas Tugas</p>
                                    <div class="chart-container h-64">
                                        <canvas id="taskPriorityDistributionChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="glass-effect p-6">
                            <h3 class="text-xl font-semibold mb-4 text-green-400">Analisis Split Bill</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <p class="text-md font-medium text-purple-300 mb-2">Total Pengeluaran per Orang</p>
                                    <div class="chart-container h-64">
                                        <canvas id="splitBillByUserChart"></canvas>
                                    </div>
                                </div>
                                <div>
                                    <p class="text-md font-medium text-purple-300 mb-2">Frekuensi Split Bill</p>
                                    <div class="chart-container h-64">
                                        <canvas id="splitBillFrequencyChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="glass-effect p-6">
                            <h3 class="text-xl font-semibold mb-4 text-blue-400">Analisis Catatan</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <p class="text-md font-medium text-purple-300 mb-2 text-center">Frekuensi Entri Catatan</p>
                                    <div class="chart-container h-64">
                                        <canvas id="diaryEntryFrequencyChart"></canvas>
                                    </div>
                                </div>
                                <div>
                                    <p class="text-md font-medium text-purple-300 mb-2 text-center">Analisis Mood</p>
                                    <div class="chart-container h-64">
                                        <canvas id="noteMoodAnalysisChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Finance Section -->
                <div id="finance-section" class="section hidden">
                    <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                        <h2 class="text-3xl font-bold text-purple-300">Manajemen Keuangan</h2>
                        <div class="flex gap-2">
                            <button id="addTransactionBtn" class="custom-button"><i class="fas fa-plus mr-2"></i>Tambah</button>
                            <button id="exportFinanceBtn" class="custom-button" style="background: linear-gradient(90deg, #10b981, #059669);"><i class="fas fa-file-pdf mr-2"></i>Laporan</button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="glass-effect p-6 text-center"><h3 class="text-lg font-semibold text-green-400 mb-2">Pemasukan</h3><p class="text-2xl font-bold" id="totalIncome">Rp 0</p></div>
                        <div class="glass-effect p-6 text-center"><h3 class="text-lg font-semibold text-pink-400 mb-2">Pengeluaran</h3><p class="text-2xl font-bold" id="totalExpense">Rp 0</p></div>
                        <div class="glass-effect p-6 text-center"><h3 class="text-lg font-semibold text-blue-400 mb-2">Saldo</h3><p class="text-2xl font-bold" id="balance">Rp 0</p></div>
                    </div>

                    <div class="glass-effect p-4 mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-center">
                            <input type="text" id="searchTransaction" placeholder="Cari transaksi..." class="custom-input md:col-span-2">
                            <select id="categoryFilter" class="custom-input"></select>
                            <select id="typeFilter" class="custom-input"></select>
                            <button id="financeDateFilterBtn" class="custom-button"><i class="fas fa-calendar-alt mr-2"></i>Filter Tanggal</button>
                        </div>
                    </div>

                    <div class="glass-effect p-6">
                        <h3 class="text-xl font-semibold mb-4 text-pink-400">Daftar Transaksi</h3>
                        <div id="transactionsList" class="space-y-2"></div>
                    </div>
                </div>
                
                <!-- Tasks & Plans Section -->
                <div id="tasks-section" class="section hidden">
                    <h2 class="text-3xl font-bold mb-6 text-purple-300">Manajemen Waktu</h2>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-1 space-y-6">
                            <div class="glass-effect p-6">
                                <h3 class="text-xl font-semibold mb-4 text-blue-400">Tambah Tugas</h3>
                                <form id="taskForm" class="space-y-4">
                                    <div><label class="block text-sm font-medium mb-1">Tugas</label><input type="text" id="taskTitle" class="custom-input" required></div>
                                    <div><label class="block text-sm font-medium mb-1">Tanggal & Waktu</label><input type="datetime-local" id="taskDateTime" class="custom-input" required></div>
                                    <div><label class="block text-sm font-medium mb-1">Prioritas</label><select id="taskPriority" class="custom-input"><option value="low">Rendah</option><option value="medium">Sedang</option><option value="high">Tinggi</option></select></div>
                                    <button type="submit" class="custom-button w-full">Tambah Tugas</button>
                                </form>
                            </div>
                            <div class="glass-effect p-6 text-center">
                                <h3 class="text-xl font-semibold mb-4 text-pink-400">Pomodoro Timer</h3>
                                <div id="timerDisplay" class="text-5xl font-mono my-4">25:00</div>
                                <div class="flex gap-2 justify-center">
                                    <button id="startTimerBtn" class="custom-button bg-green-600 hover:bg-green-500"><i class="fas fa-play"></i></button>
                                    <button id="pauseTimerBtn" class="custom-button bg-yellow-600 hover:bg-yellow-500"><i class="fas fa-pause"></i></button>
                                    <button id="resetTimerBtn" class="custom-button custom-button-danger"><i class="fas fa-sync"></i></button>
                                </div>
                            </div>
                        </div>
                        <div class="lg:col-span-2 space-y-6">
                            <div class="glass-effect p-6">
                                 <h3 class="text-xl font-semibold mb-4 text-blue-400">Daftar Tugas</h3>
                                 <div id="taskList" class="space-y-3 max-h-96 overflow-y-auto"></div>
                            </div>
                            <div class="glass-effect p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <button id="prevMonth" class="custom-button !p-3"><i class="fas fa-chevron-left"></i></button>
                                    <span id="currentMonth" class="text-xl font-semibold text-pink-400"></span>
                                    <button id="nextMonth" class="custom-button !p-3"><i class="fas fa-chevron-right"></i></button>
                                </div>
                                <div id="calendar" class="grid grid-cols-7 gap-1"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Split Bill Section -->
                <div id="split-section" class="section hidden">
                    <h2 class="text-3xl font-bold mb-6 text-purple-300">Split Bill</h2>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <div class="glass-effect p-6 mb-6">
                                <h3 class="text-xl font-semibold mb-4 text-blue-400">Kalkulator Bill</h3>
                                <form id="splitBillForm" class="space-y-4">
                                    <div><label class="block text-sm font-medium mb-1">Total Tagihan</label><input type="number" id="totalBill" class="custom-input" required></div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1">Tanggal</label>
                                        <input type="date" id="splitBillDate" class="custom-input" required>
                                    </div>
                                    <div><label class="block text-sm font-medium mb-1">Nama (pisahkan koma)</label><input type="text" id="peopleNames" class="custom-input" placeholder="Zedd, Jett, Omen" required></div>
                                    <div>
                                        <label class="block text-sm font-medium mb-1">Persentase (opsional, pisahkan koma)</label>
                                        <input type="text" id="splitPercentages" class="custom-input" placeholder="25, 75">
                                        <p class="text-xs text-gray-400 mt-1">Kosongkan untuk membagi rata.</p>
                                    </div>
                                    <button type="submit" class="custom-button w-full">Hitung</button>
                                </form>
                            </div>
                            <div id="splitResultCard" class="glass-effect p-6 hidden">
                                <h3 class="text-xl font-semibold mb-4 text-pink-400">Hasil Pembagian</h3>
                                <div id="splitResult"></div>
                                <button id="exportSplitBtn" class="custom-button custom-button-danger w-full mt-4">Export PDF</button>
                            </div>
                        </div>
                        <div class="glass-effect p-6">
                            <h3 class="text-xl font-semibold mb-4 text-blue-400">Riwayat Split Bill</h3>
                            <div id="splitHistory" class="space-y-3 max-h-[600px] overflow-y-auto"></div>
                        </div>
                    </div>
                </div>

                <!-- Notes Section -->
                <div id="notes-section" class="section hidden">
                    <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                         <h2 class="text-3xl font-bold text-purple-300">Catatan Profesional</h2>
                         <div class="flex gap-2">
                                 <button id="notesAddNewBtn" class="custom-button"><i class="fas fa-plus mr-2"></i>Catatan Baru</button>
                         </div>
                    </div>
                    <div class="notes-container">
                        <div class="glass-effect p-4 mb-6">
                            <h3 class="font-semibold text-lg text-pink-400 mb-2">Manajemen Font Kustom</h3>
                            <div class="flex items-center gap-4">
                                <div class="flex-grow">
                                    <label for="customFontUploader" class="block text-sm font-medium mb-1">Unggah Font Baru (.ttf, .otf, .woff)</label>
                                    <input type="file" id="customFontUploader" class="custom-input !p-2" accept=".otf,.ttf,.woff,.woff2">
                                </div>
                                <button id="clearCustomFontsBtn" class="custom-button custom-button-danger" title="Hapus Semua Font Kustom">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">Font yang diunggah akan tersimpan di browser Anda dan muncul di pilihan editor.</p>
                        </div>

                        <div id="notesEditorSection" class="glass-effect p-4">
                            <input type="text" id="notesTitleInput" class="custom-input mb-4 text-xl" placeholder="Judul Catatan...">
                            
                            <div class="pro-editor-container">
                                <button id="editor-master-btn" title="Tampilkan Opsi Pemformatan">
                                    <span class="font-bold">A</span><i class="fas fa-ellipsis-v ml-1"></i>
                                </button>
                
                                <div id="pro-toolbar" class="pro-toolbar">
                                    <div class="pro-toolbar-group">
                                        <button class="pro-toolbar-button" data-command="undo" title="Undo (Ctrl+Z)"><i class="fas fa-undo"></i></button>
                                        <button class="pro-toolbar-button" data-command="redo" title="Redo (Ctrl+Y)"><i class="fas fa-redo"></i></button>
                                    </div>
                                    
                                    <div class="pro-toolbar-group">
                                        <select class="pro-toolbar-select" data-command="fontName" title="Jenis Font">
                                        </select>
                                        <div class="flex items-center" title="Ukuran Teks">
                                            <button class="pro-toolbar-button" data-command="decreaseFontSize">A-</button>
                                            <input type="number" id="custom-font-size" class="w-12 text-center bg-transparent" value="16" min="8" max="72">
                                            <button class="pro-toolbar-button" data-command="increaseFontSize">A+</button>
                                        </div>
                                    </div>
                                    
                                    <div class="pro-toolbar-group">
                                        <button class="pro-toolbar-button" data-command="bold" title="Bold (Ctrl+B)"><i class="fas fa-bold"></i></button>
                                        <button class="pro-toolbar-button" data-command="italic" title="Italic (Ctrl+I)"><i class="fas fa-italic"></i></button>
                                        <button class="pro-toolbar-button" data-command="underline" title="Underline (Ctrl+U)"><i class="fas fa-underline"></i></button>
                                        <button class="pro-toolbar-button" data-command="strikeThrough" title="Strikethrough"><i class="fas fa-strikethrough"></i></button>
                                    </div>
                                    
                                    <div class="pro-toolbar-group">
                                        <div class="pro-toolbar-color-wrapper" title="Warna Teks">
                                            <i class="fas fa-font"></i>
                                            <input type="color" data-command="foreColor">
                                        </div>
                                        <div class="pro-toolbar-color-wrapper" title="Warna Sorot (Highlight)">
                                            <i class="fas fa-highlighter"></i>
                                            <input type="color" data-command="backColor">
                                        </div>
                                    </div>
                                    
                                    <div class="pro-toolbar-group">
                                        <select class="pro-toolbar-select" data-command="formatBlock" title="Gaya Paragraf">
                                            <option value="p">Paragraf</option>
                                            <option value="h1">Heading 1</option>
                                            <option value="h2">Heading 2</option>
                                            <option value="h3">Heading 3</option>
                                            <option value="blockquote">Kutipan</option>
                                        </select>
                                    </div>
                                    
                                    <div class="pro-toolbar-group">
                                        <button class="pro-toolbar-button" data-command="justifyLeft" title="Rata Kiri"><i class="fas fa-align-left"></i></button>
                                        <button class="pro-toolbar-button" data-command="justifyCenter" title="Rata Tengah"><i class="fas fa-align-center"></i></button>
                                        <button class="pro-toolbar-button" data-command="justifyRight" title="Rata Kanan"><i class="fas fa-align-right"></i></button>
                                        <button class="pro-toolbar-button" data-command="justifyFull" title="Rata Kanan Kiri"><i class="fas fa-align-justify"></i></button>
                                    </div>
                
                                    <div class="pro-toolbar-group">
                                        <button class="pro-toolbar-button" data-command="insertUnorderedList" title="Bullet List"><i class="fas fa-list-ul"></i></button>
                                        <button class="pro-toolbar-button" data-command="insertOrderedList" title="Numbered List"><i class="fas fa-list-ol"></i></button>
                                    </div>
                                    
                                    <div class="pro-toolbar-group">
                                        <button class="pro-toolbar-button" data-command="createLink" title="Sisipkan Tautan"><i class="fas fa-link"></i></button>
                                        <button class="pro-toolbar-button" data-command="embedMediaUrl" title="Sematkan Gambar/Video dari URL"><i class="fas fa-photo-video"></i></button>
                                        <button class="pro-toolbar-button" data-command="embedYouTube" title="Sematkan Video YouTube"><i class="fab fa-youtube"></i></button>
                                        <button class="pro-toolbar-button" data-command="embedTikTok" title="Sematkan Video TikTok"><i class="fab fa-tiktok"></i></button>
                                        <button class="pro-toolbar-button" data-command="uploadFile" title="Unggah File (Gambar, Video, ZIP)"><i class="fas fa-upload"></i></button>
                                        <button class="pro-toolbar-button" data-command="insertHorizontalRule" title="Garis Horizontal"><i class="fas fa-minus"></i></button>
                                    </div>
                
                                    <div class="pro-toolbar-group">
                                         <button class="pro-toolbar-button" data-command="clearFormatting" title="Hapus Format"><i class="fas fa-eraser"></i></button>
                                    </div>
                                </div>
                
                                <div id="pro-editor-content" class="pro-editor-content" contenteditable="true" placeholder="Mulai menulis atau jatuhkan file di sini...">
                                </div>
                
                                <div class="pro-editor-statusbar">
                                    <div class="flex items-center gap-4">
                                        <span id="word-count" class="pro-statusbar-segment" title="Jumlah Kata"><i class="fas fa-file-word"></i>0 Kata</span>
                                        <span id="char-count" class="pro-statusbar-segment" title="Jumlah Karakter"><i class="fas fa-keyboard"></i>0 Karakter</span>
                                        <span id="reading-time" class="pro-statusbar-segment" title="Waktu Baca"><i class="fas fa-clock"></i>0 mnt</span>
                                    </div>
                                    <div class="flex items-center gap-4">
                                        <span id="save-status" class="pro-statusbar-segment" title="Status Penyimpanan"><i class="fas fa-cloud"></i>Tersimpan</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex flex-wrap gap-4 mt-4">
                                <input type="date" id="notesDateFilter" class="custom-input flex-1">
                                <select id="notesMoodSelector" class="custom-input flex-1">
                                    <option value="neutral">Netral</option>
                                    <option value="happy">Senang</option>
                                    <option value="sad">Sedih</option>
                                    <option value="excited">Bersemangat</option>
                                    <option value="angry">Marah</option>
                                </select>
                                <input type="text" id="notesTagsInput" class="custom-input flex-1" placeholder="Tags, pisahkan koma">
                            </div>

                            <div class="flex flex-wrap gap-2 mt-4">
                                <button id="notesSaveBtn" class="custom-button flex-grow"><i class="fas fa-save mr-2"></i>Simpan</button>
                                <button id="notesSetPasswordBtn" class="custom-button flex-grow" style="background: linear-gradient(90deg, #f59e0b, #d97706);"><i class="fas fa-lock mr-2"></i>Kunci</button>
                                <button id="notesClearEditorBtn" class="custom-button custom-button-danger"><i class="fas fa-eraser mr-2"></i>Bersihkan</button>
                            </div>
                        </div>
                        
                        <div class="glass-effect p-4 space-y-4 mt-6">
                            <h3 class="font-semibold text-lg text-pink-400">Kontrol & Filter Catatan</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <input type="search" id="notesSearchInput" class="custom-input" placeholder="Cari berdasarkan judul, isi, atau tag...">
                                <select id="notesMoodFilter" class="custom-input">
                                    <option value="">Semua Mood</option>
                                    <option value="happy">Senang</option>
                                    <option value="sad">Sedih</option>
                                    <option value="neutral">Netral</option>
                                    <option value="excited">Bersemangat</option>
                                    <option value="angry">Marah</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="glass-effect p-4 mt-6">
                            <h3 class="font-semibold text-lg text-pink-400 mb-2">Daftar Catatan</h3>
                            <div id="notesList" class="space-y-2 max-h-96 overflow-y-auto"></div>
                        </div>
                
                    </div>
                </div>
                
                <div id="settings-section" class="section hidden">
                    <h2 class="text-3xl font-bold mb-6 text-purple-300">Pengaturan</h2>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="glass-effect p-6">
                            <h3 class="text-xl font-semibold mb-4 text-blue-400">Data & Laporan</h3>
                            <div class="space-y-4">
                                
                                <div class="p-4 rounded-lg border border-purple-500/20 space-y-3">
                                    <label class="block text-sm font-medium text-purple-300">Download Laporan Lengkap <i class="fas fa-gem text-yellow-400 ml-1"></i></label>
                                    <p class="text-xs text-gray-400 -mt-2">Fitur ini hanya tersedia di versi premium.</p>
                                    <button id="export-pdf-btn" class="custom-button w-full" style="background: linear-gradient(90deg, #10b981, #059669);">
                                        <i class="fas fa-file-pdf mr-2"></i>Ekspor ke PDF
                                    </button>
                                    <button id="export-images-btn" class="custom-button w-full" style="background: linear-gradient(90deg, #3b82f6, #2563eb);">
                                        <i class="fas fa-file-archive mr-2"></i>Ekspor Gambar (ZIP)
                                    </button>
                                </div>

                                <hr class="border-purple-500/20">
                                <button id="backupData" class="custom-button w-full"><i class="fas fa-download mr-2"></i>Backup Data (.zip)</button>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Restore Data (.zip)</label>
                                    <input type="file" id="restoreFile" accept=".zip" class="custom-input">
                                    <button id="restoreData" class="custom-button custom-button-danger w-full mt-2"><i class="fas fa-upload mr-2"></i>Restore dari Lokal</button>
                                </div>
                                <hr class="border-purple-500/20">
                                <button id="clearAllData" class="custom-button custom-button-danger w-full mt-4"><i class="fas fa-trash mr-2"></i>Hapus Semua Data</button>
                            </div>
                        </div>

                        <div class="glass-effect p-6 space-y-4">
                            <div class="glass-effect p-6">
                                <h3 class="text-xl font-semibold mb-4 text-pink-400">Kontak & Sosial Media</h3>
                                <div class="space-y-3">
                                    <a href="https://youtube.com/@uranusfazry?si=44IbU_u8hYA0cSBO" target="_blank" class="flex items-center p-2 rounded-lg hover:bg-purple-500/10 transition-colors">
                                        <i class="fab fa-youtube w-6 text-center text-red-500 mr-3"></i>
                                        <span class="text-sm">YouTube</span>
                                    </a>
                                    <a href="https://www.tiktok.com/@uranusfazry?_t=ZS-8z7TBMBtmqu&_r=1" target="_blank" class="flex items-center p-2 rounded-lg hover:bg-purple-500/10 transition-colors">
                                        <i class="fab fa-tiktok w-6 text-center mr-3"></i>
                                        <span class="text-sm">TikTok</span>
                                    </a>
                                    <a href="mailto:irawanfazry697@gmail.com" target="_blank" class="flex items-center p-2 rounded-lg hover:bg-purple-500/10 transition-colors">
                                        <i class="fas fa-envelope w-6 text-center text-gray-400 mr-3"></i>
                                        <span class="text-sm">Email</span>
                                    </a>
                                    <a href="https://wa.me/6287872521809?text=Halo%2C%20saya%20membutuhkan%20bantuan%20terkait%20website%20dan%20aplikasi%20uranusfazry%20(Uranuspace)" target="_blank" class="flex items-center p-2 rounded-lg hover:bg-purple-500/10 transition-colors">
                                        <i class="fab fa-whatsapp w-6 text-center text-green-500 mr-3"></i>
                                        <span class="text-sm">WhatsApp</span>
                                    </a>
                                </div>
                            </div>
                            <div class="glass-effect p-6">
                                <h3 class="text-xl font-semibold mb-4 text-pink-400">Informasi Aplikasi</h3>
                                <div class="space-y-2 text-sm">
                                    <p><strong>Nama:</strong> LifeHub v6 (Uranus Space)</p>
                                    <p><strong>Versi:</strong> 6.3.0-Freemium</p>
                                    <p><strong>Fitur:</strong> Editor HTML/CSS/JS, Analisis Data, Keuangan, Tugas, Pomodoro, Split Bill, Portal Tautan, Kunci Catatan, Keamanan Lanjutan, Unggah Font Kustom, Ukuran Teks per Catatan, Embed Media & ZIP.</p>
                                    <p><strong>Storage:</strong> LocalStorage (Data terenkripsi di terminal Anda)</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section untuk Editor HTML yang Diperbarui -->
                <div id="html-editor-section" class="section hidden flex flex-col gap-8">
                    <!-- Bagian Atas: Editor dan Pratinjau -->
                    <div class="flex-shrink-0">
                        <div id="editor-container" class="glass-effect p-2 sm:p-4 h-full flex flex-col">
                            <!-- Pesan Selamat Datang -->
                            <div id="welcome-message" class="text-center flex flex-col justify-center items-center h-full min-h-[60vh]">
                                <i class="fas fa-space-shuttle text-6xl text-purple-400 mb-4"></i>
                                <h1 class="text-3xl font-bold">Selamat Datang di Editor HTML</h1>
                                <p class="text-gray-400 mt-2">Pilih atau buat catatan baru di bawah untuk memulai.</p>
                            </div>
                            <!-- Editor HTML -->
                            <div id="html-editor" class="hidden h-full flex flex-col">
                                <div class="flex-shrink-0 mb-4">
                                    <input type="text" id="htmlNoteTitle" class="custom-input text-xl" placeholder="Judul Catatan HTML...">
                                </div>
                                
                                <!-- Toolbar Baru -->
                                <div id="html-editor-toolbar">
                                    <div class="toolbar-group">
                                        <button id="html-add-file-btn" class="toolbar-btn" title="File Baru"><i class="fas fa-plus"></i></button>
                                        <button id="html-undo-btn" class="toolbar-btn" title="Undo (Ctrl+Z)"><i class="fas fa-undo"></i></button>
                                        <button id="html-redo-btn" class="toolbar-btn" title="Redo (Ctrl+Y)"><i class="fas fa-redo"></i></button>
                                    </div>
                                    <div class="toolbar-separator"></div>
                                    <div class="toolbar-group">
                                        <button id="html-cursor-prev-btn" class="toolbar-btn" title="Posisi Kursor Sebelumnya"><i class="fas fa-arrow-left"></i></button>
                                        <button id="html-cursor-next-btn" class="toolbar-btn" title="Posisi Kursor Berikutnya"><i class="fas fa-arrow-right"></i></button>
                                    </div>
                                    <div class="toolbar-separator"></div>
                                    <div class="toolbar-group">
                                        <button id="html-search-btn" class="toolbar-btn" title="Cari (Ctrl+F)"><i class="fas fa-search"></i></button>
                                        <div id="html-search-wrapper" class="toolbar-search-wrapper">
                                            <input type="text" id="html-search-input" placeholder="Cari di kode...">
                                        </div>
                                    </div>
                                </div>

                                <div class="flex-shrink-0 border-b border-gray-700">
                                    <div class="code-editor-tabs flex space-x-1 p-1">
                                        <button class="tab-btn active" data-tab="html">HTML</button>
                                        <button class="tab-btn" data-tab="css">CSS</button>
                                        <button class="tab-btn" data-tab="js">JS</button>
                                    </div>
                                </div>
                                <div class="flex-grow grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 overflow-hidden">
                                    <!-- Panel Kode -->
                                    <div id="code-panels" class="flex flex-col h-full">
                                        <div class="code-panel" data-panel="html">
                                            <textarea id="htmlCode" class="code-textarea" placeholder="<!-- Kode HTML di sini -->"></textarea>
                                        </div>
                                        <div class="code-panel hidden" data-panel="css">
                                            <textarea id="cssCode" class="code-textarea" placeholder="/* Aturan CSS di sini */"></textarea>
                                        </div>
                                        <div class="code-panel hidden" data-panel="js">
                                            <textarea id="jsCode" class="code-textarea" placeholder="// Kode JavaScript di sini"></textarea>
                                        </div>
                                    </div>
                                    <!-- Panel Pratinjau -->
                                    <div id="preview-panel" class="flex flex-col h-full bg-gray-800 rounded-md">
                                        <div id="preview-controls">
                                            <div class="flex items-center space-x-2 bg-[var(--card-bg)] p-1 rounded-full">
                                                <span class="text-xs ml-2">Auto</span>
                                                <label class="relative inline-flex items-center cursor-pointer">
                                                    <input type="checkbox" id="auto-refresh-toggle" class="sr-only peer">
                                                    <div class="w-9 h-5 bg-gray-600 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-purple-600"></div>
                                                </label>
                                            </div>
                                            <button id="fullscreen-btn" class="control-btn" title="Pratinjau Layar Penuh"><i class="fas fa-expand"></i></button>
                                        </div>
                                        <div class="flex-grow bg-white rounded-md mt-2">
                                           <iframe id="html-preview-iframe" sandbox="allow-scripts allow-same-origin"></iframe>
                                        </div>
                                    </div>
                                </div>
                                <!-- Tombol Aksi Editor -->
                                <div class="flex-shrink-0 flex flex-wrap gap-2 mt-4">
                                    <button id="runBtn" class="custom-button"><i class="fas fa-play mr-2"></i>Jalankan</button>
                                    <button id="saveHtmlNoteBtn" class="custom-button"><i class="fas fa-save mr-2"></i>Simpan</button>
                                    <div class="relative inline-block">
                                        <button id="exportBtn" class="custom-button custom-button-secondary"><i class="fas fa-file-export mr-2"></i>Ekspor</button>
                                        <div id="export-menu" class="hidden absolute bottom-full mb-2 w-48 glass-effect !rounded-md p-2 z-10">
                                            <button id="exportHtmlBtn" class="w-full text-left p-2 hover:bg-purple-500/20 rounded text-sm">ke File .html</button>
                                            <button id="exportPdfBtn" class="w-full text-left p-2 hover:bg-purple-500/20 rounded text-sm">ke PDF (Pratinjau)</button>
                                            <button id="exportPdfCodeBtn" class="w-full text-left p-2 hover:bg-purple-500/20 rounded text-sm">ke PDF (Kode)</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Bagian Bawah: Daftar Catatan -->
                    <div class="flex-shrink-0">
                        <div class="glass-effect p-6">
                            <div class="flex flex-wrap justify-between items-center mb-4 gap-4">
                                <h2 class="text-2xl font-bold text-purple-300">Daftar Catatan HTML</h2>
                                <!-- TOMBOL BARU DITAMBAHKAN DI SINI -->
                                <button id="addHtmlNoteBtn" class="custom-button !py-2 !px-3">
                                    <i class="fas fa-plus mr-2"></i>Buat Baru
                                </button>
                                <div class="flex-grow sm:flex-grow-0 sm:w-72">
                                    <input type="search" id="searchHtmlNotes" placeholder="Cari catatan HTML..." class="custom-input">
                                </div>
                            </div>
                            <div id="htmlNotesList" class="space-y-2 max-h-60 overflow-y-auto">
                                <p class="text-center text-gray-500">Tidak ada catatan HTML.</p>
                            </div>
                        </div>
                    </div>
                </div>


                <footer class="text-center mt-10 py-4">
                    <p class="text-xs text-gray-500">Â© 2025 Uranus Space All rights reserved</p>
                </footer>

            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="mainModal" class="modal"><div class="modal-content glass-effect p-8 w-full max-w-2xl"></div></div>
    <div id="confirmModal" class="modal">
        <div class="modal-content glass-effect p-8 w-full max-w-sm text-center">
            <h3 id="confirmTitle" class="text-xl font-semibold mb-4 text-pink-400">Konfirmasi</h3>
            <p id="confirmMessage" class="mb-6">Apakah Anda yakin?</p>
            <div class="flex gap-4">
                <button id="confirmYes" class="custom-button flex-1">Ya</button>
                <button id="confirmNo" class="custom-button custom-button-danger flex-1">Tidak</button>
            </div>
        </div>
    </div>
    <div id="dateRangeModal" class="modal">
        <div class="modal-content glass-effect p-8 w-full max-w-md">
            <h3 class="text-xl font-semibold mb-6 text-purple-400">Pilih Rentang Tanggal</h3>
            <div class="space-y-4">
                <div>
                    <label for="startDate" class="block text-sm font-medium mb-1">Tanggal Mulai</label>
                    <input type="date" id="startDate" class="custom-input">
                </div>
                <div>
                    <label for="endDate" class="block text-sm font-medium mb-1">Tanggal Selesai</label>
                    <input type="date" id="endDate" class="custom-input">
                </div>
            </div>
            <div class="flex gap-4 mt-8">
                <button id="applyDateRange" class="custom-button flex-1">Terapkan</button>
                <button id="cancelDateRange" class="custom-button custom-button-danger flex-1">Batal</button>
            </div>
        </div>
    </div>
    
    <!-- NotesApp Modals -->
    <div id="notesPasswordModal" class="modal">
        <div class="modal-content glass-effect p-8 w-full max-w-sm text-center">
            <h3 class="text-xl font-semibold mb-4 text-pink-400">Catatan Terkunci</h3>
            <p id="password-prompt-message" class="mb-4">Masukkan kata sandi untuk membuka.</p>
            <input type="password" id="notesPasswordInput" class="custom-input mb-4">
            <div class="flex gap-2">
                <button id="notesCheckPasswordBtn" class="custom-button flex-1">Buka</button>
                <button id="notesCancelPasswordBtn" class="custom-button custom-button-danger">Batal</button>
            </div>
        </div>
    </div>
    <div id="notesPreviewModal" class="modal">
        <div class="modal-content glass-effect p-8 w-full max-w-3xl">
            <div id="notesPreviewContent" class="prose max-w-none"></div>
            <button id="notesClosePreviewBtn" class="custom-button mt-6">Tutup</button>
        </div>
    </div>

    <!-- [BARU] Modal Kustom untuk Input Password -->
    <div id="customPromptModal" class="modal">
        <div class="modal-content glass-effect p-8 w-full max-w-sm">
            <h3 id="customPromptTitle" class="text-xl font-semibold mb-4 text-pink-400">Atur Kata Sandi</h3>
            <p id="customPromptMessage" class="mb-6 text-gray-300">Masukkan kata sandi baru (kosongkan untuk membuka kunci):</p>
            
            <div class="relative">
                <input type="password" id="customPromptInput" class="custom-input pr-10" placeholder="Ketik kata sandi...">
                <i id="customPromptToggle" class="fas fa-eye absolute top-1/2 right-3 -translate-y-1/2 cursor-pointer text-gray-400 hover:text-white"></i>
            </div>

            <div class="flex gap-4 mt-6">
                <button id="customPromptCancel" class="custom-button custom-button-danger flex-1">Batal</button>
                <button id="customPromptOK" class="custom-button flex-1">Oke</button>
            </div>
        </div>
    </div>

    <!-- [BARU] Modal Notifikasi Premium -->
    <div id="premiumModal" class="modal">
        <div id="premiumModalContent" class="modal-content glass-effect p-8 w-full max-w-md text-center">
            <i class="fas fa-gem text-5xl text-yellow-400 mb-4" id="premium-icon"></i>
            <h3 class="text-2xl font-bold mb-3 text-purple-300">Fitur Premium Terkunci!</h3>
            <p class="text-gray-400 mb-6">Upgrade ke Uranus Studio untuk membuka semua fitur canggih dan tanpa batas.</p>
            
            <ul class="text-left space-y-2 mb-8">
                <li class="flex items-center"><i class="fas fa-check-circle text-green-400 mr-3"></i>Unggah & Kelola file di Google Drive</li>
                <li class="flex items-center"><i class="fas fa-check-circle text-green-400 mr-3"></i>Ekspor Laporan ke PDF & Gambar (ZIP)</li>
                <li class="flex items-center"><i class="fas fa-check-circle text-green-400 mr-3"></i>Ubah Latar Belakang dengan Gambar/Video</li>
                <li class="flex items-center"><i class="fas fa-check-circle text-green-400 mr-3"></i>Dan banyak lagi fitur eksklusif lainnya!</li>
            </ul>
    
            <div class="flex flex-col gap-4">
                <a href="#" id="upgradeBtn" target="_blank" class="custom-button glowing-button">
                    <i class="fas fa-rocket mr-2"></i> Upgrade Sekarang
                </a>
                <button id="closePremiumModalBtn" class="text-gray-500 hover:text-white text-sm">Nanti Saja</button>
            </div>
        </div>
    </div>

    <audio id="lockSound" src="https://c.top4top.io/m_35235kd2e1.m4a" preload="auto"></audio>

<script>
// ===================================================================================
// ========================== [BARU] LOGIKA PREMIUM ==================================
// ===================================================================================

// Ganti link ini dengan link halaman premium/pembayaran Anda
const PREMIUM_PURCHASE_URL = "https://trakteer.id/uranusfazry/shop/uranus-studio-unilD";

/**
Â * Memeriksa apakah pengguna memiliki status premium.
Â * Untuk versi gratis ini, fungsi ini akan selalu mengembalikan false.
Â * Di versi premium, Anda bisa menggantinya dengan pengecekan yang sesungguhnya.
Â * @returns {boolean} - Selalu false untuk versi gratis.
Â */
function isUserPremium() {
Â  Â  // Di aplikasi nyata, ini bisa memeriksa localStorage, cookie, atau status dari server.
Â  Â  // Untuk versi gratis, kita anggap pengguna tidak pernah premium.
Â  Â  return false;Â 
}

/**
Â * Menampilkan modal notifikasi premium.
Â */
function showPremiumModal() {
Â  Â  const modal = document.getElementById('premiumModal');
Â  Â  if (modal) {
Â  Â  Â  Â  modal.classList.add('show');
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Arahkan tombol upgrade ke link yang sudah ditentukan
Â  Â  Â  Â  document.getElementById('upgradeBtn').href = PREMIUM_PURCHASE_URL;

Â  Â  Â  Â  // Tambahkan event listener untuk tombol tutup
Â  Â  Â  Â  document.getElementById('closePremiumModalBtn').onclick = () => {
Â  Â  Â  Â  Â  Â  modal.classList.remove('show');
Â  Â  Â  Â  };
Â  Â  }
}

/**
Â * Fungsi "gatekeeper" untuk fitur premium.
Â * Memeriksa status premium, jika tidak premium, tampilkan modal.
Â * @returns {boolean} - True jika pengguna premium, false jika tidak.
Â */
function checkPremiumStatus() {
Â  Â  if (isUserPremium()) {
Â  Â  Â  Â  return true; // Pengguna adalah premium, izinkan akses.
Â  Â  } else {
Â  Â  Â  Â  showPremiumModal(); // Pengguna bukan premium, tampilkan modal.
Â  Â  Â  Â  return false; // Blokir akses.
Â  Â  }
}


// ===================================================================================
// ======================= FUNGSI HELPER UNTUK MODAL KUSTOM ==========================
// ===================================================================================
/**
Â * Menampilkan modal kustom sebagai pengganti window.prompt().
Â * @param {string} title - Judul modal.
Â * @param {string} message - Pesan instruksi untuk pengguna.
Â * @param {string} placeholder - Placeholder untuk input field.
Â * @returns {Promise<string|null>} Promise yang resolve dengan nilai input atau null jika dibatalkan.
Â */
function showCustomPrompt(title, message, placeholder, inputType = 'password') {
Â  Â  return new Promise((resolve) => {
Â  Â  Â  Â  const modal = document.getElementById('customPromptModal');
Â  Â  Â  Â  const titleEl = document.getElementById('customPromptTitle');
Â  Â  Â  Â  const messageEl = document.getElementById('customPromptMessage');
Â  Â  Â  Â  const inputEl = document.getElementById('customPromptInput');
Â  Â  Â  Â  const okBtn = document.getElementById('customPromptOK');
Â  Â  Â  Â  const cancelBtn = document.getElementById('customPromptCancel');
Â  Â  Â  Â  const toggleBtn = document.getElementById('customPromptToggle');

Â  Â  Â  Â  // Reset state
Â  Â  Â  Â  titleEl.textContent = title;
Â  Â  Â  Â  messageEl.textContent = message;
Â  Â  Â  Â  inputEl.placeholder = placeholder;
Â  Â  Â  Â  inputEl.value = '';
Â  Â  Â  Â  inputEl.type = inputType;
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (inputType === 'password') {
Â  Â  Â  Â  Â  Â  toggleBtn.style.display = 'block';
Â  Â  Â  Â  Â  Â  toggleBtn.classList.remove('fa-eye-slash');
Â  Â  Â  Â  Â  Â  toggleBtn.classList.add('fa-eye');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  toggleBtn.style.display = 'none';
Â  Â  Â  Â  }


Â  Â  Â  Â  modal.classList.add('show');
Â  Â  Â  Â  inputEl.focus();

Â  Â  Â  Â  const handleOK = () => {
Â  Â  Â  Â  Â  Â  cleanup();
Â  Â  Â  Â  Â  Â  resolve(inputEl.value);
Â  Â  Â  Â  };

Â  Â  Â  Â  const handleCancel = () => {
Â  Â  Â  Â  Â  Â  cleanup();
Â  Â  Â  Â  Â  Â  resolve(null);
Â  Â  Â  Â  };

Â  Â  Â  Â  const handleToggle = () => {
Â  Â  Â  Â  Â  Â  if (inputEl.type === 'password') {
Â  Â  Â  Â  Â  Â  Â  Â  inputEl.type = 'text';
Â  Â  Â  Â  Â  Â  Â  Â  toggleBtn.classList.remove('fa-eye');
Â  Â  Â  Â  Â  Â  Â  Â  toggleBtn.classList.add('fa-eye-slash');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  inputEl.type = 'password';
Â  Â  Â  Â  Â  Â  Â  Â  toggleBtn.classList.remove('fa-eye-slash');
Â  Â  Â  Â  Â  Â  Â  Â  toggleBtn.classList.add('fa-eye');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  const handleKeyup = (e) => {
Â  Â  Â  Â  Â  Â  if (e.key === 'Enter') handleOK();
Â  Â  Â  Â  Â  Â  if (e.key === 'Escape') handleCancel();
Â  Â  Â  Â  };

Â  Â  Â  Â  // Tambahkan event listeners
Â  Â  Â  Â  okBtn.addEventListener('click', handleOK);
Â  Â  Â  Â  cancelBtn.addEventListener('click', handleCancel);
Â  Â  Â  Â  toggleBtn.addEventListener('click', handleToggle);
Â  Â  Â  Â  modal.addEventListener('keyup', handleKeyup);

Â  Â  Â  Â  function cleanup() {
Â  Â  Â  Â  Â  Â  modal.classList.remove('show');
Â  Â  Â  Â  Â  Â  okBtn.removeEventListener('click', handleOK);
Â  Â  Â  Â  Â  Â  cancelBtn.removeEventListener('click', handleCancel);
Â  Â  Â  Â  Â  Â  toggleBtn.removeEventListener('click', handleToggle);
Â  Â  Â  Â  Â  Â  modal.removeEventListener('keyup', handleKeyup);
Â  Â  Â  Â  }
Â  Â  });
}


/**
Â * NotesApp Class
Â */
class NotesApp {
Â  Â  constructor() {
Â  Â  Â  Â  this.notes = [];
Â  Â  Â  Â  this.currentNoteId = null;
Â  Â  Â  Â  this.lastSelection = null;Â 
Â  Â  Â  Â  this.customFonts = [];
Â  Â  }

Â  Â  init() {
Â  Â  Â  Â  this.cacheDOMElements();
Â  Â  Â  Â  this.bindEvents();
Â  Â  Â  Â  this.loadNotes();
Â  Â  Â  Â  this.loadSavedFonts();
Â  Â  Â  Â  setInterval(() => this.autoSave(), 30000);
Â  Â  }

Â  Â  cacheDOMElements() {
Â  Â  Â  Â  this.dom = {
Â  Â  Â  Â  Â  Â  lockSound: document.getElementById('lockSound'),
Â  Â  Â  Â  Â  Â  passwordModal: document.getElementById('notesPasswordModal'),
Â  Â  Â  Â  Â  Â  passwordInput: document.getElementById('notesPasswordInput'),
Â  Â  Â  Â  Â  Â  checkPasswordBtn: document.getElementById('notesCheckPasswordBtn'),
Â  Â  Â  Â  Â  Â  cancelPasswordBtn: document.getElementById('notesCancelPasswordBtn'),
Â  Â  Â  Â  Â  Â  passwordPromptMessage: document.getElementById('password-prompt-message'),
Â  Â  Â  Â  Â  Â  hackOverlay: document.getElementById('hack-overlay'),
Â  Â  Â  Â  Â  Â  hackText: document.getElementById('hack-text'),
Â  Â  Â  Â  Â  Â  addNewNoteBtn: document.getElementById('notesAddNewBtn'),
Â  Â  Â  Â  Â  Â  searchInput: document.getElementById('notesSearchInput'),
Â  Â  Â  Â  Â  Â  moodFilter: document.getElementById('notesMoodFilter'),
Â  Â  Â  Â  Â  Â  editorSection: document.getElementById('notesEditorSection'),
Â  Â  Â  Â  Â  Â  titleInput: document.getElementById('notesTitleInput'),
Â  Â  Â  Â  Â  Â  masterBtn: document.getElementById('editor-master-btn'),
Â  Â  Â  Â  Â  Â  toolbar: document.getElementById('pro-toolbar'),
Â  Â  Â  Â  Â  Â  editorContent: document.getElementById('pro-editor-content'),
Â  Â  Â  Â  Â  Â  fontSelect: document.querySelector('#pro-toolbar select[data-command="fontName"]'),
Â  Â  Â  Â  Â  Â  fontSizeInput: document.getElementById('custom-font-size'),
Â  Â  Â  Â  Â  Â  fontUploader: document.getElementById('customFontUploader'),
Â  Â  Â  Â  Â  Â  clearFontsBtn: document.getElementById('clearCustomFontsBtn'),
Â  Â  Â  Â  Â  Â  wordCountEl: document.getElementById('word-count'),
Â  Â  Â  Â  Â  Â  charCountEl: document.getElementById('char-count'),
Â  Â  Â  Â  Â  Â  readingTimeEl: document.getElementById('reading-time'),
Â  Â  Â  Â  Â  Â  saveStatusEl: document.getElementById('save-status'),
Â  Â  Â  Â  Â  Â  dateFilter: document.getElementById('notesDateFilter'),
Â  Â  Â  Â  Â  Â  moodSelector: document.getElementById('notesMoodSelector'),
Â  Â  Â  Â  Â  Â  tagsInput: document.getElementById('notesTagsInput'),
Â  Â  Â  Â  Â  Â  saveNoteBtn: document.getElementById('notesSaveBtn'),
Â  Â  Â  Â  Â  Â  setPasswordBtn: document.getElementById('notesSetPasswordBtn'),
Â  Â  Â  Â  Â  Â  clearEditorBtn: document.getElementById('notesClearEditorBtn'),
Â  Â  Â  Â  Â  Â  notesList: document.getElementById('notesList'),
Â  Â  Â  Â  Â  Â  previewModal: document.getElementById('notesPreviewModal'),
Â  Â  Â  Â  Â  Â  previewContent: document.getElementById('notesPreviewContent'),
Â  Â  Â  Â  Â  Â  closePreviewBtn: document.getElementById('notesClosePreviewBtn'),
Â  Â  Â  Â  };
Â  Â  }

Â  Â  bindEvents() {
Â  Â  Â  Â  this.dom.addNewNoteBtn.addEventListener('click', () => this.addNewNote());
Â  Â  Â  Â  this.dom.saveNoteBtn.addEventListener('click', () => this.saveNote(true));
Â  Â  Â  Â  this.dom.setPasswordBtn.addEventListener('click', () => this.setPasswordForCurrentNote());
Â  Â  Â  Â  this.dom.clearEditorBtn.addEventListener('click', () => this.clearEditor());
Â  Â  Â  Â  this.dom.searchInput.addEventListener('input', () => this.filterNotes());
Â  Â  Â  Â  this.dom.moodFilter.addEventListener('change', () => this.filterNotes());
Â  Â  Â  Â  this.dom.fontUploader.addEventListener('change', (e) => this.handleFontUpload(e));
Â  Â  Â  Â  this.dom.clearFontsBtn.addEventListener('click', () => this.clearAllCustomFonts());
Â  Â  Â  Â  this.dom.masterBtn.addEventListener('click', () => this.toggleToolbar());

Â  Â  Â  Â  this.dom.toolbar.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  const button = e.target.closest('button');
Â  Â  Â  Â  Â  Â  if (!button) return;
Â  Â  Â  Â  Â  Â  const command = button.dataset.command;
Â  Â  Â  Â  Â  Â  if (command) {
Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  this.handleCommand(command);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  this.dom.fontSizeInput.addEventListener('change', (e) => this.applyStyle('fontSize', `${e.target.value}px`));
Â  Â  Â  Â  this.dom.fontSizeInput.addEventListener('input', (e) => this.applyStyle('fontSize', `${e.target.value}px`));


Â  Â  Â  Â  this.dom.toolbar.querySelectorAll('select, input[type="color"]').forEach(input => {
Â  Â  Â  Â  Â  Â  input.addEventListener('change', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  const command = e.target.dataset.command;
Â  Â  Â  Â  Â  Â  Â  Â  if (command) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.handleCommand(command, e.target.value);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  this.dom.editorContent.addEventListener('input', () => this.updateStatusBar());
Â  Â  Â  Â  this.dom.editorContent.addEventListener('blur', () => this.saveSelection());
Â  Â  Â  Â  this.dom.editorContent.addEventListener('dragover', (e) => { e.preventDefault(); e.stopPropagation(); this.dom.editorContent.classList.add('dragover'); });
Â  Â  Â  Â  this.dom.editorContent.addEventListener('dragleave', (e) => { e.preventDefault(); e.stopPropagation(); this.dom.editorContent.classList.remove('dragover'); });
Â  Â  Â  Â  this.dom.editorContent.addEventListener('drop', (e) => { e.preventDefault(); e.stopPropagation(); this.dom.editorContent.classList.remove('dragover'); this.handleFileUpload(e.dataTransfer.files); });
Â  Â  Â  Â  this.dom.editorContent.addEventListener('paste', (e) => this.handlePaste(e));

Â  Â  Â  Â  this.dom.notesList.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  const target = e.target.closest('button, .note-item-clickable');
Â  Â  Â  Â  Â  Â  if (!target) return;
Â  Â  Â  Â  Â  Â  const noteId = parseInt(target.dataset.id);
Â  Â  Â  Â  Â  Â  const action = target.dataset.action;
Â  Â  Â  Â  Â  Â  if (action === 'click-to-edit') { e.stopPropagation(); this.handleNoteClick(noteId); }
Â  Â  Â  Â  Â  Â  if (action === 'delete') { e.stopPropagation(); this.deleteNote(noteId); }
Â  Â  Â  Â  Â  Â  if (action === 'preview') { e.stopPropagation(); this.previewNote(noteId); }
Â  Â  Â  Â  Â  Â  if (action === 'export-pdf') { e.stopPropagation(); this.exportSingleNoteToPdf(noteId); }
Â  Â  Â  Â  });
Â  Â  Â  Â  this.dom.closePreviewBtn.addEventListener('click', () => this.closePreview());
Â  Â  }

Â  Â  loadSavedFonts() {
Â  Â  Â  Â  this.customFonts = JSON.parse(localStorage.getItem('customFonts_v5.5.0')) || [];
Â  Â  Â  Â  let fontStyleSheet = document.getElementById('custom-font-styles');
Â  Â  Â  Â  if (!fontStyleSheet) {
Â  Â  Â  Â  Â  Â  fontStyleSheet = document.createElement('style');
Â  Â  Â  Â  Â  Â  fontStyleSheet.id = 'custom-font-styles';
Â  Â  Â  Â  Â  Â  document.head.appendChild(fontStyleSheet);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  this.customFonts.forEach(font => {
Â  Â  Â  Â  Â  Â  const newFontFace = `@font-face { font-family: "${font.name}"; src: url(${font.url}); font-display: swap; }`;
Â  Â  Â  Â  Â  Â  fontStyleSheet.innerHTML += newFontFace;
Â  Â  Â  Â  });

Â  Â  Â  Â  this.updateFontSelector();
Â  Â  }

Â  Â  handleFontUpload(event) {
Â  Â  Â  Â  const file = event.target.files[0];
Â  Â  Â  Â  if (!file) return;

Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  reader.onload = (e) => {
Â  Â  Â  Â  Â  Â  const fontUrl = e.target.result;
Â  Â  Â  Â  Â  Â  let fontName = file.name.split('.').slice(0, -1).join('.');
Â  Â  Â  Â  Â  Â  fontName = fontName.replace(/[^a-zA-Z0-9\s-]/g, '').trim();

Â  Â  Â  Â  Â  Â  if (!fontName) {
Â  Â  Â  Â  Â  Â  Â  Â  showMessage(`Nama file font tidak valid.`, 'error');
Â  Â  Â  Â  Â  Â  Â  Â  this.dom.fontUploader.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (this.customFonts.some(f => f.name.toLowerCase() === fontName.toLowerCase())) {
Â  Â  Â  Â  Â  Â  Â  Â  showMessage(`Font dengan nama "${fontName}" sudah ada.`, 'error');
Â  Â  Â  Â  Â  Â  Â  Â  this.dom.fontUploader.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const newFont = { name: fontName, url: fontUrl };
Â  Â  Â  Â  Â  Â  this.customFonts.push(newFont);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const fontStyleSheet = document.getElementById('custom-font-styles');
Â  Â  Â  Â  Â  Â  const newFontFace = `@font-face { font-family: "${fontName}"; src: url(${fontUrl}); font-display: swap; }`;
Â  Â  Â  Â  Â  Â  fontStyleSheet.innerHTML += newFontFace;

Â  Â  Â  Â  Â  Â  localStorage.setItem('customFonts_v5.5.0', JSON.stringify(this.customFonts));
Â  Â  Â  Â  Â  Â  this.updateFontSelector();
Â  Â  Â  Â  Â  Â  showMessage(`Font "${fontName}" berhasil ditambahkan!`, 'success');
Â  Â  Â  Â  Â  Â  this.dom.fontUploader.value = '';
Â  Â  Â  Â  };
Â  Â  Â  Â  reader.readAsDataURL(file);
Â  Â  }

updateFontSelector() {
Â  Â  Â  Â  this.dom.fontSelect.innerHTML = '';

Â  Â  Â  Â  const defaultFonts = [
Â  Â  Â  Â  Â  Â  { value: "'Poppins', sans-serif", text: "Default (Poppins)" },
Â  Â  Â  Â  Â  Â  { value: "'Roboto', sans-serif", text: "Roboto" },
Â  Â  Â  Â  Â  Â  { value: "'Open Sans', sans-serif", text: "Open Sans" },
Â  Â  Â  Â  Â  Â  { value: "'Lato', sans-serif", text: "Lato" },
Â  Â  Â  Â  Â  Â  { value: "'Montserrat', sans-serif", text: "Montserrat" },
Â  Â  Â  Â  Â  Â  { value: "'Merriweather', serif", text: "Merriweather" },
Â  Â  Â  Â  Â  Â  { value: "'Playfair Display', serif", text: "Playfair Display" },
Â  Â  Â  Â  Â  Â  { value: "'Fira Code', monospace", text: "Fira Code" },
Â  Â  Â  Â  Â  Â  { value: "'JetBrains Mono', monospace", text: "JetBrains Mono" }
Â  Â  Â  Â  ];

Â  Â  Â  Â  const systemFontsGroup = document.createElement('optgroup');
Â  Â  Â  Â  systemFontsGroup.label = '--- Font Sistem ---';
Â  Â  Â  Â  defaultFonts.forEach(font => {
Â  Â  Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  Â  Â  option.value = font.value;
Â  Â  Â  Â  Â  Â  option.textContent = font.text;
Â  Â  Â  Â  Â  Â  option.style.fontFamily = font.value;
Â  Â  Â  Â  Â  Â  systemFontsGroup.appendChild(option);
Â  Â  Â  Â  });
Â  Â  Â  Â  this.dom.fontSelect.appendChild(systemFontsGroup);

Â  Â  Â  Â  if (this.customFonts.length > 0) {
Â  Â  Â  Â  Â  Â  const customFontsGroup = document.createElement('optgroup');
Â  Â  Â  Â  Â  Â  customFontsGroup.label = '--- Font Kustom ---';
Â  Â  Â  Â  Â  Â  this.customFonts.forEach(font => {
Â  Â  Â  Â  Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  Â  Â  Â  Â  option.value = `"${font.name}", sans-serif`;
Â  Â  Â  Â  Â  Â  Â  Â  option.textContent = font.name;
Â  Â  Â  Â  Â  Â  Â  Â  option.style.fontFamily = `"${font.name}", sans-serif`;
Â  Â  Â  Â  Â  Â  Â  Â  customFontsGroup.appendChild(option);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  this.dom.fontSelect.appendChild(customFontsGroup);
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  clearAllCustomFonts() {
Â  Â  Â  Â  showConfirm('Hapus Semua Font?', 'Anda yakin ingin menghapus semua font kustom yang telah diunggah?', () => {
Â  Â  Â  Â  Â  Â  this.customFonts = [];
Â  Â  Â  Â  Â  Â  localStorage.removeItem('customFonts_v5.5.0');
Â  Â  Â  Â  Â  Â  const fontStyleSheet = document.getElementById('custom-font-styles');
Â  Â  Â  Â  Â  Â  if (fontStyleSheet) {
Â  Â  Â  Â  Â  Â  Â  Â  fontStyleSheet.innerHTML = '';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  this.updateFontSelector();
Â  Â  Â  Â  Â  Â  showMessage('Semua font kustom telah dihapus.', 'success');
Â  Â  Â  Â  });
Â  Â  }

Â  Â  toggleToolbar() {
Â  Â  Â  Â  this.dom.toolbar.classList.toggle('visible');
Â  Â  }
Â  Â Â 
Â  Â  saveSelection() {
Â  Â  Â  Â  if (window.getSelection) {
Â  Â  Â  Â  Â  Â  const sel = window.getSelection();
Â  Â  Â  Â  Â  Â  if (sel.rangeCount > 0 && this.dom.editorContent.contains(sel.anchorNode)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â this.lastSelection = sel.getRangeAt(0);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

Â  Â  restoreSelection() {
Â  Â  Â  Â  if (this.lastSelection) {
Â  Â  Â  Â  Â  Â  if (window.getSelection) {
Â  Â  Â  Â  Â  Â  Â  Â  const sel = window.getSelection();
Â  Â  Â  Â  Â  Â  Â  Â  sel.removeAllRanges();
Â  Â  Â  Â  Â  Â  Â  Â  sel.addRange(this.lastSelection);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  applyStyle(styleProperty, styleValue) {
Â  Â  Â  Â  this.restoreSelection();
Â  Â  Â  Â  this.dom.editorContent.focus();

Â  Â  Â  Â  const selection = window.getSelection();
Â  Â  Â  Â  if (!selection.rangeCount) return;

Â  Â  Â  Â  document.execCommand('styleWithCSS', false, true);
Â  Â  Â  Â  if (styleProperty === 'fontFamily') {
Â  Â  Â  Â  Â  Â  document.execCommand('fontName', false, styleValue);
Â  Â  Â  Â  } else if (styleProperty === 'fontSize') {
Â  Â  Â  Â  Â  Â  const tempSpan = document.createElement('span');
Â  Â  Â  Â  Â  Â  tempSpan.style.fontSize = styleValue;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const range = selection.getRangeAt(0);
Â  Â  Â  Â  Â  Â  if (range.collapsed) {
Â  Â  Â  Â  Â  Â  Â  Â  Â // Tidak ada teks yang dipilih, kita akan membuat span baru untuk mengetik
Â  Â  Â  Â  Â  Â  Â  Â  Â tempSpan.innerHTML = '&#8203;'; // Zero-width space
Â  Â  Â  Â  Â  Â  Â  Â  Â range.insertNode(tempSpan);
Â  Â  Â  Â  Â  Â  Â  Â  Â range.selectNodeContents(tempSpan);
Â  Â  Â  Â  Â  Â  Â  Â  Â range.collapse(false); // Pindahkan kursor ke akhir
Â  Â  Â  Â  Â  Â  Â  Â  Â selection.removeAllRanges();
Â  Â  Â  Â  Â  Â  Â  Â  Â selection.addRange(range);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â // Ada teks yang dipilih, kita bungkus dengan span
Â  Â  Â  Â  Â  Â  Â  Â  Â tempSpan.appendChild(range.extractContents());
Â  Â  Â  Â  Â  Â  Â  Â  Â range.insertNode(tempSpan);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  document.execCommand('styleWithCSS', false, false);
Â  Â  Â  Â  this.updateStatusBar();
Â  Â  }

Â  Â  handleCommand(command, value = null) {
Â  Â  Â  Â  const simpleCommands = ['undo', 'redo', 'bold', 'italic', 'underline', 'strikeThrough', 'justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull', 'insertOrderedList', 'insertUnorderedList', 'insertHorizontalRule'];
Â  Â  Â  Â Â 
Â  Â  Â  Â  this.restoreSelection();
Â  Â  Â  Â  this.dom.editorContent.focus();

Â  Â  Â  Â  if (simpleCommands.includes(command)) {
Â  Â  Â  Â  Â  Â  document.execCommand(command, false, value);
Â  Â  Â  Â  } else if (command === 'clearFormatting') {
Â  Â  Â  Â  Â  Â  Â document.execCommand('removeFormat', false, null);
Â  Â  Â  Â  } else if (command === 'fontName') {
Â  Â  Â  Â  Â  Â  this.applyStyle('fontFamily', value);
Â  Â  Â  Â  } else if (command === 'decreaseFontSize' || command === 'increaseFontSize') {
Â  Â  Â  Â  Â  Â  let currentSize = parseInt(this.dom.fontSizeInput.value);
Â  Â  Â  Â  Â  Â  currentSize += (command === 'increaseFontSize' ? 2 : -2);
Â  Â  Â  Â  Â  Â  if (currentSize < 8) currentSize = 8;
Â  Â  Â  Â  Â  Â  if (currentSize > 72) currentSize = 72;
Â  Â  Â  Â  Â  Â  this.dom.fontSizeInput.value = currentSize;
Â  Â  Â  Â  Â  Â  this.applyStyle('fontSize', `${currentSize}px`);
Â  Â  Â  Â  } else if (command === 'formatBlock' || command === 'foreColor' || command === 'backColor') {
Â  Â  Â  Â  Â  Â  document.execCommand(command, false, value);
Â  Â  Â  Â  } else if (command === 'createLink') {
Â  Â  Â  Â  Â  Â  const url = prompt('Masukkan URL:', 'https://');
Â  Â  Â  Â  Â  Â  if (url) document.execCommand('createLink', false, url);
Â  Â  Â  Â  } else if (command === 'embedMediaUrl') {
Â  Â  Â  Â  Â  Â  this.embedMediaFromUrl();
Â  Â  Â  Â  } else if (command === 'embedYouTube') {
Â  Â  Â  Â  Â  Â  this.embedYouTube();
Â  Â  Â  Â  } else if (command === 'embedTikTok') {
Â  Â  Â  Â  Â  Â  this.embedTikTok();
Â  Â  Â  Â  } else if (command === 'uploadFile') {
Â  Â  Â  Â  Â  Â  const input = document.createElement('input');
Â  Â  Â  Â  Â  Â  input.type = 'file';
Â  Â  Â  Â  Â  Â  input.accept = 'image/*,video/*,application/zip';
Â  Â  Â  Â  Â  Â  input.onchange = (e) => this.handleFileUpload(e.target.files);
Â  Â  Â  Â  Â  Â  input.click();
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  console.warn(`Perintah tidak dikenal: ${command}`);
Â  Â  Â  Â  }
Â  Â  Â  Â  this.dom.editorContent.focus();
Â  Â  Â  Â  this.updateStatusBar();
Â  Â  }

handlePaste(e) {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  const text = (e.clipboardData || window.clipboardData).getData('text/plain');
Â  Â  Â  Â  document.execCommand('insertText', false, text);
Â  Â  }

Â  Â  updateStatusBar() {
Â  Â  Â  Â  const text = this.dom.editorContent.innerText || '';
Â  Â  Â  Â  const wordCount = text.trim().split(/\s+/).filter(Boolean).length;
Â  Â  Â  Â  const charCount = text.length;
Â  Â  Â  Â  const readingTime = Math.ceil(wordCount / 200);

Â  Â  Â  Â  this.dom.wordCountEl.innerHTML = `<i class="fas fa-file-word"></i>${wordCount} Kata`;
Â  Â  Â  Â  this.dom.charCountEl.innerHTML = `<i class="fas fa-keyboard"></i>${charCount} Karakter`;
Â  Â  Â  Â  this.dom.readingTimeEl.innerHTML = `<i class="fas fa-clock"></i>${readingTime} mnt`;
Â  Â  Â  Â Â 
Â  Â  Â  Â  this.dom.saveStatusEl.innerHTML = `<i class="fas fa-edit"></i>Belum disimpan`;
Â  Â  Â  Â  this.dom.saveStatusEl.style.color = '#fbbf24';
Â  Â  }

Â  Â  handleNoteClick(id) { const note = this.notes.find(n => n.id === id); if (note) { const lockdownKey = `lockdown_${id}`; const lockdownUntil = parseInt(localStorage.getItem(lockdownKey) || '0'); if (Date.now() < lockdownUntil) { const remaining = Math.ceil((lockdownUntil - Date.now()) / 1000); showMessage(`âŒ Akses ditolak. Coba lagi dalam ${remaining} detik.`, 'error'); this.triggerHackEffect(true); return; } if (note.isLocked) { this.promptForPassword(id); } else { this.editNote(id); } } }
Â  Â Â 
Â  Â  promptForPassword(id) {Â 
Â  Â  Â  Â  this.dom.passwordModal.classList.add('show');Â 
Â  Â  Â  Â  this.dom.passwordInput.value = '';Â 
Â  Â  Â  Â  this.dom.passwordInput.focus();Â 
Â  Â  Â  Â  this.dom.passwordPromptMessage.textContent = 'Masukkan kata sandi untuk membuka.';Â 
Â  Â  Â  Â  let attempts = 0;Â 
Â  Â  Â  Â  const attemptKey = `attempts_${id}`;Â 
Â  Â  Â  Â  const checkHandler = () => {Â 
Â  Â  Â  Â  Â  Â  const note = this.notes.find(n => n.id === id);Â 
Â  Â  Â  Â  Â  Â  if (note && this.dom.passwordInput.value === note.password) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  this.editNote(id);Â 
Â  Â  Â  Â  Â  Â  Â  Â  this.dom.passwordModal.classList.remove('show');Â 
Â  Â  Â  Â  Â  Â  Â  Â  showMessage('Catatan terbuka!', 'success');Â 
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.removeItem(attemptKey);Â 
Â  Â  Â  Â  Â  Â  Â  Â  cleanup();Â 
Â  Â  Â  Â  Â  Â  } else {Â 
Â  Â  Â  Â  Â  Â  Â  Â  attempts = parseInt(localStorage.getItem(attemptKey) || '0') + 1;Â 
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem(attemptKey, attempts);Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (attempts === 1) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.dom.passwordPromptMessage.textContent = 'ðŸ˜• Hmm, coba lagi.';Â 
Â  Â  Â  Â  Â  Â  Â  Â  } else if (attempts === 2) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.dom.passwordPromptMessage.textContent = 'ðŸ˜¡ Masih salah, hati-hati!';Â 
Â  Â  Â  Â  Â  Â  Â  Â  } else if (attempts >= 3) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.dom.passwordModal.classList.remove('show');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.triggerLockdown(id);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cleanup();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;Â 
Â  Â  Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  Â  Â  this.dom.passwordInput.value = '';Â 
Â  Â  Â  Â  Â  Â  Â  Â  this.dom.passwordInput.focus();Â 
Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  };Â 
Â  Â  Â  Â  const cancelHandler = () => {Â 
Â  Â  Â  Â  Â  Â  this.dom.passwordModal.classList.remove('show');Â 
Â  Â  Â  Â  Â  Â  cleanup();Â 
Â  Â  Â  Â  };Â 
Â  Â  Â  Â  const cleanup = () => {Â 
Â  Â  Â  Â  Â  Â  this.dom.checkPasswordBtn.removeEventListener('click', checkHandler);Â 
Â  Â  Â  Â  Â  Â  this.dom.cancelPasswordBtn.removeEventListener('click', cancelHandler);Â 
Â  Â  Â  Â  };Â 
Â  Â  Â  Â  this.dom.checkPasswordBtn.addEventListener('click', checkHandler);Â 
Â  Â  Â  Â  this.dom.cancelPasswordBtn.addEventListener('click', cancelHandler);Â 
Â  Â  }

Â  Â  triggerLockdown(id) {Â 
Â  Â  Â  Â  const lockdownDuration = 30000;Â 
Â  Â  Â  Â  const lockdownKey = `lockdown_${id}`;Â 
Â  Â  Â  Â  localStorage.setItem(lockdownKey, Date.now() + lockdownDuration);Â 
Â  Â  Â  Â  localStorage.removeItem(`attempts_${id}`);Â 
Â  Â  Â  Â  this.triggerHackEffect();Â 
Â  Â  Â  Â  setTimeout(() => {Â 
Â  Â  Â  Â  Â  Â  localStorage.removeItem(lockdownKey);Â 
Â  Â  Â  Â  }, lockdownDuration);Â 
Â  Â  }
Â  Â Â 
Â  Â  triggerHackEffect(isResuming = false) {Â 
Â  Â  Â  Â  this.dom.hackOverlay.style.display = 'flex';Â 

Â  Â  Â  Â  if (this.dom.lockSound) {
Â  Â  Â  Â  Â  Â  this.dom.lockSound.currentTime = 0;
Â  Â  Â  Â  Â  Â  this.dom.lockSound.play().catch(e => console.error("Gagal memutar audio:", e));
Â  Â  Â  Â  }

Â  Â  Â  Â  const text = "Access Denied!\nSystem Lockdown Initiated...\nPlease wait 30 seconds...";Â 
Â  Â  Â  Â  let i = 0;Â 
Â  Â  Â  Â  this.dom.hackText.innerHTML = '';Â 
Â  Â  Â  Â  const type = () => {Â 
Â  Â  Â  Â  Â  Â  if (i < text.length) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  this.dom.hackText.innerHTML += text.charAt(i);Â 
Â  Â  Â  Â  Â  Â  Â  Â  i++;Â 
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(type, 50);Â 
Â  Â  Â  Â  Â  Â  } else {Â 
Â  Â  Â  Â  Â  Â  Â  Â  this.dom.hackText.innerHTML += '<span class="typewriter-cursor"></span>';Â 
Â  Â  Â  Â  Â  Â  Â  Â  setInterval(() => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.dom.hackText.classList.toggle('glitch');Â 
Â  Â  Â  Â  Â  Â  Â  Â  }, 200);Â 
Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  };Â 
Â  Â  Â  Â  type();Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  setTimeout(() => {Â 
Â  Â  Â  Â  Â  Â  this.dom.hackOverlay.style.display = 'none';Â 
Â  Â  Â  Â  Â  Â  this.dom.hackText.classList.remove('glitch');Â 
Â  Â  Â  Â  Â  Â  if (this.dom.lockSound) {
Â  Â  Â  Â  Â  Â  Â  Â  this.dom.lockSound.pause();
Â  Â  Â  Â  Â  Â  Â  Â  this.dom.lockSound.currentTime = 0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }, isResuming ? 5000 : 30000);Â 
Â  Â  }

async setPasswordForCurrentNote() {
Â  Â  Â  Â  if (!this.currentNoteId) {
Â  Â  Â  Â  Â  Â  showMessage('Simpan catatan terlebih dahulu sebelum menguncinya.', 'error');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  const note = this.notes.find(n => n.id === this.currentNoteId);
Â  Â  Â  Â  if (!note) return;

Â  Â  Â  Â  if (note.isLocked) {
Â  Â  Â  Â  Â  Â  const currentPassword = await showCustomPrompt('Ubah Kata Sandi', 'Masukkan kata sandi saat ini untuk melanjutkan.', 'Kata sandi saat ini');
Â  Â  Â  Â  Â  Â  if (currentPassword === null) return;
Â  Â  Â  Â  Â  Â  if (currentPassword !== note.password) {
Â  Â  Â  Â  Â  Â  Â  Â  showMessage('Kata sandi saat ini salah.', 'error');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  const newPassword = await showCustomPrompt('Atur Kata Sandi Baru', 'Masukkan kata sandi baru (kosongkan untuk membuka kunci).', 'Kata sandi baru');
Â  Â  Â  Â  if (newPassword === null) return;

Â  Â  Â  Â  if (newPassword) {
Â  Â  Â  Â  Â  Â  note.isLocked = true;
Â  Â  Â  Â  Â  Â  note.password = newPassword;
Â  Â  Â  Â  Â  Â  showMessage('Catatan berhasil dikunci!', 'success');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  note.isLocked = false;
Â  Â  Â  Â  Â  Â  delete note.password;
Â  Â  Â  Â  Â  Â  showMessage('Kunci catatan berhasil dibuka.', 'success');
Â  Â  Â  Â  }

Â  Â  Â  Â  this.saveToStorage();
Â  Â  Â  Â  this.displayNotes();
Â  Â  }

Â  Â  async embedMediaFromUrl() {
Â  Â  Â  Â  const url = await showCustomPrompt('Sematkan Media', 'Masukkan URL gambar atau video.', 'https://...', 'url');
Â  Â  Â  Â  if (!url) return;

Â  Â  Â  Â  const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.svg', '.bmp'];
Â  Â  Â  Â  const videoExtensions = ['.mp4', '.webm', '.ogg', '.mov'];
Â  Â  Â  Â Â 
Â  Â  Â  Â  const urlLower = url.toLowerCase();
Â  Â  Â  Â  let embedHTML = '';

Â  Â  Â  Â  if (imageExtensions.some(ext => urlLower.endsWith(ext))) {
Â  Â  Â  Â  Â  Â  embedHTML = `<img src="${url}" style="max-width: 100%; height: auto; border-radius: 8px; margin: 1rem 0;" />`;
Â  Â  Â  Â  } else if (videoExtensions.some(ext => urlLower.endsWith(ext))) {
Â  Â  Â  Â  Â  Â  embedHTML = `<video controls src="${url}" style="max-width: 100%; border-radius: 8px; margin: 1rem 0;"></video>`;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  showMessage("URL tidak didukung. Pastikan link merujuk langsung ke file gambar atau video.", "error");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  document.execCommand('insertHTML', false, embedHTML + "<p><br></p>");
Â  Â  }

Â  Â  embedYouTube() { const url = prompt("Masukkan URL video YouTube:"); if (!url) return; let videoId = null; const regexes = [/(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([^&]+)/, /(?:https?:\/\/)?(?:www\.)?youtu\.be\/([^?]+)/, /(?:https?:\/\/)?(?:www\.)?youtube\.com\/embed\/([^?]+)/]; for (const regex of regexes) { const match = url.match(regex); if (match && match[1]) { videoId = match[1]; break; } } if (videoId) { const embedHTML = `<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; margin: 1rem 0;"><iframe src="https://www.youtube.com/embed/${videoId}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 8px;"></iframe></div><p><br></p>`; document.execCommand('insertHTML', false, embedHTML); } else { showMessage("URL YouTube tidak valid.", "error"); } }
Â  Â  embedTikTok() { const url = prompt("Masukkan URL video TikTok:"); if (!url) return; const regex = /tiktok\.com\/.*\/video\/(\d+)/; const match = url.match(regex); const videoId = match && match[1] ? match[1] : null; if (videoId) { const embedHTML = `<div style="position: relative; padding-bottom: 177.78%; height: 0; overflow: hidden; max-width: 325px; margin: 1rem auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);"><iframe src="https://www.tiktok.com/embed/v2/${videoId}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></iframe></div><p><br></p>`; document.execCommand('insertHTML', false, embedHTML); showMessage("Video TikTok berhasil disematkan!", "success"); } else { showMessage("URL TikTok tidak valid. Pastikan URL berisi '/video/...' dan ID video.", "error"); } }
Â  Â Â 
Â  Â  handleFileUpload(files) {
Â  Â  Â  Â  if (!files || files.length === 0) return;
Â  Â  Â  Â  const file = files[0];
Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â Â 
Â  Â  Â  Â  reader.onload = (e) => {
Â  Â  Â  Â  Â  Â  const result = e.target.result;
Â  Â  Â  Â  Â  Â  let elementHTML = '';

Â  Â  Â  Â  Â  Â  if (file.type.startsWith('image/')) {
Â  Â  Â  Â  Â  Â  Â  Â  elementHTML = `<img src="${result}" style="max-width: 100%; height: auto; border-radius: 8px; margin: 1rem 0;" />`;
Â  Â  Â  Â  Â  Â  } else if (file.type.startsWith('video/')) {
Â  Â  Â  Â  Â  Â  Â  Â  elementHTML = `<video controls src="${result}" style="max-width: 100%; border-radius: 8px; margin: 1rem 0;"></video>`;
Â  Â  Â  Â  Â  Â  } else if (file.type === 'application/zip') {
Â  Â  Â  Â  Â  Â  Â  Â  const note = this.notes.find(n => n.id === this.currentNoteId) || { attachments: [] };
Â  Â  Â  Â  Â  Â  Â  Â  if (!note.attachments) note.attachments = [];
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const attachment = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: `zip_${Date.now()}`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: file.name,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  size: file.size,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: file.type,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  uploadDate: new Date().toISOString(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dataUrl: result
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  note.attachments.push(attachment);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  elementHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="embedded-zip" contenteditable="false" data-attachment-id="${attachment.id}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-file-archive"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="zip-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="zip-name">${file.name}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="zip-details">${formatSize(file.size)} - ${formatDate(attachment.uploadDate)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  showMessage(`Tipe file ${file.type} tidak didukung untuk disematkan.`, 'error');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  document.execCommand('insertHTML', false, elementHTML + "<p><br></p>");
Â  Â  Â  Â  Â  Â  this.saveNote(); // Simpan catatan untuk memastikan attachment tersimpan
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  reader.readAsDataURL(file);
Â  Â  }
Â  Â Â 
Â  Â  saveNote(isManual = false) {Â 
Â  Â  Â  Â  const title = this.dom.titleInput.value.trim();Â 
Â  Â  Â  Â  const content = this.dom.editorContent.innerHTML;Â 
Â  Â  Â  Â  const tags = this.dom.tagsInput.value.split(',').map(tag => tag.trim()).filter(tag => tag);Â 
Â  Â  Â  Â  const mood = this.dom.moodSelector.value;Â 
Â  Â  Â  Â  const date = this.dom.dateFilter.value || new Date().toISOString().split('T')[0];
Â  Â  Â  Â  const fontSize = this.dom.editorContent.style.fontSize || '16px';
Â  Â  Â  Â  const fontFamily = this.dom.editorContent.style.fontFamily || "'Poppins', sans-serif";

Â  Â  Â  Â  if (!title && !this.dom.editorContent.innerText.trim()) {Â 
Â  Â  Â  Â  Â  Â  if (isManual) showMessage('Judul atau isi tidak boleh kosong.', 'error');Â 
Â  Â  Â  Â  Â  Â  return;Â 
Â  Â  Â  Â  }Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (this.currentNoteId) {Â 
Â  Â  Â  Â  Â  Â  const index = this.notes.findIndex(n => n.id === this.currentNoteId);Â 
Â  Â  Â  Â  Â  Â  const existingNote = this.notes[index];Â 
Â  Â  Â  Â  Â  Â  existingNote.title = title;Â 
Â  Â  Â  Â  Â  Â  existingNote.content = content;Â 
Â  Â  Â  Â  Â  Â  existingNote.tags = tags;Â 
Â  Â  Â  Â  Â  Â  existingNote.mood = mood;Â 
Â  Â  Â  Â  Â  Â  existingNote.date = new Date(date).toISOString();Â 
Â  Â  Â  Â  Â  Â  existingNote.lastModified = new Date().toISOString();
Â  Â  Â  Â  Â  Â  existingNote.fontSize = fontSize;
Â  Â  Â  Â  Â  Â  existingNote.fontFamily = fontFamily;
Â  Â  Â  Â  Â  Â  // attachments sudah ditambahkan saat upload ZIP
Â  Â  Â  Â  } else {Â 
Â  Â  Â  Â  Â  Â  const note = {Â 
Â  Â  Â  Â  Â  Â  Â  Â  id: Date.now(),Â 
Â  Â  Â  Â  Â  Â  Â  Â  title: title,Â 
Â  Â  Â  Â  Â  Â  Â  Â  content: content,Â 
Â  Â  Â  Â  Â  Â  Â  Â  tags: tags,Â 
Â  Â  Â  Â  Â  Â  Â  Â  mood: mood,Â 
Â  Â  Â  Â  Â  Â  Â  Â  date: new Date(date).toISOString(),Â 
Â  Â  Â  Â  Â  Â  Â  Â  lastModified: new Date().toISOString(),Â 
Â  Â  Â  Â  Â  Â  Â  Â  isLocked: false,
Â  Â  Â  Â  Â  Â  Â  Â  fontSize: fontSize,
Â  Â  Â  Â  Â  Â  Â  Â  fontFamily: fontFamily,
Â  Â  Â  Â  Â  Â  Â  Â  attachments: [] // Inisialisasi attachments untuk catatan baru
Â  Â  Â  Â  Â  Â  };Â 
Â  Â  Â  Â  Â  Â  this.notes.unshift(note);Â 
Â  Â  Â  Â  Â  Â  this.currentNoteId = note.id;Â 
Â  Â  Â  Â  }Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  this.saveToStorage();Â 
Â  Â  Â  Â  this.displayNotes();Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (isManual) {Â 
Â  Â  Â  Â  Â  Â  showMessage('Catatan disimpan!', 'success');Â 
Â  Â  Â  Â  Â  Â  this.dom.saveStatusEl.innerHTML = `<i class="fas fa-cloud"></i>Disimpan`;Â 
Â  Â  Â  Â  Â  Â  this.dom.saveStatusEl.style.color = 'var(--text-secondary)';Â 
Â  Â  Â  Â  }Â 
Â  Â  }
Â  Â Â 
Â  Â  autoSave() { const title = this.dom.titleInput.value.trim(); const content = this.dom.editorContent.innerHTML; if ((title || this.dom.editorContent.innerText.trim()) && this.currentNoteId) { this.saveNote(); showMessage('Tersimpan otomatis', 'info'); this.dom.saveStatusEl.innerHTML = `<i class="fas fa-cloud"></i>Disimpan`; this.dom.saveStatusEl.style.color = 'var(--text-secondary)'; } }
Â  Â  loadNotes() { const saved = localStorage.getItem('notes_v5.9.0'); if (saved) { this.notes = JSON.parse(saved); this.displayNotes(); } }
Â  Â  saveToStorage() { localStorage.setItem('notes_v5.9.0', JSON.stringify(this.notes)); }
Â  Â Â 
Â  Â  displayNotes(filteredNotes = null) {Â 
Â  Â  Â  Â  const notesToShow = (filteredNotes || this.notes).sort((a, b) => new Date(b.lastModified) - new Date(a.lastModified));Â 
Â  Â  Â  Â  if (notesToShow.length === 0) {Â 
Â  Â  Â  Â  Â  Â  this.dom.notesList.innerHTML = '<div class="text-center text-gray-500 py-4">Tidak ada catatan.</div>';Â 
Â  Â  Â  Â  Â  Â  return;Â 
Â  Â  Â  Â  }Â 
Â  Â  Â  Â  this.dom.notesList.innerHTML = notesToShow.map(note => {Â 
Â  Â  Â  Â  Â  Â  const lockIcon = note.isLocked ? '<i class="fas fa-lock text-yellow-500 text-xs ml-2"></i>' : '';Â 
Â  Â  Â  Â  Â  Â  const tagsHtml = (note.tags && note.tags.length > 0)Â 
Â  Â  Â  Â  Â  Â  Â  Â  ? `<div class="mt-2 flex flex-wrap gap-2">${note.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}</div>`
Â  Â  Â  Â  Â  Â  Â  Â  : '';
Â  Â  Â  Â  Â  Â  return `<div class="note-item p-3 rounded-lg mb-2 cursor-pointer note-item-clickable" data-action="click-to-edit" data-id="${note.id}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-start justify-between mb-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong class="text-md text-purple-300">${note.title || 'Tanpa Judul'}${lockIcon}</strong>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="block text-xs text-gray-400">${this.formatDate(note.lastModified)}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-action="preview" data-id="${note.id}" class="text-green-400 hover:text-green-300" title="Pratinjau"><i class="fas fa-eye"></i></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-action="export-pdf" data-id="${note.id}" class="text-blue-400 hover:text-blue-300" title="Ekspor ke PDF"><i class="fas fa-file-pdf"></i></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button data-action="delete" data-id="${note.id}" class="text-red-400 hover:text-red-300" title="Hapus"><i class="fas fa-trash"></i></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-sm text-gray-400">${note.isLocked ? '<em>Konten terkunci...</em>' : this.truncateContent(note.content, 80)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${tagsHtml}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;Â 
Â  Â  Â  Â  }).join('');Â 
Â  Â  }
Â  Â Â 
Â  Â  editNote(id) {Â 
Â  Â  Â  Â  const note = this.notes.find(n => n.id === id);Â 
Â  Â  Â  Â  if (note) {Â 
Â  Â  Â  Â  Â  Â  this.currentNoteId = id;Â 
Â  Â  Â  Â  Â  Â  this.dom.titleInput.value = note.title;Â 
Â  Â  Â  Â  Â  Â  this.dom.editorContent.innerHTML = note.content;Â 
Â  Â  Â  Â  Â  Â  this.dom.tagsInput.value = (note.tags || []).join(', ');Â 
Â  Â  Â  Â  Â  Â  this.dom.moodSelector.value = note.mood || 'neutral';Â 
Â  Â  Â  Â  Â  Â  this.dom.dateFilter.value = (note.date || new Date().toISOString()).split('T')[0];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Terapkan gaya yang tersimpan
Â  Â  Â  Â  Â  Â  this.dom.editorContent.style.fontSize = note.fontSize || '16px';
Â  Â  Â  Â  Â  Â  this.dom.fontSizeInput.value = parseInt(note.fontSize) || 16;
Â  Â  Â  Â  Â  Â  this.dom.editorContent.style.fontFamily = note.fontFamily || "'Poppins', sans-serif";
Â  Â  Â  Â  Â  Â  this.dom.fontSelect.value = note.fontFamily || "'Poppins', sans-serif";

Â  Â  Â  Â  Â  Â  this.dom.titleInput.focus();Â 
Â  Â  Â  Â  Â  Â  this.updateStatusBar();Â 
Â  Â  Â  Â  Â  Â  showMessage('Catatan dimuat untuk diedit', 'info');Â 
Â  Â  Â  Â  }Â 
Â  Â  }
Â  Â Â 
Â  Â  deleteNote(id) { showConfirm('Hapus Catatan?', 'Yakin ingin menghapus catatan ini secara permanen?', () => { this.notes = this.notes.filter(n => n.id !== id); this.saveToStorage(); this.displayNotes(); if (this.currentNoteId === id) { this.clearEditor(); } showMessage('Catatan dihapus!', 'success'); }); }
Â  Â Â 
Â  Â  previewNote(id) {Â 
Â  Â  Â  Â  const note = this.notes.find(n => n.id === id);Â 
Â  Â  Â  Â  if (note) {Â 
Â  Â  Â  Â  Â  Â  if (note.isLocked) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  showMessage('Catatan ini terkunci. Buka kunci untuk melihat pratinjau.', 'error');Â 
Â  Â  Â  Â  Â  Â  Â  Â  return;Â 
Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const previewContainer = document.createElement('div');
Â  Â  Â  Â  Â  Â  previewContainer.style.fontFamily = note.fontFamily || "'Poppins', sans-serif";
Â  Â  Â  Â  Â  Â  previewContainer.style.fontSize = note.fontSize || '16px';

Â  Â  Â  Â  Â  Â  previewContainer.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="font-bold text-2xl mb-2 text-purple-300" style="font-family: 'Poppins', sans-serif; font-size: 1.5rem;">${note.title || 'Tanpa Judul'}</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-400 mb-4" style="font-family: 'Poppins', sans-serif; font-size: 0.875rem;">${this.formatDate(note.lastModified)}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="pro-editor-content max-w-none">${note.content}</div>`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  this.dom.previewContent.innerHTML = '';
Â  Â  Â  Â  Â  Â  this.dom.previewContent.appendChild(previewContainer);
Â  Â  Â  Â  Â  Â  this.dom.previewModal.classList.add('show');Â 
Â  Â  Â  Â  }Â 
Â  Â  }
Â  Â Â 
Â  Â  closePreview() { this.dom.previewModal.classList.remove('show'); }
Â  Â Â 
Â  Â  clearEditor() {Â 
Â  Â  Â  Â  this.dom.titleInput.value = '';Â 
Â  Â  Â  Â  this.dom.editorContent.innerHTML = '';Â 
Â  Â  Â  Â  this.dom.tagsInput.value = '';Â 
Â  Â  Â  Â  this.dom.moodSelector.value = 'neutral';Â 
Â  Â  Â  Â  this.dom.dateFilter.value = new Date().toISOString().split('T')[0];Â 
Â  Â  Â  Â  this.currentNoteId = null;Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Reset gaya ke default
Â  Â  Â  Â  this.dom.editorContent.style.fontSize = '16px';
Â  Â  Â  Â  this.dom.fontSizeInput.value = 16;
Â  Â  Â  Â  this.dom.editorContent.style.fontFamily = "'Poppins', sans-serif";
Â  Â  Â  Â  this.dom.fontSelect.value = "'Poppins', sans-serif";

Â  Â  Â  Â  this.updateStatusBar();Â 
Â  Â  }
Â  Â Â 
Â  Â  addNewNote() { this.clearEditor(); this.dom.titleInput.focus(); showMessage('Editor siap untuk catatan baru.', 'info'); }
Â  Â Â 
Â  Â  filterNotes() {Â 
Â  Â  Â  Â  const query = this.dom.searchInput.value.toLowerCase();Â 
Â  Â  Â  Â  const mood = this.dom.moodFilter.value;Â 
Â  Â  Â  Â  let filtered = this.notes;Â 
Â  Â  Â  Â  if (query) {Â 
Â  Â  Â  Â  Â  Â  filtered = filtered.filter(note => (note.title && note.title.toLowerCase().includes(query)) || (!note.isLocked && this.truncateContent(note.content, 10000).toLowerCase().includes(query)) || (note.tags && note.tags.some(tag => tag.toLowerCase().includes(query))));Â 
Â  Â  Â  Â  }Â 
Â  Â  Â  Â  if (mood) {Â 
Â  Â  Â  Â  Â  Â  filtered = filtered.filter(note => note.mood === mood);Â 
Â  Â  Â  Â  }Â 
Â  Â  Â  Â  this.displayNotes(filtered);Â 
Â  Â  }
Â  Â Â 
Â  Â  formatDate(dateString) { return dateString ? new Date(dateString).toLocaleDateString('id-ID', { day: '2-digit', month: '2-digit', year: 'numeric' }) : ''; }
Â  Â Â 
Â  Â  truncateContent(html, length) { const text = html.replace(/<[^>]*>/g, ''); if (text.length <= length) return text; return text.substring(0, length) + '...'; }

Â  Â  async exportSingleNoteToPdf(noteId) {
Â  Â  Â  Â  const note = this.notes.find(n => n.id === noteId);
Â  Â  Â  Â  if (!note) {
Â  Â  Â  Â  Â  Â  showMessage('Catatan tidak ditemukan.', 'error');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  if (note.isLocked) {
Â  Â  Â  Â  Â  Â  showMessage('Buka kunci catatan sebelum mengekspor.', 'error');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  showMessage(`Mempersiapkan ekspor PDF untuk "${note.title || 'catatan'}"...`, 'info');

Â  Â  Â  Â  const { jsPDF } = window.jspdf;
Â  Â  Â  Â  const doc = new jsPDF('p', 'mm', 'a4');

Â  Â  Â  Â  // Buat elemen tersembunyi untuk rendering
Â  Â  Â  Â  const renderDiv = document.createElement('div');
Â  Â  Â  Â  renderDiv.style.position = 'absolute';
Â  Â  Â  Â  renderDiv.style.left = '-9999px';
Â  Â  Â  Â  renderDiv.style.width = '700px'; // Lebar yang cukup untuk rendering berkualitas
Â  Â  Â  Â  renderDiv.style.padding = '20px';
Â  Â  Â  Â  renderDiv.style.fontFamily = note.fontFamily || "'Poppins', sans-serif";
Â  Â  Â  Â  renderDiv.style.fontSize = note.fontSize || '16px';
Â  Â  Â  Â  renderDiv.style.color = '#000'; // Warna teks dasar untuk PDF
Â  Â  Â  Â  renderDiv.style.background = '#fff';
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Sanitasi konten untuk rendering
Â  Â  Â  Â  const tempContentDiv = document.createElement('div');
Â  Â  Â  Â  tempContentDiv.innerHTML = note.content;
Â  Â  Â  Â  // Ganti iframe dengan placeholder atau gambar thumbnail
Â  Â  Â  Â  tempContentDiv.querySelectorAll('iframe').forEach(iframe => {
Â  Â  Â  Â  Â  Â  const placeholder = document.createElement('div');
Â  Â  Â  Â  Â  Â  placeholder.style.border = '1px dashed #ccc';
Â  Â  Â  Â  Â  Â  placeholder.style.padding = '10px';
Â  Â  Â  Â  Â  Â  placeholder.style.textAlign = 'center';
Â  Â  Â  Â  Â  Â  placeholder.textContent = `[Konten tersemat dari: ${new URL(iframe.src).hostname}]`;
Â  Â  Â  Â  Â  Â  iframe.parentNode.replaceChild(placeholder, iframe);
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  renderDiv.innerHTML = `<h1>${note.title || 'Tanpa Judul'}</h1><hr><p><small>Terakhir diubah: ${this.formatDate(note.lastModified)}</small></p>${tempContentDiv.innerHTML}`;
Â  Â  Â  Â  document.body.appendChild(renderDiv);

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const canvas = await html2canvas(renderDiv, {
Â  Â  Â  Â  Â  Â  Â  Â  scale: 2, // Meningkatkan resolusi
Â  Â  Â  Â  Â  Â  Â  Â  useCORS: true,
Â  Â  Â  Â  Â  Â  Â  Â  logging: false,
Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: '#ffffff'
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  const imgData = canvas.toDataURL('image/png');
Â  Â  Â  Â  Â  Â  const imgProps = doc.getImageProperties(imgData);
Â  Â  Â  Â  Â  Â  const pdfWidth = doc.internal.pageSize.getWidth();
Â  Â  Â  Â  Â  Â  const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let heightLeft = pdfHeight;
Â  Â  Â  Â  Â  Â  let position = 0;
Â  Â  Â  Â  Â  Â  const margin = 10;

Â  Â  Â  Â  Â  Â  doc.addImage(imgData, 'PNG', margin, position, pdfWidth - (margin*2), pdfHeight - (margin*2));
Â  Â  Â  Â  Â  Â  heightLeft -= (doc.internal.pageSize.getHeight() - (margin*2));

Â  Â  Â  Â  Â  Â  while (heightLeft >= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  position = heightLeft - pdfHeight;
Â  Â  Â  Â  Â  Â  Â  Â  doc.addPage();
Â  Â  Â  Â  Â  Â  Â  Â  doc.addImage(imgData, 'PNG', margin, position - margin, pdfWidth - (margin*2), pdfHeight - margin);
Â  Â  Â  Â  Â  Â  Â  Â  heightLeft -= (doc.internal.pageSize.getHeight() - (margin*2));
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  doc.save(`Catatan_${(note.title || 'Untitled').replace(/ /g, '_')}.pdf`);
Â  Â  Â  Â  Â  Â  showMessage('PDF berhasil diekspor!', 'success');

Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  console.error("Gagal mengekspor PDF:", error);
Â  Â  Â  Â  Â  Â  showMessage('Gagal membuat PDF. Lihat konsol untuk detail.', 'error');
Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  document.body.removeChild(renderDiv);
Â  Â  Â  Â  }
Â  Â  }
}

// ===================================================================================
// ========================== BAGIAN 2: LOGIKA APLIKASI UTAMA ========================
// ===================================================================================

let currentSection = 'dashboard';Â 
let currentDate = new Date();Â 
let currentMode = 'personal';Â 
let timerInterval;Â 
let timerMinutes = 25;Â 
let timerSeconds = 0;Â 
let isTimerRunning = false;Â 
let touchStartX = 0;Â 
let touchEndX = 0;Â 
let isDragging = false;Â 

let masterDateRange = '7d';Â 
let financeDateRange = { start: null, end: null };
let dateRangeSource = 'dashboard';

const storage = {Â 
Â  Â  get: (key, defaultValue = null) => {Â 
Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  const item = localStorage.getItem(key);Â 
Â  Â  Â  Â  Â  Â  return item ? JSON.parse(item) : defaultValue;Â 
Â  Â  Â  Â  } catch {Â 
Â  Â  Â  Â  Â  Â  return defaultValue;Â 
Â  Â  Â  Â  }Â 
Â  Â  },Â 
Â  Â  set: (key, value) => {Â 
Â  Â  Â  Â  localStorage.setItem(key, JSON.stringify(value));Â 
Â  Â  },Â 
Â  Â  getAppData: () => {Â 
Â  Â  Â  Â  return storage.get('lifeHubData_v6.2.0', {Â 
Â  Â  Â  Â  Â  Â  currentMode: 'personal',Â 
Â  Â  Â  Â  Â  Â  theme: 'dark',Â 
Â  Â  Â  Â  Â  Â  isVideoMuted: true,Â 
Â  Â  Â  Â  Â  Â  personal: { transactions: [], tasks: [], splitBills: [], portals: [] },Â 
Â  Â  Â  Â  Â  Â  business: { transactions: [], tasks: [], splitBills: [], portals: [] }Â 
Â  Â  Â  Â  });Â 
Â  Â  },Â 
Â  Â  saveAppData: (data) => {Â 
Â  Â  Â  Â  storage.set('lifeHubData_v6.2.0', data);Â 
Â  Â  }Â 
};

// Instance untuk Editor HTML
let htmlEditorApp;

document.addEventListener('DOMContentLoaded', function() {Â 
Â  Â  initializeApp();Â 
Â  Â  setupEventListeners();Â 
Â  Â  const notesApp = new NotesApp();Â 
Â  Â  notesApp.init();Â 
Â  Â  // Inisialisasi Editor HTML
Â  Â  htmlEditorApp = new HtmlEditorApp();
Â  Â  htmlEditorApp.init();
});

async function initializeApp() {
Â  Â  // Fitur background premium, jadi bagian ini dinonaktifkan di versi gratis
Â  Â  // const bgMediaBlob = await getFileFromDB('customBackground');
Â  Â  // ... sisa kode background dihapus ...

Â  Â  const appData = storage.getAppData();
Â  Â  currentMode = appData.currentMode || 'personal';
Â  Â  document.getElementById('modeSelect').value = currentMode;
Â  Â Â 
Â  Â  if (appData.theme === 'light') {
Â  Â  Â  Â  document.body.classList.add('light-mode');
Â  Â  } else if (appData.theme === 'black') {
Â  Â  Â  Â  document.body.classList.add('black-mode');
Â  Â  }
Â  Â  updateThemeUI(appData.theme || 'dark');
Â  Â Â 
Â  Â  const splitBillDateInput = document.getElementById('splitBillDate');
Â  Â  if (splitBillDateInput) {
Â  Â  Â  Â  splitBillDateInput.value = new Date().toISOString().split('T')[0];
Â  Â  }
Â  Â  switchSection('dashboard');
Â  Â  renderPortals();
}

function setupEventListeners() {Â 
Â  Â  document.querySelectorAll('.nav-item').forEach(item => item.addEventListener('click', () => switchSection(item.dataset.section)));Â 
Â  Â  document.getElementById('mobileMenuBtn').addEventListener('click', toggleMobileMenu);Â 
Â  Â  document.getElementById('overlay').addEventListener('click', closeMobileMenu);Â 
Â  Â  document.getElementById('themeToggle').addEventListener('click', toggleTheme);Â 
Â  Â  document.getElementById('modeSelect').addEventListener('change', switchMode);Â 
Â  Â  document.getElementById('logo-container').addEventListener('click', enterPreviewMode);Â 
Â  Â  document.getElementById('addTransactionBtn').addEventListener('click', () => showTransactionModal());Â 
Â  Â  document.getElementById('exportFinanceBtn').addEventListener('click', exportFinancePDF);Â 
Â  Â  document.getElementById('searchTransaction').addEventListener('input', filterAndRenderTransactions);Â 
Â  Â  document.getElementById('categoryFilter').addEventListener('change', filterAndRenderTransactions);Â 
Â  Â  document.getElementById('typeFilter').addEventListener('change', filterAndRenderTransactions);Â 
Â  Â  document.getElementById('financeDateFilterBtn').addEventListener('click', () => showDateRangeModal('finance'));Â 
Â  Â  document.getElementById('taskForm').addEventListener('submit', saveTask);Â 
Â  Â  document.getElementById('startTimerBtn').addEventListener('click', startTimer);Â 
Â  Â  document.getElementById('pauseTimerBtn').addEventListener('click', pauseTimer);Â 
Â  Â  document.getElementById('resetTimerBtn').addEventListener('click', resetTimer);Â 
Â  Â  document.getElementById('prevMonth').addEventListener('click', () => changeMonth(-1));Â 
Â  Â  document.getElementById('nextMonth').addEventListener('click', () => changeMonth(1));Â 
Â  Â  document.getElementById('splitBillForm').addEventListener('submit', calculateSplitBill);Â 
Â  Â  document.getElementById('backupData').addEventListener('click', backupData);Â 
Â  Â  document.getElementById('restoreFile').addEventListener('change', restoreData);
Â  Â  document.getElementById('restoreData').addEventListener('click', () => document.getElementById('restoreFile').click());
Â  Â  document.getElementById('clearAllData').addEventListener('click', () => { showConfirm('Hapus Semua Data?', 'Operasi ini tidak dapat diurungkan. Anda yakin ingin menghapus semua data lokal?', clearAllDataConfirmed); });Â 
Â  Â Â 
Â  Â  // [MODIFIKASI] Event listener untuk fitur premium diubah untuk memanggil modal
Â  Â  document.getElementById('export-pdf-btn').addEventListener('click', () => checkPremiumStatus());
Â  Â  document.getElementById('export-images-btn').addEventListener('click', () => checkPremiumStatus());

Â  Â  document.body.addEventListener('touchstart', handleTouchStart, { passive: true });Â 
Â  Â  document.body.addEventListener('touchend', handleTouchEnd);Â 
Â  Â  document.body.addEventListener('mousedown', handleMouseDown);Â 
Â  Â  document.body.addEventListener('mouseup', handleMouseUp);Â 
Â  Â  setupMasterRangeSelector();Â 
Â  Â  document.getElementById('applyDateRange').addEventListener('click', applyDateRange);Â 
Â  Â  document.getElementById('cancelDateRange').addEventListener('click', () => document.getElementById('dateRangeModal').classList.remove('show'));Â 
Â  Â  document.getElementById('addNewPortalBtn').addEventListener('click', () => {
        if(checkPremiumStatus()) {
            showPortalModal();
        }
    });
Â  Â  document.getElementById('toggle-email-visibility').addEventListener('click', toggleEmailVisibility);

Â  Â  document.addEventListener('visibilitychange', () => {
Â  Â  Â  Â  if (document.hidden) {
Â  Â  Â  Â  Â  Â  document.getElementById('lockSound')?.pause();
Â  Â  Â  Â  }
Â  Â  });
}
function enterPreviewMode() { document.body.classList.add('preview-mode'); } function handleGestureEnd() { const swipeThreshold = 70; const deltaX = touchEndX - touchStartX; if (document.querySelector('.modal.show')) return; if (deltaX < -swipeThreshold) { document.body.classList.remove('preview-mode'); } } function handleTouchStart(e) { touchStartX = e.changedTouches[0].screenX; } function handleTouchEnd(e) { touchEndX = e.changedTouches[0].screenX; handleGestureEnd(); } function handleMouseDown(e) { if (e.button !== 0 || e.target.closest('button, input, select, textarea, a, .modal')) return; isDragging = true; touchStartX = e.screenX; } function handleMouseUp(e) { if (!isDragging) return; isDragging = false; touchEndX = e.screenX; handleGestureEnd(); }
function switchSection(section) {Â 
    if (['notes', 'html-editor'].includes(section)) {
        if (!checkPremiumStatus()) {
            return; 
        }
    }

Â  Â  document.getElementById('lockSound')?.pause();

Â  Â  document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));Â 
Â  Â  document.getElementById(section + '-section').classList.remove('hidden');Â 
Â  Â  document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));Â 
Â  Â  document.querySelector(`[data-section="${section}"]`).classList.add('active');Â 
Â  Â  currentSection = section;Â 
Â  Â  switch(section) {Â 
Â  Â  Â  Â  case 'dashboard': loadDashboard(); break;Â 
Â  Â  Â  Â  case 'finance': loadFinancePage(); break;Â 
Â  Â  Â  Â  case 'tasks': loadTasksPage(); break;Â 
Â  Â  Â  Â  case 'split': loadSplitPage(); break;Â 
Â  Â  Â  Â  case 'notes': break;Â 
Â  Â  Â  Â  case 'settings': break;Â 
Â  Â  Â  Â  case 'html-editor':Â 
Â  Â  Â  Â  Â  Â  if (htmlEditorApp) htmlEditorApp.showWelcomeOrLastNote();
Â  Â  Â  Â  Â  Â  break;
Â  Â  }Â 
Â  Â  closeMobileMenu();Â 
}
function switchMode(e) { currentMode = e.target.value; let appData = storage.getAppData(); appData.currentMode = currentMode; storage.saveAppData(appData); switchSection(currentSection); renderPortals(); }Â 

function toggleTheme() {
Â  Â  let currentTheme = 'dark';
Â  Â  if (document.body.classList.contains('light-mode')) {
Â  Â  Â  Â  currentTheme = 'light';
Â  Â  } else if (document.body.classList.contains('black-mode')) {
Â  Â  Â  Â  currentTheme = 'black';
Â  Â  }

Â  Â  let nextTheme;
Â  Â  document.body.classList.remove('light-mode', 'black-mode');

Â  Â  if (currentTheme === 'dark') {
Â  Â  Â  Â  nextTheme = 'light';
Â  Â  Â  Â  document.body.classList.add('light-mode');
Â  Â  } else if (currentTheme === 'light') {
Â  Â  Â  Â  nextTheme = 'black';
Â  Â  Â  Â  document.body.classList.add('black-mode');
Â  Â  } else {
Â  Â  Â  Â  nextTheme = 'dark';
Â  Â  }

Â  Â  let appData = storage.getAppData();
Â  Â  appData.theme = nextTheme;
Â  Â  storage.saveAppData(appData);
Â  Â  updateThemeUI(nextTheme);
}

function updateThemeUI(theme) {
Â  Â  const icon = document.querySelector('#themeToggle i');
Â  Â  icon.classList.remove('fa-sun', 'fa-moon', 'fa-star');

Â  Â  if (theme === 'dark') {
Â  Â  Â  Â  icon.classList.add('fa-sun');
Â  Â  } else if (theme === 'light') {
Â  Â  Â  Â  icon.classList.add('fa-moon');
Â  Â  } else {
Â  Â  Â  Â  icon.classList.add('fa-star');
Â  Â  }
Â  Â Â 
Â  Â  if (currentSection === 'dashboard') {
Â  Â  Â  Â  refreshDashboardData();
Â  Â  }
Â  Â  renderPortals();
}

function toggleMobileMenu() {Â 
Â  Â  document.getElementById('sidebar').classList.toggle('open');Â 
Â  Â  document.getElementById('overlay').classList.toggle('show');Â 
Â  Â  // [BARU] Tambahkan/hapus kelas pada body untuk watermark
Â  Â  document.body.classList.toggle('sidebar-is-open');
}Â 
function closeMobileMenu() {Â 
Â  Â  document.getElementById('sidebar').classList.remove('open');Â 
Â  Â  document.getElementById('overlay').classList.remove('show');Â 
Â  Â  // [BARU] Hapus kelas dari body
Â  Â  document.body.classList.remove('sidebar-is-open');
}

function loadDashboard() { const appData = storage.getAppData(); const modeData = appData[currentMode]; const balance = modeData.transactions.reduce((sum, t) => sum + (t.type === 'income' ? t.amount : -t.amount), 0); const today = new Date().toISOString().split('T')[0]; const todayTasks = modeData.tasks.filter(p => p.datetime && p.datetime.startsWith(today) && !p.completed).length; const pendingTasks = modeData.tasks.filter(t => !t.completed).length; document.getElementById('totalBalance').textContent = formatCurrency(balance); document.getElementById('todayTasksCount').textContent = todayTasks; document.getElementById('pendingTasks').textContent = pendingTasks; document.getElementById('activeMode').textContent = currentMode === 'personal' ? 'Pribadi' : 'Bisnis'; refreshDashboardData(); }
function refreshDashboardData() { updateDashboardCharts(); loadAnalysisCharts(); loadRecentActivities(); } function loadRecentActivities() { const appData = storage.getAppData(); const modeData = appData[currentMode]; const activities = []; const filteredTransactions = filterDataByRange(modeData.transactions, masterDateRange, 'date'); const filteredTasks = filterDataByRange(modeData.tasks, masterDateRange, 'datetime'); const filteredSplits = filterDataByRange(modeData.splitBills, masterDateRange, 'date'); filteredTransactions.forEach(t => activities.push({ type: 'transaction', icon: t.type === 'income' ? 'fa-arrow-up text-green-500' : 'fa-arrow-down text-pink-500', text: `${t.type === 'income' ? 'Pemasukan' : 'Pengeluaran'}: ${formatCurrency(t.amount)}`, time: t.date })); filteredTasks.forEach(p => activities.push({ type: 'task', icon: 'fa-calendar-check text-blue-500', text: `Tugas: ${p.title}`, time: p.datetime })); filteredSplits.forEach(s => activities.push({ type: 'split', icon: 'fa-receipt text-green-500', text: `Split Bill: ${formatCurrency(s.totalBill)}`, time: s.date })); activities.sort((a, b) => new Date(b.time) - new Date(a.time)); const container = document.getElementById('recentActivities'); container.innerHTML = activities.length > 0 ? activities.slice(0, 15).map(activity => `<div class="flex items-center justify-between p-2 hover:bg-purple-500/10 rounded"><div class="flex items-center"><i class="fas ${activity.icon} mr-3"></i><span>${activity.text}</span></div><span class="text-sm text-gray-400">${formatDate(activity.time)}</span></div>`).join('') : '<p class="text-gray-500">Tidak ada aktivitas dalam rentang waktu ini.</p>'; }
function loadFinancePage() { populateFinanceFilters(); filterAndRenderTransactions(); updateFinanceSummary(); } function updateFinanceSummary() { const appData = storage.getAppData(); const transactions = appData[currentMode].transactions; const income = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0); const expense = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0); document.getElementById('totalIncome').textContent = formatCurrency(income); document.getElementById('totalExpense').textContent = formatCurrency(expense); document.getElementById('balance').textContent = formatCurrency(income - expense); }Â 
function filterAndRenderTransactions() { const appData = storage.getAppData(); let transactions = appData[currentMode].transactions; const search = document.getElementById('searchTransaction').value.toLowerCase(); const category = document.getElementById('categoryFilter').value; const type = document.getElementById('typeFilter').value; if (search) transactions = transactions.filter(t => t.description.toLowerCase().includes(search)); if (category) transactions = transactions.filter(t => t.category === category); if (type) transactions = transactions.filter(t => t.type === type); if (financeDateRange.start && financeDateRange.end) { transactions = transactions.filter(t => { const tDate = new Date(t.date); return tDate >= new Date(financeDateRange.start) && tDate <= new Date(financeDateRange.end); }); } displayTransactions(transactions); }Â 
function displayTransactions(transactions) { const container = document.getElementById('transactionsList'); if (transactions.length === 0) { container.innerHTML = '<p class="text-center text-gray-500">Belum ada transmisi data</p>'; return; } container.innerHTML = [...transactions].reverse().map(t => `<div class="p-4 rounded-md flex justify-between items-center hover:bg-purple-500/10 cursor-pointer ${t.type}" onclick="showTransactionModal('${t.id}')"><div class="flex items-center"><i class="fas ${getTransactionIcon(t.category)} mr-4 text-xl"></i><div><h4 class="font-semibold">${t.description}</h4><p class="text-sm text-gray-400">${getCategoryName(t.category)} â€¢ ${formatDate(t.date)}</p></div></div><div class="text-right"><p class="font-bold font-mono ${t.type === 'income' ? 'text-green-500' : 'text-pink-500'}">${t.type === 'income' ? '+' : '-'}${formatCurrency(t.amount)}</p><button onclick="confirmDeleteTransaction('${t.id}', event)" class="text-red-500 hover:text-red-400 ml-2 text-xs"><i class="fas fa-trash"></i></button></div></div>`).join(''); } function showTransactionModal(id = null) { const appData = storage.getAppData(); const transaction = id ? appData[currentMode].transactions.find(t => t.id === id) : null; const content = `<div class="flex justify-between items-center mb-4"><h3 class="text-xl font-semibold text-purple-600">${id ? 'Edit' : 'Tambah'} Transaksi</h3><button class="closeModal text-gray-400 hover:text-purple-600"><i class="fas fa-times"></i></button></div><form id="transactionForm" class="space-y-4"><input type="hidden" id="transactionId" value="${id || ''}"><div><label class="block text-sm font-medium mb-1">Tipe</label><select id="transactionType" class="custom-input" required>${['income', 'expense'].map(o => `<option value="${o}" ${transaction?.type === o ? 'selected' : ''}>${o === 'income' ? 'Pemasukan' : 'Pengeluaran'}</option>`).join('')}</select></div><div><label class="block text-sm font-medium mb-1">Jumlah</label><input type="number" id="transactionAmount" class="custom-input" value="${transaction?.amount || ''}" required></div><div><label class="block text-sm font-medium mb-1">Kategori</label><select id="transactionCategory" class="custom-input" required>${Object.keys(getCategoryName()).map(c => `<option value="${c}" ${transaction?.category === c ? 'selected' : ''}>${getCategoryName(c)}</option>`).join('')}</select></div><div><label class="block text-sm font-medium mb-1">Deskripsi</label><input type="text" id="transactionDescription" class="custom-input" value="${transaction?.description || ''}" required></div><div><label class="block text-sm font-medium mb-1">Tanggal</label><input type="date" id="transactionDate" class="custom-input" value="${transaction?.date || new Date().toISOString().split('T')[0]}" required></div><div class="flex gap-2 mt-6"><button type="submit" class="custom-button flex-1">Simpan</button><button type="button" class="closeModal custom-button custom-button-danger">Batal</button></div></form>`; showModal(content); document.getElementById('transactionForm').addEventListener('submit', saveTransaction); } function saveTransaction(e) { e.preventDefault(); const id = document.getElementById('transactionId').value || generateId(); const newTransaction = { id, type: document.getElementById('transactionType').value, amount: parseFloat(document.getElementById('transactionAmount').value), category: document.getElementById('transactionCategory').value, description: document.getElementById('transactionDescription').value, date: document.getElementById('transactionDate').value, }; let appData = storage.getAppData(); if (document.getElementById('transactionId').value) { const index = appData[currentMode].transactions.findIndex(t => t.id === id); if (index > -1) appData[currentMode].transactions[index] = newTransaction; } else { appData[currentMode].transactions.push(newTransaction); } storage.saveAppData(appData); loadFinancePage(); closeModal(); showMessage("Transaksi disimpan!", "success"); } function confirmDeleteTransaction(id, event) { event.stopPropagation(); showConfirm('Hapus Transaksi?', 'Yakin ingin menghapus transmisi data ini?', () => deleteTransaction(id)); } function deleteTransaction(id) { let appData = storage.getAppData(); appData[currentMode].transactions = appData[currentMode].transactions.filter(t => t.id !== id); storage.saveAppData(appData); loadFinancePage(); } function populateFinanceFilters() { const appData = storage.getAppData(); const categories = [...new Set(appData[currentMode].transactions.map(t => t.category))]; const categoryFilter = document.getElementById('categoryFilter'); categoryFilter.innerHTML = '<option value="">Semua Kategori</option>' + categories.map(c => `<option value="${c}">${getCategoryName(c)}</option>`).join(''); const typeFilter = document.getElementById('typeFilter'); typeFilter.innerHTML = '<option value="">Semua Tipe</option><option value="income">Pemasukan</option><option value="expense">Pengeluaran</option>'; }
function loadTasksPage() { renderTasks(); generateCalendar(); } function renderTasks() { const appData = storage.getAppData(); const tasks = appData[currentMode].tasks; const list = document.getElementById('taskList'); list.innerHTML = ''; const sortedTasks = [...tasks].sort((a, b) => new Date(a.datetime) - new Date(b.datetime)); if (sortedTasks.length === 0) { list.innerHTML = '<p class="text-gray-500 text-center">Tidak ada tugas. Waktunya bersantai!</p>'; return; } sortedTasks.forEach(task => { const item = document.createElement('div'); item.className = `task-item p-3 rounded-lg flex justify-between items-center hover:bg-purple-500/10 ${task.completed ? 'completed' : ''}`; const priorityColor = { high: '#f472b6', medium: '#fbbf24', low: '#4ade80' }; item.innerHTML = `<div class="flex items-center"><input type="checkbox" ${task.completed ? 'checked' : ''} onchange="toggleTask('${task.id}')" class="w-5 h-5 rounded bg-purple-900/50 border-purple-400 text-purple-600 focus:ring-purple-500"><div class="ml-4"><strong class="block">${task.title}</strong><small class="text-gray-400">${formatDateTime(task.datetime)} | <span style="color: ${priorityColor[task.priority]}">â—</span> ${task.priority}</small></div></div><button onclick="confirmDeleteTask('${task.id}')" class="text-red-500 hover:text-red-400"><i class="fas fa-trash"></i></button>`; list.appendChild(item); }); } function saveTask(e) { e.preventDefault(); const task = { id: generateId(), title: document.getElementById('taskTitle').value, datetime: document.getElementById('taskDateTime').value, priority: document.getElementById('taskPriority').value, completed: false, }; let appData = storage.getAppData(); appData[currentMode].tasks.push(task); storage.saveAppData(appData); renderTasks(); generateCalendar(); document.getElementById('taskForm').reset(); showMessage("Tugas ditambahkan!", "success"); } function toggleTask(id) { let appData = storage.getAppData(); const task = appData[currentMode].tasks.find(t => t.id === id); if (task) { task.completed = !task.completed; storage.saveAppData(appData); renderTasks(); generateCalendar(); } } function confirmDeleteTask(id) { showConfirm('Hapus Tugas?', 'Yakin ingin menghapus tugas ini?', () => deleteTask(id)); } function deleteTask(id) { let appData = storage.getAppData(); appData[currentMode].tasks = appData[currentMode].tasks.filter(t => t.id !== id); storage.saveAppData(appData); renderTasks(); generateCalendar(); }
function generateCalendar() { const calendar = document.getElementById('calendar'); document.getElementById('currentMonth').textContent = new Intl.DateTimeFormat('id-ID', { month: 'long', year: 'numeric' }).format(currentDate); calendar.innerHTML = ''; const year = currentDate.getFullYear(); const month = currentDate.getMonth(); const firstDay = new Date(year, month, 1).getDay(); const daysInMonth = new Date(year, month + 1, 0).getDate(); const appData = storage.getAppData(); const tasks = appData[currentMode].tasks; const days = ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab']; days.forEach(day => calendar.innerHTML += `<div class="text-center font-bold text-purple-400 text-sm">${day}</div>`); for (let i = 0; i < firstDay; i++) calendar.innerHTML += '<div></div>'; for (let day = 1; day <= daysInMonth; day++) { const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`; const dayTasks = tasks.filter(t => t.datetime && t.datetime.startsWith(dateStr)); const isToday = new Date().toDateString() === new Date(year, month, day).toDateString(); let dayClass = 'text-center p-2 border border-transparent rounded-md transition-colors duration-300 relative'; if (isToday) dayClass += ' border-purple-400 bg-purple-500/10'; let priorityIndicator = ''; if (dayTasks.length > 0) { const hasHigh = dayTasks.some(t => t.priority === 'high' && !t.completed); const hasMedium = dayTasks.some(t => t.priority === 'medium' && !t.completed); const hasLow = dayTasks.some(t => t.priority === 'low' && !t.completed); let indicatorColor = ''; if (hasHigh) indicatorColor = '#f472b6'; else if (hasMedium) indicatorColor = '#fbbf24'; else if (hasLow) indicatorColor = '#4ade80'; if (indicatorColor) { priorityIndicator = `<span class="absolute top-1 right-1 h-2 w-2 rounded-full" style="background-color: ${indicatorColor};"></span>`; } } calendar.innerHTML += `<div class="${dayClass}">${day}${priorityIndicator}</div>`; } }
function changeMonth(dir) { currentDate.setMonth(currentDate.getMonth() + dir); generateCalendar(); }
function startTimer() { if (isTimerRunning) return; isTimerRunning = true; timerInterval = setInterval(() => { if (timerSeconds === 0) { if (timerMinutes === 0) { resetTimer(); showMessage("Pomodoro Selesai!", "success"); return; } timerMinutes--; timerSeconds = 59; } else { timerSeconds--; } updateTimerDisplay(); }, 1000); } function pauseTimer() { isTimerRunning = false; clearInterval(timerInterval); } function resetTimer() { pauseTimer(); timerMinutes = 25; timerSeconds = 0; updateTimerDisplay(); } function updateTimerDisplay() { document.getElementById('timerDisplay').textContent = `${String(timerMinutes).padStart(2, '0')}:${String(timerSeconds).padStart(2, '0')}`; }
function loadSplitPage() { document.getElementById('splitBillDate').value = new Date().toISOString().split('T')[0]; renderSplitHistory(); } function calculateSplitBill(e) { e.preventDefault(); const totalBill = parseFloat(document.getElementById('totalBill').value); const billDate = document.getElementById('splitBillDate').value; const peopleNames = document.getElementById('peopleNames').value.split(',').map(name => name.trim()).filter(name => name); const percentagesStr = document.getElementById('splitPercentages').value; const percentages = percentagesStr ? percentagesStr.split(',').map(p => parseFloat(p.trim())) : []; if (peopleNames.length === 0) { showMessage('Harap masukkan setidaknya satu nama.', 'error'); return; } let results; if (percentages.length > 0) { if (percentages.length !== peopleNames.length) { showMessage('Jumlah nama dan persentase harus sama.', 'error'); return; } const totalPercentage = percentages.reduce((sum, p) => sum + p, 0); if (Math.round(totalPercentage) !== 100) { showMessage(`Total persentase harus 100%, bukan ${totalPercentage}%.`, 'error'); return; } if (percentages.some(isNaN)) { showMessage('Mohon masukkan persentase yang valid.', 'error'); return; } results = peopleNames.map((name, index) => ({ name, amount: (totalBill * percentages[index]) / 100, percentage: percentages[index] })); } else { const amountPerPerson = totalBill / peopleNames.length; results = peopleNames.map(name => ({ name, amount: amountPerPerson })); } const splitBill = { id: generateId(), totalBill, results, date: billDate, type: percentages.length > 0 ? 'custom' : 'equal' }; let appData = storage.getAppData(); appData[currentMode].splitBills.push(splitBill); storage.saveAppData(appData); displaySplitResults(results, totalBill, billDate); renderSplitHistory(); document.getElementById('splitBillForm').reset(); document.getElementById('splitBillDate').value = new Date().toISOString().split('T')[0]; } function displaySplitResults(results, totalBill, date) { const resultDiv = document.getElementById('splitResult'); resultDiv.innerHTML = `<h4 class="font-bold mb-2">Total: ${formatCurrency(totalBill)}</h4>` + results.map(r => `<div class="flex justify-between p-2 border-b border-purple-900/50"><span>${r.name} ${r.percentage ? `(${r.percentage}%)` : ''}</span><strong>${formatCurrency(r.amount)}</strong></div>`).join(''); document.getElementById('splitResultCard').classList.remove('hidden'); document.getElementById('exportSplitBtn').onclick = () => exportSplitBillPDF(results, totalBill, date); } function renderSplitHistory() { const appData = storage.getAppData(); const history = appData[currentMode].splitBills; const container = document.getElementById('splitHistory'); container.innerHTML = [...history].reverse().map(split => `<div class="p-3 rounded-md border border-purple-900/50 hover:bg-purple-500/10"><div class="flex justify-between items-center"><div><strong class="block text-blue-400">${formatCurrency(split.totalBill)}</strong><small class="text-gray-400">${formatDate(split.date)} | ${split.results.length} orang | <span class="font-semibold ${split.type === 'custom' ? 'text-pink-400' : 'text-green-400'}">${split.type === 'custom' ? 'Kustom' : 'Merata'}</span></small></div><button onclick="confirmDeleteSplit('${split.id}')" class="text-red-500 hover:text-red-400"><i class="fas fa-trash"></i></button></div></div>`).join('') || '<p class="text-gray-500 text-center">Tidak ada riwayat.</p>'; } function confirmDeleteSplit(id) { showConfirm('Hapus Riwayat?', 'Yakin ingin menghapus riwayat split bill ini?', () => deleteSplit(id)); } function deleteSplit(id) { let appData = storage.getAppData(); appData[currentMode].splitBills = appData[currentMode].splitBills.filter(s => s.id !== id); storage.saveAppData(appData); renderSplitHistory(); }

async function backupData() {
Â  Â  showMessage("Memulai proses backup... Mengumpulkan data.", "info");
Â  Â  try {
Â  Â  Â  Â  const zip = new JSZip();
Â  Â  Â  Â  const lifeHubData = storage.getAppData();
Â  Â  Â  Â  const notesData = storage.get('notes_v5.9.0', []);
Â  Â  Â  Â  const htmlNotesData = storage.get('lifeHub_htmlNotes_v6.2.0', []);Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Proses media dari catatan
Â  Â  Â  Â  const { processedNotes, mediaFiles } = await processMediaForBackup(notesData);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Tambahkan file media ke ZIP
Â  Â  Â  Â  for (const [path, blob] of Object.entries(mediaFiles)) {
Â  Â  Â  Â  Â  Â  zip.file(path, blob);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  const allData = {
Â  Â  Â  Â  Â  Â  lifeHub: lifeHubData,
Â  Â  Â  Â  Â  Â  notes: processedNotes,
Â  Â  Â  Â  Â  Â  htmlNotes: htmlNotesData,
Â  Â  Â  Â  };

Â  Â  Â  Â  zip.file("data.json", JSON.stringify(allData, null, 2));

Â  Â  Â  Â  const zipBlob = await zip.generateAsync({ type: "blob" });
Â  Â  Â  Â  const url = URL.createObjectURL(zipBlob);
Â  Â  Â  Â  const a = document.createElement('a');
Â  Â  Â  Â  a.href = url;
Â  Â  Â  Â  a.download = `lifehub-backup-${new Date().toISOString().split('T')[0]}.zip`;
Â  Â  Â  Â  a.click();
Â  Â  Â  Â  URL.revokeObjectURL(url);
Â  Â  Â  Â  showMessage("Backup ZIP berhasil diunduh!", "success");
Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("Gagal membuat backup ZIP:", error);
Â  Â  Â  Â  showMessage("Gagal membuat backup. Lihat konsol untuk detail.", "error");
Â  Â  }
}

async function processMediaForBackup(notes) {
Â  Â  const mediaFiles = {};
Â  Â  const processedNotes = [];

Â  Â  for (const note of notes) {
Â  Â  Â  Â  let newContent = note.content;
Â  Â  Â  Â  const tempDiv = document.createElement('div');
Â  Â  Â  Â  tempDiv.innerHTML = note.content;

Â  Â  Â  Â  // Proses media inline (base64)
Â  Â  Â  Â  const mediaElements = tempDiv.querySelectorAll('img[src^="data:"], video[src^="data:"]');
Â  Â  Â  Â  let mediaIndex = 0;
Â  Â  Â  Â  for(const el of mediaElements) {
Â  Â  Â  Â  Â  Â  const dataUrl = el.src;
Â  Â  Â  Â  Â  Â  const extension = dataUrl.split('/')[1].split(';')[0];
Â  Â  Â  Â  Â  Â  const filename = `media_catatan/note_${note.id}_${mediaIndex}.${extension}`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const blob = dataURLtoBlob(dataUrl);
Â  Â  Â  Â  Â  Â  mediaFiles[filename] = blob;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  el.src = filename; // Ganti src di HTML
Â  Â  Â  Â  Â  Â  mediaIndex++;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Proses attachment ZIP
Â  Â  Â  Â  if (note.attachments && note.attachments.length > 0) {
Â  Â  Â  Â  Â  Â  for (const attachment of note.attachments) {
Â  Â  Â  Â  Â  Â  Â  Â  if (attachment.dataUrl) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const zipFilename = `media_catatan/${attachment.id}_${attachment.name}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const zipBlob = dataURLtoBlob(attachment.dataUrl);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mediaFiles[zipFilename] = zipBlob;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Hapus dataUrl dari JSON untuk menghemat ruang
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  delete attachment.dataUrl;Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  processedNotes.push({ ...note, content: tempDiv.innerHTML });
Â  Â  }
Â  Â  return { processedNotes, mediaFiles };
}

async function restoreData() {
Â  Â  const file = document.getElementById('restoreFile').files[0];
Â  Â  if (!file) {
Â  Â  Â  Â  showMessage("Pilih file .zip untuk restore.", "error");
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  try {
Â  Â  Â  Â  const zip = await JSZip.loadAsync(file);
Â  Â  Â  Â  const dataFile = zip.file("data.json");
Â  Â  Â  Â  if (!dataFile) throw new Error("File data.json tidak ditemukan di dalam ZIP.");

Â  Â  Â  Â  const content = await dataFile.async("string");
Â  Â  Â  Â  const data = JSON.parse(content);

Â  Â  Â  Â  if (!data.lifeHub || !data.notes) {
Â  Â  Â  Â  Â  Â  throw new Error("Struktur file backup tidak valid.");
Â  Â  Â  Â  }

Â  Â  Â  Â  showConfirm('Timpa Data Lokal?', 'Data dari backup akan menimpa data lokal Anda. Lanjutkan?', async () => {
Â  Â  Â  Â  Â  Â  await clearAllDataConfirmed(false); // Hapus data tanpa notifikasi

Â  Â  Â  Â  Â  Â  // Restore notes with media
Â  Â  Â  Â  Â  Â  const restoredNotes = [];
Â  Â  Â  Â  Â  Â  for (const note of data.notes) {
Â  Â  Â  Â  Â  Â  Â  Â  const tempDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  tempDiv.innerHTML = note.content;

Â  Â  Â  Â  Â  Â  Â  Â  // Restore media inline
Â  Â  Â  Â  Â  Â  Â  Â  const mediaElements = tempDiv.querySelectorAll('img[src^="media_catatan/"], video[src^="media_catatan/"]');
Â  Â  Â  Â  Â  Â  Â  Â  for(const el of mediaElements) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const filePath = el.src.split('/').slice(-2).join('/'); // Ambil path relatif
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const mediaFile = zip.file(filePath);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (mediaFile) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const mediaBlob = await mediaFile.async("blob");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dataUrl = await blobToDataURL(mediaBlob);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.src = dataUrl;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Restore attachment ZIP
Â  Â  Â  Â  Â  Â  Â  Â  if (note.attachments && note.attachments.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for(const attachment of note.attachments) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const zipFilename = `media_catatan/${attachment.id}_${attachment.name}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const zipFile = zip.file(zipFilename);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â if (zipFile) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â const zipBlob = await zipFile.async("blob");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â attachment.dataUrl = await blobToDataURL(zipBlob);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  restoredNotes.push({ ...note, content: tempDiv.innerHTML });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  storage.saveAppData(data.lifeHub);
Â  Â  Â  Â  Â  Â  storage.set('notes_v5.9.0', restoredNotes);
Â  Â  Â  Â  Â  Â  if (data.htmlNotes) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  storage.set('lifeHub_htmlNotes_v6.2.0', data.htmlNotes);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  showMessage("Restore berhasil! Aplikasi akan dimuat ulang.", "success");
Â  Â  Â  Â  Â  Â  setTimeout(() => window.location.reload(), 1500);
Â  Â  Â  Â  });

Â  Â  } catch (err) {
Â  Â  Â  Â  console.error("Gagal restore:", err);
Â  Â  Â  Â  showMessage("File backup korup atau tidak valid.", "error");
Â  Â  }
}

async function clearAllDataConfirmed(notify = true) {
Â  Â  localStorage.removeItem('lifeHubData_v6.2.0');
Â  Â  localStorage.removeItem('notes_v5.9.0');
Â  Â  localStorage.removeItem('lifeHub_htmlNotes_v6.2.0');
Â  Â  localStorage.removeItem('customFonts_v5.5.0');
Â  Â Â 
Â  Â  if (notify) {
Â  Â  Â  Â  initializeApp();
Â  Â  Â  Â  showMessage("Semua data lokal telah dihapus.", "success");
Â  Â  Â  Â  setTimeout(() => window.location.reload(), 1000);
Â  Â  }
}

function dataURLtoBlob(dataUrl) {
Â  Â  const arr = dataUrl.split(',');
Â  Â  const mime = arr[0].match(/:(.*?);/)[1];
Â  Â  const bstr = atob(arr[1]);
Â  Â  let n = bstr.length;
Â  Â  const u8arr = new Uint8Array(n);
Â  Â  while (n--) {
Â  Â  Â  Â  u8arr[n] = bstr.charCodeAt(n);
Â  Â  }
Â  Â  return new Blob([u8arr], { type: mime });
}

function blobToDataURL(blob) {
Â  Â  return new Promise((resolve, reject) => {
Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  reader.onloadend = () => resolve(reader.result);
Â  Â  Â  Â  reader.onerror = reject;
Â  Â  Â  Â  reader.readAsDataURL(blob);
Â  Â  });
}

function exportFinancePDF() {
Â  Â  const { jsPDF } = window.jspdf;
Â  Â  const doc = new jsPDF();
Â  Â  const appData = storage.getAppData();
Â  Â  const transactions = appData[currentMode].transactions;

Â  Â  doc.setFontSize(20);
Â  Â  doc.text('Laporan Keuangan', 20, 20);
Â  Â  doc.setFontSize(12);
Â  Â  doc.text(`Mode: ${currentMode === 'personal' ? 'Pribadi' : 'Bisnis'}`, 20, 30);
Â  Â  doc.text(`Tanggal: ${formatDate(new Date().toISOString())}`, 20, 40);

Â  Â  const tableData = transactions.map(t => [
Â  Â  Â  Â  formatDate(t.date),
Â  Â  Â  Â  t.description,
Â  Â  Â  Â  getCategoryName(t.category),
Â  Â  Â  Â  t.type === 'income' ? formatCurrency(t.amount) : '',
Â  Â  Â  Â  t.type === 'expense' ? formatCurrency(t.amount) : ''
Â  Â  ]);

Â  Â  doc.autoTable({
Â  Â  Â  Â  head: [['Tanggal', 'Deskripsi', 'Kategori', 'Pemasukan', 'Pengeluaran']],
Â  Â  Â  Â  body: tableData,
Â  Â  Â  Â  startY: 50
Â  Â  });

Â  Â  const totalIncome = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
Â  Â  const totalExpense = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
Â  Â  const balance = totalIncome - totalExpense;
Â  Â  let finalY = doc.autoTable.previous.finalY + 10;

Â  Â  doc.setFontSize(12);
Â  Â  doc.text('Total Pemasukan:', 20, finalY);
Â  Â  doc.text(formatCurrency(totalIncome), 190, finalY, { align: 'right' });
Â  Â  finalY += 7;
Â  Â  doc.text('Total Pengeluaran:', 20, finalY);
Â  Â  doc.text(formatCurrency(totalExpense), 190, finalY, { align: 'right' });
Â  Â  finalY += 7;
Â  Â  doc.setFont('helvetica', 'bold');
Â  Â  doc.text('Saldo Akhir:', 20, finalY);
Â  Â  doc.text(formatCurrency(balance), 190, finalY, { align: 'right' });

Â  Â  doc.save(`laporan-keuangan-${currentMode}.pdf`);
}

function exportSplitBillPDF(results, totalBill, date) { const { jsPDF } = window.jspdf; const doc = new jsPDF(); doc.setFontSize(16); doc.text('Laporan Split Bill', 20, 20); doc.setFontSize(12); doc.text(`Total Tagihan: ${formatCurrency(totalBill)}`, 20, 30); doc.text(`Tanggal: ${formatDate(date)}`, 20, 38); const tableData = results.map(r => [r.name, formatCurrency(r.amount)]); doc.autoTable({ head: [['Nama', 'Jumlah Bayar']], body: tableData, startY: 45 }); doc.save('split-bill.pdf'); }

function getChartColors() {
Â  Â  const isLight = document.body.classList.contains('light-mode');
Â  Â  const isBlack = document.body.classList.contains('black-mode');

Â  Â  if (isBlack) {
Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  gridColor: 'rgba(255, 255, 255, 0.15)',
Â  Â  Â  Â  Â  Â  tickColor: '#e5e7eb',
Â  Â  Â  Â  Â  Â  legendColor: '#e5e7eb',
Â  Â  Â  Â  Â  Â  incomeColor: '#00f0ff',
Â  Â  Â  Â  Â  Â  expenseColor: '#ff00ff',
Â  Â  Â  Â  Â  Â  taskColor: '#00ff7f',
Â  Â  Â  Â  Â  Â  incomeBg: 'rgba(0, 240, 255, 0.2)',
Â  Â  Â  Â  Â  Â  expenseBg: 'rgba(255, 0, 255, 0.2)',
Â  Â  Â  Â  Â  Â  taskBg: 'rgba(0, 255, 127, 0.7)',
Â  Â  Â  Â  };
Â  Â  }

Â  Â  if (isLight) {
Â  Â  Â  Â  return {Â 
Â  Â  Â  Â  Â  Â  gridColor: 'rgba(0, 0, 0, 0.1)',Â 
Â  Â  Â  Â  Â  Â  tickColor: '#4b5563',Â 
Â  Â  Â  Â  Â  Â  legendColor: '#1f2937',Â 
Â  Â  Â  Â  Â  Â  incomeColor: '#22c55e',Â 
Â  Â  Â  Â  Â  Â  expenseColor: '#ec4899',Â 
Â  Â  Â  Â  Â  Â  taskColor: '#3b82f6',Â 
Â  Â  Â  Â  Â  Â  incomeBg: 'rgba(34, 197, 94, 0.2)',Â 
Â  Â  Â  Â  Â  Â  expenseBg: 'rgba(236, 72, 153, 0.2)',Â 
Â  Â  Â  Â  Â  Â  taskBg: 'rgba(59, 130, 246, 0.7)',Â 
Â  Â  Â  Â  };
Â  Â  }

Â  Â  return {Â 
Â  Â  Â  Â  gridColor: 'rgba(255, 255, 255, 0.1)',Â 
Â  Â  Â  Â  tickColor: '#d1d5db',Â 
Â  Â  Â  Â  legendColor: '#d1d5db',Â 
Â  Â  Â  Â  incomeColor: '#4ade80',Â 
Â  Â  Â  Â  expenseColor: '#f472b6',Â 
Â  Â  Â  Â  taskColor: '#60a5fa',Â 
Â  Â  Â  Â  incomeBg: 'rgba(74, 222, 128, 0.2)',Â 
Â  Â  Â  Â  expenseBg: 'rgba(244, 114, 182, 0.2)',Â 
Â  Â  Â  Â  taskBg: 'rgba(96, 165, 250, 0.7)',Â 
Â  Â  };
}

Â  Â  function updateDashboardCharts() { updateCashFlowChart(); updateProductivityChart(); } function updateCashFlowChart() { const ctx = document.getElementById('cashFlowChart')?.getContext('2d'); if (!ctx) return; if (window.cashFlowChartInstance) window.cashFlowChartInstance.destroy(); const colors = getChartColors(); const appData = storage.getAppData(); const transactions = filterDataByRange(appData[currentMode].transactions, masterDateRange, 'date'); const { labels, dataPoints } = getTimeBuckets(masterDateRange, transactions, 'date'); const incomeData = new Array(labels.length).fill(0); const expenseData = new Array(labels.length).fill(0); transactions.forEach(t => { const itemDate = new Date(t.date + 'T00:00:00Z'); let bucketIndex = -1; for (let i = dataPoints.length - 1; i >= 0; i--) { if (itemDate >= dataPoints[i]) { bucketIndex = i; break; } } if (bucketIndex !== -1) { if (t.type === 'income') incomeData[bucketIndex] += t.amount; else expenseData[bucketIndex] += t.amount; } }); window.cashFlowChartInstance = new Chart(ctx, { type: 'line', data: { labels, datasets: [ { label: 'Pemasukan', data: incomeData, borderColor: colors.incomeColor, backgroundColor: colors.incomeBg, tension: 0.3, fill: true }, { label: 'Pengeluaran', data: expenseData, borderColor: colors.expenseColor, backgroundColor: colors.expenseBg, tension: 0.3, fill: true } ] }, options: { responsive: true, scales: { y: { beginAtZero: true, grid: { color: colors.gridColor }, ticks: { color: colors.tickColor } }, x: { grid: { color: colors.gridColor }, ticks: { color: colors.tickColor } } }, plugins: { legend: { labels: { color: colors.legendColor } } } } }); } function updateProductivityChart() { const ctx = document.getElementById('productivityChart')?.getContext('2d'); if (!ctx) return; if (window.productivityChartInstance) window.productivityChartInstance.destroy(); const colors = getChartColors(); const appData = storage.getAppData(); const tasks = filterDataByRange(appData[currentMode].tasks, masterDateRange, 'datetime'); const { labels, dataPoints } = getTimeBuckets(masterDateRange, tasks, 'datetime'); const completedCounts = new Array(labels.length).fill(0); tasks.filter(t => t.completed && t.datetime).forEach(t => { const itemDate = new Date(t.datetime); let bucketIndex = -1; for (let i = dataPoints.length - 1; i >= 0; i--) { if (itemDate >= dataPoints[i]) { bucketIndex = i; break; } } if (bucketIndex !== -1) completedCounts[bucketIndex]++; }); window.productivityChartInstance = new Chart(ctx, { type: 'bar', data: { labels, datasets: [{ label: 'Tugas Selesai', data: completedCounts, backgroundColor: colors.taskBg, borderColor: colors.taskColor, borderWidth: 1, borderRadius: 5 }] }, options: { responsive: true, scales: { y: { beginAtZero: true, ticks: { stepSize: 1, color: colors.tickColor }, grid: { color: colors.gridColor } }, x: { ticks: { color: colors.tickColor }, grid: { color: colors.gridColor } } }, plugins: { legend: { labels: { color: colors.legendColor } } } } }); }
function loadAnalysisCharts() { const appData = storage.getAppData(); const modeData = appData[currentMode]; const colors = getChartColors(); const diaryNotes = JSON.parse(localStorage.getItem('notes_v5.9.0') || '[]'); Chart.defaults.color = colors.legendColor; Chart.defaults.font.family = "'Poppins', 'sans-serif'"; const chartIds = ['combinedAnalysisChart', 'incomeVsExpenseChart', 'spendingByCategoryChart', 'taskCompletionTrendChart', 'taskPriorityDistributionChart', 'splitBillByUserChart', 'splitBillFrequencyChart', 'diaryEntryFrequencyChart', 'noteMoodAnalysisChart']; chartIds.forEach(id => { if (window[id + 'Instance']) window[id + 'Instance'].destroy(); }); const filteredPersonalTransactions = filterDataByRange(appData.personal.transactions, masterDateRange, 'date'); const filteredPersonalTasks = filterDataByRange(appData.personal.tasks, masterDateRange, 'datetime'); const filteredPersonalSplits = filterDataByRange(appData.personal.splitBills, masterDateRange, 'date'); const filteredBusinessTransactions = filterDataByRange(appData.business.transactions, masterDateRange, 'date'); const filteredBusinessTasks = filterDataByRange(appData.business.tasks, masterDateRange, 'datetime'); const filteredBusinessSplits = filterDataByRange(appData.business.splitBills, masterDateRange, 'date'); const filteredDiary = filterDataByRange(diaryNotes, masterDateRange, 'date'); const personalData = { finance: filteredPersonalTransactions.length, tasks: filteredPersonalTasks.length, splitBill: filteredPersonalSplits.length, diary: filteredDiary.length, }; const businessData = { finance: filteredBusinessTransactions.length, tasks: filteredBusinessTasks.length, splitBill: filteredBusinessSplits.length, diary: 0, }; const combinedCtx = document.getElementById('combinedAnalysisChart').getContext('2d'); window.combinedAnalysisChartInstance = new Chart(combinedCtx, { type: 'radar', data: { labels: ['Keuangan', 'Tugas', 'Split Bill', 'Catatan'], datasets: [ { label: 'Pribadi', data: [personalData.finance, personalData.tasks, personalData.splitBill, personalData.diary], backgroundColor: 'rgba(0, 136, 255, 0.2)', borderColor: '#0088ff', borderWidth: 2, pointBackgroundColor: '#0088ff', pointRadius: 4, }, { label: 'Bisnis', data: [businessData.finance, businessData.tasks, businessData.splitBill, businessData.diary], backgroundColor: 'rgba(255, 0, 110, 0.2)', borderColor: '#ff006e', borderWidth: 2, pointBackgroundColor: '#ff006e', pointRadius: 4, } ] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { usePointStyle: true, padding: 20, font: { size: 14 } } } }, scales: { r: { angleLines: { color: colors.gridColor }, grid: { color: colors.gridColor }, pointLabels: { font: { size: 14, weight: '600' }, color: colors.tickColor }, ticks: { backdropColor: 'rgba(0,0,0,0.5)', color: colors.tickColor, stepSize: 5 }, suggestedMin: 0 } } } }); const filteredFinance = filterDataByRange(modeData.transactions, masterDateRange, 'date'); const financialData = processTimeSeriesData(filteredFinance, 'date', masterDateRange); const incomeVsExpenseCtx = document.getElementById('incomeVsExpenseChart').getContext('2d'); window.incomeVsExpenseChartInstance = new Chart(incomeVsExpenseCtx, { type: 'bar', data: { labels: financialData.labels, datasets: [ { label: 'Pemasukan', data: financialData.income, backgroundColor: colors.incomeColor }, { label: 'Pengeluaran', data: financialData.expense, backgroundColor: colors.expenseColor } ] }, options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, y: { grid: { color: colors.gridColor } } } } }); const spendingCtx = document.getElementById('spendingByCategoryChart').getContext('2d'); const { labels: categoryLabels, data: spendingData } = processSpendingByCategory(filteredFinance); window.spendingByCategoryChartInstance = new Chart(spendingCtx, { type: 'doughnut', data: { labels: categoryLabels, datasets: [{ data: spendingData, backgroundColor: ['#f472b6', '#60a5fa', '#fbbf24', '#4ade80', '#c084fc', '#a1a1aa', '#f87171', '#818cf8'], borderWidth: 0 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } } }); const filteredTasks = filterDataByRange(modeData.tasks, masterDateRange, 'datetime'); const taskData = processTimeSeriesData(filteredTasks, 'datetime', masterDateRange); const taskTrendCtx = document.getElementById('taskCompletionTrendChart').getContext('2d'); window.taskCompletionTrendChartInstance = new Chart(taskTrendCtx, { type: 'line', data: { labels: taskData.labels, datasets: [ { label: 'Dibuat', data: taskData.created, borderColor: '#60a5fa', tension: 0.3 }, { label: 'Selesai', data: taskData.completed, borderColor: '#4ade80', tension: 0.3 } ] }, options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, y: { beginAtZero: true, grid: { color: colors.gridColor }, ticks: { stepSize: 1 } } } } }); const taskPriorityCtx = document.getElementById('taskPriorityDistributionChart').getContext('2d'); const { labels: priorityLabels, data: priorityData } = processTaskPriorities(filteredTasks); window.taskPriorityDistributionChartInstance = new Chart(taskPriorityCtx, { type: 'pie', data: { labels: priorityLabels, datasets: [{ data: priorityData, backgroundColor: ['#f472b6', '#fbbf24', '#4ade80'], borderWidth: 0 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } } }); const filteredSplits = filterDataByRange(modeData.splitBills, masterDateRange, 'date'); const splitByUserCtx = document.getElementById('splitBillByUserChart').getContext('2d'); const { labels: userLabels, data: userSpendingData } = processSplitBillByUser(filteredSplits); window.splitBillByUserChartInstance = new Chart(splitByUserCtx, { type: 'bar', data: { labels: userLabels, datasets: [{ label: 'Total Pengeluaran', data: userSpendingData, backgroundColor: colors.incomeColor, borderRadius: 5 }] }, options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', scales: { x: { grid: { color: colors.gridColor } }, y: { grid: { display: false } } }, plugins: { legend: { display: false } } } }); const splitFreqData = processTimeSeriesData(filteredSplits, 'date', masterDateRange); const splitFreqCtx = document.getElementById('splitBillFrequencyChart').getContext('2d'); window.splitBillFrequencyChartInstance = new Chart(splitFreqCtx, { type: 'line', data: { labels: splitFreqData.labels, datasets: [{ label: 'Jumlah Split Bill', data: splitFreqData.count, borderColor: '#22d3ee', tension: 0.3, fill: true, backgroundColor: 'rgba(34, 211, 238, 0.2)' }] }, options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, y: { beginAtZero: true, grid: { color: colors.gridColor }, ticks: { stepSize: 1 } } } } }); const diaryCtx = document.getElementById('diaryEntryFrequencyChart').getContext('2d'); const diaryData = processTimeSeriesData(filteredDiary, 'date', masterDateRange); window.diaryEntryFrequencyChartInstance = new Chart(diaryCtx, { type: 'bar', data: { labels: diaryData.labels, datasets: [{ label: 'Jumlah Entri', data: diaryData.count, backgroundColor: colors.taskBg, borderColor: colors.taskColor, borderWidth: 1, borderRadius: 5 }] }, options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false } }, y: { beginAtZero: true, grid: { color: colors.gridColor }, ticks: { stepSize: 1 } } } } }); const moodCtx = document.getElementById('noteMoodAnalysisChart').getContext('2d'); const moodData = processNoteMoods(filteredDiary); window.noteMoodAnalysisChartInstance = new Chart(moodCtx, { type: 'doughnut', data: { labels: moodData.labels, datasets: [{ data: moodData.data, backgroundColor: moodData.backgroundColors, borderColor: colors.gridColor, borderWidth: 2 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { usePointStyle: true, padding: 10 } } } } }); }
function processTimeSeriesData(data, dateKey, range) { const { labels, dataPoints } = getTimeBuckets(range, data, dateKey); const isFinance = data.length > 0 && 'type' in data[0] && 'amount' in data[0]; const isTask = data.length > 0 && 'completed' in data[0]; let results = {}; if (isFinance) { results.income = new Array(labels.length).fill(0); results.expense = new Array(labels.length).fill(0); } else if (isTask) { results.created = new Array(labels.length).fill(0); results.completed = new Array(labels.length).fill(0); } else { results.count = new Array(labels.length).fill(0); } data.forEach(item => { if (!item[dateKey]) return; const itemDate = new Date(item[dateKey]); let bucketIndex = -1; for (let i = dataPoints.length - 1; i >= 0; i--) { if (itemDate >= dataPoints[i]) { bucketIndex = i; break; } } if (bucketIndex !== -1) { if (isFinance) { if (item.type === 'income') results.income[bucketIndex] += item.amount; else results.expense[bucketIndex] += item.amount; } else if (isTask) { results.created[bucketIndex]++; if (item.completed) results.completed[bucketIndex]++; } else { results.count[bucketIndex]++; } } }); return { labels, ...results }; } function processSpendingByCategory(transactions) { const spending = {}; transactions.filter(t => t.type === 'expense').forEach(t => { const categoryName = getCategoryName(t.category); spending[categoryName] = (spending[categoryName] || 0) + t.amount; }); const sortedSpending = Object.entries(spending).sort(([,a],[,b]) => b-a); return { labels: sortedSpending.map(([label]) => label), data: sortedSpending.map(([,data]) => data) }; } function processTaskPriorities(tasks) { const priorities = { high: 0, medium: 0, low: 0 }; tasks.filter(t => !t.completed).forEach(t => { priorities[t.priority]++; }); return { labels: ['Tinggi', 'Sedang', 'Rendah'], data: [priorities.high, priorities.medium, priorities.low] }; } function processSplitBillByUser(splitBills) { const userTotals = {}; splitBills.forEach(bill => { bill.results.forEach(person => { userTotals[person.name] = (userTotals[person.name] || 0) + person.amount; }); }); const sortedUsers = Object.entries(userTotals).sort(([,a],[,b]) => b-a); return { labels: sortedUsers.map(([label]) => label), data: sortedUsers.map(([,data]) => data) }; }

function processNoteMoods(notes) {
Â  Â  const moodCounts = {};
Â  Â  const moodColors = {
Â  Â  Â  Â  happy: '#4ade80',
Â  Â  Â  Â  sad: '#60a5fa',
Â  Â  Â  Â  excited: '#facc15',
Â  Â  Â  Â  angry: '#f472b6',
Â  Â  Â  Â  neutral: '#9ca3af'
Â  Â  };
Â  Â  const moodLabels = {
Â  Â  Â  Â  happy: 'Senang',
Â  Â  Â  Â  sad: 'Sedih',
Â  Â  Â  Â  excited: 'Bersemangat',
Â  Â  Â  Â  angry: 'Marah',
Â  Â  Â  Â  neutral: 'Netral'
Â  Â  };

Â  Â  notes.forEach(note => {
Â  Â  Â  Â  if (note.mood) {
Â  Â  Â  Â  Â  Â  moodCounts[note.mood] = (moodCounts[note.mood] || 0) + 1;
Â  Â  Â  Â  }
Â  Â  });

Â  Â  const labels = Object.keys(moodCounts).map(mood => moodLabels[mood] || mood);
Â  Â  const data = Object.values(moodCounts);
Â  Â  const backgroundColors = Object.keys(moodCounts).map(mood => moodColors[mood] || '#a1a1aa');

Â  Â  return { labels, data, backgroundColors };
}
function getGroupingUnit(range) { if (typeof range === 'object' && range.type === 'custom') { const diffTime = Math.abs(new Date(range.end) - new Date(range.start)); const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); if (diffDays > 90) return 'month'; if (diffDays > 30) return 'week'; return 'day'; } if (['7d', '1m'].includes(range)) return 'day'; if (range === '3m') return 'week'; if (['1y', 'all'].includes(range)) return 'month'; return 'day'; } function getTimeBuckets(range, data, dateKey) { const labels = []; const dataPoints = []; const now = new Date(); const unit = getGroupingUnit(range); let startDate, endDate = new Date(now); if (typeof range === 'object' && range.type === 'custom') { startDate = new Date(range.start + 'T00:00:00Z'); endDate = new Date(range.end + 'T23:59:59Z'); } else if (range === 'all') { const validData = data.filter(d => d[dateKey]); if (validData.length === 0) { startDate = new Date(); startDate.setMonth(startDate.getMonth() - 1); } else { startDate = new Date(validData.reduce((min, p) => (p[dateKey] < min) ? p[dateKey] : min, validData[0][dateKey])); } } else { startDate = new Date(now); if (range === '7d') startDate.setDate(now.getDate() - 6); else if (range === '1m') startDate.setDate(now.getDate() - 29); else if (range === '3m') startDate.setMonth(now.getMonth() - 3); else if (range === '1y') startDate.setFullYear(now.getFullYear() - 1); } startDate.setHours(0, 0, 0, 0); let current = new Date(startDate); while (current <= endDate) { dataPoints.push(new Date(current)); if (unit === 'day') { labels.push(current.toLocaleDateString('id-ID', { day: 'numeric', month: 'short' })); current.setDate(current.getDate() + 1); } else if (unit === 'week') { labels.push(`W${getWeekNumber(current)}`); current.setDate(current.getDate() + 7); } else { labels.push(current.toLocaleDateString('id-ID', { month: 'short', year: '2-digit' })); current.setMonth(current.getMonth() + 1); } } return { labels, dataPoints }; } function getWeekNumber(d) { d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate())); d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7)); var yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1)); var weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7); return weekNo; }
function generateId() { return Date.now().toString(36) + Math.random().toString(36).substr(2); } function formatCurrency(amount) { return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(amount); }Â 
function formatDate(dateString) { return dateString ? new Date(dateString).toLocaleDateString('id-ID', { day: '2-digit', month: '2-digit', year: 'numeric' }) : ''; }Â 
function formatDateTime(dateString) { return dateString ? new Date(dateString).toLocaleString('id-ID', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' }) : ''; }Â 

function getTransactionIcon(category) {
Â  Â  const icons = {
Â  Â  Â  Â  food: 'fa-utensils', transport: 'fa-car', entertainment: 'fa-gamepad', shopping: 'fa-shopping-bag', bills: 'fa-file-invoice', salary: 'fa-money-bill-wave', business: 'fa-briefcase', investment: 'fa-chart-line', health: 'fa-heart-pulse', education: 'fa-graduation-cap', subscription: 'fa-rss', household: 'fa-house-chimney', personal_care: 'fa-spa', gift: 'fa-gift', other: 'fa-shapes'
Â  Â  };
Â  Â  return icons[category] || 'fa-shapes';
}

function getCategoryName(category = null) { const names = { food: 'Makanan & Minuman', transport: 'Transportasi', entertainment: 'Hiburan', shopping: 'Belanja', bills: 'Tagihan & Utilitas', salary: 'Gaji', business: 'Bisnis', investment: 'Investasi', health: 'Kesehatan', education: 'Pendidikan', subscription: 'Langganan', household: 'Rumah Tangga', personal_care: 'Perawatan Diri', gift: 'Hadiah & Donasi', other: 'Lainnya' }; return category ? names[category] : names; }
function showModal(content) { const modal = document.getElementById('mainModal'); modal.querySelector('.modal-content').innerHTML = content; modal.classList.add('show'); modal.querySelectorAll('.closeModal').forEach(btn => btn.addEventListener('click', closeModal)); } function closeModal() { document.querySelectorAll('.modal').forEach(modal => modal.classList.remove('show')); } function showConfirm(title, message, onConfirm) { const modal = document.getElementById('confirmModal'); document.getElementById('confirmTitle').textContent = title; document.getElementById('confirmMessage').textContent = message; modal.classList.add('show'); const yesBtn = document.getElementById('confirmYes'); const noBtn = document.getElementById('confirmNo'); const yesHandler = () => { onConfirm(); closeModal(); cleanup(); }; const noHandler = () => { closeModal(); cleanup(); }; const cleanup = () => { yesBtn.removeEventListener('click', yesHandler); noBtn.removeEventListener('click', noHandler); }; yesBtn.addEventListener('click', yesHandler); noBtn.addEventListener('click', noHandler); } function showMessage(message, type = 'info') { const isLight = document.body.classList.contains('light-mode'); const colors = { info: '#60a5fa', success: '#4ade80', error: '#f472b6' }; const msgDiv = document.createElement('div'); Object.assign(msgDiv.style, { position: 'fixed', bottom: '20px', right: '20px', padding: '15px', backgroundColor: isLight ? '#ffffff' : 'rgba(15, 10, 32, 0.8)', backdropFilter: 'blur(10px)', color: colors[type], border: `1px solid ${colors[type]}`, borderRadius: '8px', boxShadow: `0 4px 15px rgba(0,0,0,0.1)`, zIndex: '9999', transition: 'opacity 0.5s' }); msgDiv.textContent = message; document.body.appendChild(msgDiv); setTimeout(() => { msgDiv.style.opacity = '0'; setTimeout(() => msgDiv.remove(), 500); }, 3000); }Â 

function showDateRangeModal(source = 'dashboard') {Â 
Â  Â  dateRangeSource = source;
Â  Â  document.getElementById('dateRangeModal').classList.add('show');Â 
}Â 

function applyDateRange() { const startDate = document.getElementById('startDate').value; const endDate = document.getElementById('endDate').value; if (!startDate || !endDate) { showMessage('Harap pilih tanggal mulai dan selesai.', 'error'); return; } if (new Date(startDate) > new Date(endDate)) { showMessage('Tanggal mulai tidak boleh setelah tanggal selesai.', 'error'); return; } const rangeObject = { type: 'custom', start: startDate, end: endDate }; if (dateRangeSource === 'dashboard') { masterDateRange = rangeObject; updateActiveButton('master-range-selector', 'custom'); refreshDashboardData(); } else if (dateRangeSource === 'finance') { financeDateRange = rangeObject; filterAndRenderTransactions(); } document.getElementById('dateRangeModal').classList.remove('show'); }Â 

function setupMasterRangeSelector() { document.querySelectorAll('#master-range-selector .range-btn').forEach(btn => { btn.addEventListener('click', (e) => { const range = e.currentTarget.dataset.range; if (range === 'custom') { showDateRangeModal('dashboard'); } else { updateActiveButton('master-range-selector', range); masterDateRange = range; refreshDashboardData(); } }); }); } function updateActiveButton(selectorId, activeRange) { document.querySelectorAll(`#${selectorId} .range-btn`).forEach(b => b.classList.remove('active')); document.querySelector(`#${selectorId} .range-btn[data-range="${activeRange}"]`).classList.add('active'); } function filterDataByRange(data, range, dateKey) { if (range === 'all') return data.filter(item => item[dateKey] || item.lastModified); let startDate, endDate = new Date(); if (typeof range === 'object' && range.type === 'custom') { startDate = new Date(range.start + 'T00:00:00Z'); endDate = new Date(range.end + 'T23:59:59Z'); } else { startDate = new Date(); if (range === '7d') startDate.setDate(endDate.getDate() - 6); else if (range === '1m') startDate.setDate(endDate.getDate() - 29); else if (range === '3m') startDate.setMonth(endDate.getMonth() - 3); else if (range === '1y') startDate.setFullYear(endDate.getFullYear() - 1); startDate.setHours(0, 0, 0, 0); } return data.filter(item => { const itemDateStr = item[dateKey] || item.lastModified; if (!itemDateStr) return false; const itemDate = new Date(itemDateStr); return itemDate >= startDate && itemDate <= endDate; }); }
function toggleEmailVisibility() {
Â  Â  const userEmailEl = document.getElementById('user-email');
Â  Â  const toggleIcon = document.getElementById('toggle-email-visibility');

Â  Â  const isNowBlurred = userEmailEl.classList.toggle('email-blur');

Â  Â  if (isNowBlurred) {
Â  Â  Â  Â  toggleIcon.classList.remove('fa-eye-slash');
Â  Â  Â  Â  toggleIcon.classList.add('fa-eye');
Â  Â  Â  Â  toggleIcon.title = "Tampilkan Email";
Â  Â  } else {
Â  Â  Â  Â  toggleIcon.classList.remove('fa-eye');
Â  Â  Â  Â  toggleIcon.classList.add('fa-eye-slash');
Â  Â  Â  Â  toggleIcon.title = "Sembunyikan Email";
Â  Â  }
}


const defaultPortalIcons = [ { label: "Ikon Universal", icons: [ { value: "fas fa-shopping-cart", text: "Belanja: Keranjang" }, { value: "fas fa-shopping-bag", text: "Belanja: Tas" }, { value: "fas fa-store", text: "Belanja: Toko" }, { value: "fas fa-tags", text: "Belanja: Tag Harga" }, { value: "fas fa-car", text: "Transportasi: Mobil" }, { value: "fas fa-motorcycle", text: "Transportasi: Motor" }, { value: "fas fa-plane-departure", text: "Perjalanan: Pesawat" }, { value: "fas fa-ticket-alt", text: "Perjalanan: Tiket" }, { value: "fas fa-bed", text: "Perjalanan: Akomodasi" }, { value: "fas fa-wallet", text: "Keuangan: Dompet" }, { value: "fas fa-credit-card", text: "Keuangan: Kartu Kredit" }, { value: "fas fa-landmark", text: "Keuangan: Bank" }, { value: "fas fa-coins", text: "Keuangan: Koin" }, { value: "fas fa-utensils", text: "Makanan: Peralatan Makan" }, { value: "fas fa-hamburger", text: "Makanan: Burger" }, { value: "fas fa-feather-alt", text: "Produktivitas: Tulis/Catatan" }, { value: "fas fa-check-double", text: "Produktivitas: Tugas Selesai" }, { value: "fas fa-chart-pie", text: "Produktivitas: Laporan" }, { value: "fas fa-film", text: "Hiburan: Film" }, { value: "fas fa-tv", text: "Hiburan: TV" }, { value: "fas fa-headphones", text: "Hiburan: Musik" }, ] }, { label: "Media Sosial (Logo Resmi)", icons: [ { value: "fab fa-facebook", text: "Facebook" }, { value: "fab fa-instagram", text: "Instagram" }, { value: "fab fa-whatsapp", text: "WhatsApp" }, { value: "fab fa-x-twitter", text: "Twitter / X" }, { value: "fab fa-tiktok", text: "TikTok" }, { value: "fab fa-youtube", text: "YouTube" }, { value: "fab fa-telegram", text: "Telegram" }, { value: "fab fa-discord", text: "Discord" }, { value: "fab fa-linkedin", text: "LinkedIn" }, { value: "fab fa-pinterest", text: "Pinterest" }, { value: "fab fa-reddit", text: "Reddit" }, { value: "fab fa-snapchat", text: "Snapchat" }, { value: "fab fa-threads", text: "Threads" }, { value: "fab fa-line", text: "Line" }, { value: "fab fa-weixin", text: "WeChat" }, { value: "fab fa-tumblr", text: "Tumblr" }, { value: "fab fa-vk", text: "VK" }, { value: "fab fa-quora", text: "Quora" }, { value: "fab fa-medium", text: "Medium" }, { value: "fab fa-blogger", text: "Blogger" }, { value: "fab fa-wordpress", text: "WordPress" }, { value: "fab fa-deviantart", text: "DeviantArt" }, { value: "fab fa-dribbble", text: "Dribbble" }, { value: "fab fa-behance", text: "Behance" }, { value: "fab fa-flickr", text: "Flickr" }, { value: "fab fa-meetup", text: "Meetup" }, { value: "fab fa-mastodon", text: "Mastodon" }, { value: "fab fa-vimeo", text: "Vimeo" }, { value: "fab fa-mix", text: "Mix" }, { value: "fab fa-xing", text: "Xing" }, { value: "fab fa-goodreads", text: "GoodReads" }, ] }, { label: "Produktivitas & Kerja (Logo Resmi)", icons: [ { value: "fab fa-google-drive", text: "Google Drive" }, { value: "fab fa-slack", text: "Slack" }, { value: "fab fa-trello", text: "Trello" }, { value: "fab fa-asana", text: "Asana" }, { value: "fab fa-evernote", text: "Evernote" }, { value: "fab fa-microsoft", text: "Microsoft" }, { value: "fab fa-skype", text: "Skype" }, { value: "fab fa-dropbox", text: "Dropbox" }, { value: "fab fa-confluence", text: "Confluence" }, { value: "fab fa-jira", text: "Jira" }, { value: "fab fa-figma", text: "Figma" }, ] }, { label: "E-commerce & Keuangan (Logo Resmi)", icons: [ { value: "fab fa-amazon", text: "Amazon" }, { value: "fab fa-ebay", text: "eBay" }, { value: "fab fa-alibaba", text: "Alibaba" }, { value: "fab fa-etsy", text: "Etsy" }, { value: "fab fa-paypal", text: "PayPal" }, { value: "fab fa-stripe", text: "Stripe" }, { value: "fab fa-cc-wise", text: "Wise" }, { value: "fab fa-google-pay", text: "Google Pay" }, { value: "fab fa-apple-pay", text: "Apple Pay" }, { value: "fab fa-samsung-pay", text: "Samsung Pay" }, { value: "fab fa-bitcoin", text: "Bitcoin" }, ] }, { label: "Hiburan & Streaming (Logo Resmi)", icons: [ { value: "fab fa-spotify", text: "Spotify" }, { value: "fab fa-soundcloud", text: "SoundCloud" }, { value: "fab fa-apple", text: "Apple" }, { value: "fab fa-deezer", text: "Deezer" }, { value: "fab fa-pandora", text: "Pandora" }, { value: "fab fa-bandcamp", text: "Bandcamp" }, { value: "fab fa-mixcloud", text: "Mixcloud" }, { value: "fab fa-twitch", text: "Twitch" }, { value: "fab fa-steam", text: "Steam" }, ] }, { label: "Teknologi & Tools (Logo Resmi)", icons: [ { value: "fab fa-github", text: "GitHub" }, { value: "fab fa-gitlab", text: "GitLab" }, { value: "fab fa-bitbucket", text: "Bitbucket" }, { value: "fab fa-aws", text: "AWS" }, { value: "fab fa-google", text: "Google" }, { value: "fab fa-digital-ocean", text: "DigitalOcean" }, { value: "fab fa-linode", text: "Linode" }, { value: "fab fa-docker", text: "Docker" }, { value: "fab fa-npm", text: "NPM" }, { value: "fab fa-yarn", text: "Yarn" }, { value: "fab fa-android", text: "Android" }, { value: "fab fa-jenkins", text: "Jenkins" }, ] }, { label: "Utility / Umum (Lanjutan)", icons: [ { value: "fas fa-home", text: "Home" }, { value: "fas fa-user", text: "User / Profile" }, { value: "fas fa-cog", text: "Settings" }, { value: "fas fa-phone", text: "Phone" }, { value: "fas fa-globe", text: "Globe / Website" }, { value: "fas fa-link", text: "Link (Default)" }, { value: "fas fa-envelope", text: "Email" }, { value: "fas fa-camera", text: "Camera" }, { value: "fas fa-image", text: "Gallery / Image" }, { value: "fas fa-file", text: "File" }, { value: "fas fa-folder", text: "Folder" }, { value: "fas fa-search", text: "Search" }, { value: "fas fa-map-marker-alt", text: "Location" }, { value: "fas fa-bookmark", text: "Bookmark" }, { value: "fas fa-star", text: "Star / Favorite" }, { value: "fas fa-heart", text: "Heart / Like" }, { value: "fas fa-bell", text: "Bell / Notification" }, { value: "fas fa-lock", text: "Lock / Private" }, { value: "fas fa-upload", text: "Upload" }, { value: "fas fa-download", text: "Download" }, { value: "fas fa-qrcode", text: "QR Code" }, ] } ];

function showPortalModal() {
Â  Â  const iconOptionsHTML = defaultPortalIcons.map(group => `
Â  Â  Â  Â  <optgroup label="--- ${group.label} ---">
Â  Â  Â  Â  Â  Â  ${group.icons.map(icon => `<option value="${icon.value}">${icon.text}</option>`).join('')}
Â  Â  Â  Â  </optgroup>
Â  Â  `).join('');
Â  Â  const finalIconOptions = iconOptionsHTML + `<optgroup label="--- Kustomisasi ---"><option value="custom-icon">Ikon Kustom (URL/Unggah)</option></optgroup>`;

Â  Â  const colorOptions = [
Â  Â  Â  Â  '#ff2a6d', '#05d9e8', '#d300c5', '#00ff9d', '#ffcc00', '#ffffff', '#1DA1F2', '#FF5700'
Â  Â  ].map((color, index) => `<div class="portal-color-option ${index === 1 ? 'selected' : ''}" style="background-color: ${color};" onclick="selectPortalColor(this)"></div>`).join('');

Â  Â  const content = `
Â  Â  Â  Â  <div class="flex justify-between items-center mb-4">
Â  Â  Â  Â  Â  Â  <h3 class="text-2xl text-purple-300" style="font-family: 'Orbitron', sans-serif;">Buat Portal Baru</h3>
Â  Â  Â  Â  Â  Â  <button class="closeModal text-gray-400 hover:text-purple-300"><i class="fas fa-times"></i></button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <form id="portalForm" class="space-y-4">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block mb-2 portal-modal-label uppercase text-sm tracking-wider">Nama Portal</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="portal-name" class="custom-input" required>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block mb-2 portal-modal-label uppercase text-sm tracking-wider">URL Tujuan</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="url" id="portal-url" class="custom-input" placeholder="https://" required>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block mb-2 portal-modal-label uppercase text-sm tracking-wider">Ikon</label>
Â  Â  Â  Â  Â  Â  Â  Â  <select id="portal-icon" class="custom-select">${finalIconOptions}</select>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="custom-icon-options" class="mt-3 hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block mb-2 text-xs uppercase tracking-wider">Unggah Ikon</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="icon-upload" class="custom-input text-xs p-2" accept="image/*">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="block mb-2 text-xs uppercase tracking-wider">atau URL Ikon</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="url" id="icon-url" class="custom-input" placeholder="https://.../icon.png">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-4 text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <img id="icon-preview" class="hidden w-16 h-16 object-cover mx-auto rounded-lg border-2 border-dashed p-1" src="#" alt="Icon Preview" style="border-color: var(--input-border);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block mb-2 portal-modal-label uppercase text-sm tracking-wider">Warna Ikon (jika bukan kustom)</label>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center border rounded-lg p-2" style="border-color: var(--input-border);">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${colorOptions}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="color" id="portal-custom-color" class="portal-custom-color-input" value="#05d9e8">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="hidden" id="portal-color" value="#05d9e8">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="flex justify-end space-x-3 pt-4">
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="closeModal custom-button custom-button-danger">Batal</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="custom-button">Buat Portal</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </form>
Â  Â  `;
Â  Â  showModal(content);

Â  Â  document.getElementById('portalForm').addEventListener('submit', handlePortalFormSubmit);
Â  Â  document.getElementById('portal-icon').addEventListener('change', toggleCustomIconOptions);
Â  Â  document.getElementById('icon-upload').addEventListener('change', (e) => handleImageUpload(e, document.getElementById('icon-preview')));
Â  Â  document.getElementById('portal-custom-color').addEventListener('input', (e) => applyCustomPortalColor(e.target.value));
}

function handlePortalFormSubmit(e) {
Â  Â  e.preventDefault();
Â  Â Â 
Â  Â  const name = document.getElementById('portal-name').value;
Â  Â  const url = document.getElementById('portal-url').value;
Â  Â  let icon = document.getElementById('portal-icon').value;
Â  Â  const color = document.getElementById('portal-color').value;
Â  Â Â 
Â  Â  if (icon === 'custom-icon') {
Â  Â  Â  Â  const iconUrlInput = document.getElementById('icon-url');
Â  Â  Â  Â  const iconPreview = document.getElementById('icon-preview');

Â  Â  Â  Â  if (iconPreview.src && iconPreview.src !== '#' && iconPreview.src.startsWith('data:image')) {
Â  Â  Â  Â  Â  Â  addPortalToArray(name, url, iconPreview.src, color);
Â  Â  Â  Â  } else if (iconUrlInput.value) {
Â  Â  Â  Â  Â  Â  addPortalToArray(name, url, iconUrlInput.value, color);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  showMessage('Harap unggah gambar atau masukkan URL untuk ikon kustom.', 'error');
Â  Â  Â  Â  }
Â  Â  } else {
Â  Â  Â  Â  addPortalToArray(name, url, icon, color);
Â  Â  }
}

function addPortalToArray(name, url, icon, color) {
Â  Â  let appData = storage.getAppData();
Â  Â  const newPortal = { id: generateId(), name, url, icon, color };
Â  Â  appData[currentMode].portals.push(newPortal);
Â  Â  storage.saveAppData(appData);
Â  Â  renderPortals();
Â  Â  closeModal();
Â  Â  showMessage('Portal berhasil dibuat!', 'success');
}

function renderPortals() {
Â  Â  const portalsContainer = document.getElementById('sidebar-portals-container');
Â  Â  const appData = storage.getAppData();
Â  Â  const portals = appData[currentMode].portals || [];

Â  Â  portalsContainer.innerHTML = '';
Â  Â  if (portals.length === 0) {
Â  Â  Â  Â  portalsContainer.innerHTML = `<p class="text-sm text-center text-gray-500 px-2 py-4">Belum ada portal.</p>`;
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  portals.forEach(portal => {
Â  Â  Â  Â  const portalColor = portal.color || 'var(--primary-brand)';
Â  Â  Â  Â Â 
Â  Â  Â  Â  const iconHtml = portal.icon.startsWith('data:image') || portal.icon.startsWith('http')
Â  Â  Â  Â  Â  Â  ? `<img src="${portal.icon}" alt="${portal.name} icon">`
Â  Â  Â  Â  Â  Â  : `<i class="${portal.icon}" style="color: ${portalColor};"></i>`;

Â  Â  Â  Â  const linkElement = document.createElement('a');
Â  Â  Â  Â  linkElement.href = portal.url;
Â  Â  Â  Â  linkElement.target = '_blank';
Â  Â  Â  Â  linkElement.className = 'sidebar-portal-item';
Â  Â  Â  Â  linkElement.title = portal.name;

Â  Â  Â  Â  linkElement.innerHTML = `
Â  Â  Â  Â  Â  Â  <div class="portal-icon">${iconHtml}</div>
Â  Â  Â  Â  Â  Â  <span class="portal-name">${portal.name}</span>
Â  Â  Â  Â  Â  Â  <button data-id="${portal.id}" class="delete-portal-btn text-xs">
Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-times"></i>
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  `;
Â  Â  Â  Â Â 
Â  Â  Â  Â  portalsContainer.appendChild(linkElement);

Â  Â  Â  Â  linkElement.querySelector('.delete-portal-btn').addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  e.stopPropagation();
Â  Â  Â  Â  Â  Â  const portalId = e.currentTarget.dataset.id;
Â  Â  Â  Â  Â  Â  showConfirm('Hapus Portal?', `Yakin ingin menghapus portal "${portal.name}"?`, () => deletePortal(portalId));
Â  Â  Â  Â  });
Â  Â  });
}

function deletePortal(portalId) {
Â  Â  let appData = storage.getAppData();
Â  Â  appData[currentMode].portals = appData[currentMode].portals.filter(p => p.id !== portalId);
Â  Â  storage.saveAppData(appData);
Â  Â  renderPortals();
Â  Â  showMessage('Portal dihapus.', 'success');
}


function toggleCustomIconOptions() {
Â  Â  const portalIconSelect = document.getElementById('portal-icon');
Â  Â  const customIconOptions = document.getElementById('custom-icon-options');
Â  Â  customIconOptions.classList.toggle('hidden', portalIconSelect.value !== 'custom-icon');
}

function handleImageUpload(event, previewElement) {
Â  Â  const file = event.target.files[0];
Â  Â  if (file) {
Â  Â  Â  Â  document.getElementById('icon-url').value = '';Â 
Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  reader.onload = (e) => {
Â  Â  Â  Â  Â  Â  previewElement.src = e.target.result;
Â  Â  Â  Â  Â  Â  previewElement.classList.remove('hidden');
Â  Â  Â  Â  };
Â  Â  Â  Â  reader.readAsDataURL(file);
Â  Â  }
}

function selectPortalColor(element) {
Â  Â  const container = element.closest('.text-center');
Â  Â  container.querySelectorAll('.portal-color-option').forEach(el => el.classList.remove('selected'));
Â  Â  element.classList.add('selected');
Â  Â  const colorValue = element.style.backgroundColor;
Â  Â  document.getElementById('portal-color').value = colorValue;
Â  Â  document.getElementById('portal-custom-color').value = rgbToHex(colorValue);
}

function applyCustomPortalColor(color) {
Â  Â  document.getElementById('portal-color').value = color;
Â  Â  document.querySelectorAll('.portal-color-option').forEach(el => el.classList.remove('selected'));
}

function rgbToHex(rgb) {
Â  Â  if (rgb.startsWith('#')) return rgb;
Â  Â  let sep = rgb.indexOf(",") > -1 ? "," : " ";
Â  Â  rgb = rgb.substr(4).split(")")[0].split(sep);
Â  Â  let r = (+rgb[0]).toString(16),
Â  Â  Â  Â  g = (+rgb[1]).toString(16),
Â  Â  Â  Â  b = (+rgb[2]).toString(16);
Â  Â  if (r.length == 1) r = "0" + r;
Â  Â  if (g.length == 1) g = "0" + g;
Â  Â  if (b.length == 1) b = "0" + b;
Â  Â  return "#" + r + g + b;
}

// ===================================================================================
// =================== [BARU] CLASS UNTUK FITUR EDITOR HTML =========================
// ===================================================================================
class HtmlEditorApp {
Â  Â  constructor() {
Â  Â  Â  Â  this.notes = [];
Â  Â  Â  Â  this.currentNoteId = null;
Â  Â  Â  Â  this.activeTab = 'html';
Â  Â  Â  Â  this.autoRefreshEnabled = false;
Â  Â  Â  Â  this.debounceTimeout = null;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // [BARU] Properti untuk Undo/Redo
Â  Â  Â  Â  this.history = {}; // { noteId: { stack: [], index: -1 } }
Â  Â  Â  Â  this.isNavigatingHistory = false; // Flag untuk mencegah rekursi
Â  Â  Â  Â Â 
Â  Â  Â  Â  this.cursorHistory = [];
Â  Â  Â  Â  this.currentCursorIndex = -1;
Â  Â  Â  Â  this.isNavigatingCursorHistory = false;
Â  Â  }

Â  Â  init() {
Â  Â  Â  Â  this.cacheDOMElements();
Â  Â  Â  Â  this.bindEvents();
Â  Â  Â  Â  this.loadNotesFromStorage();
Â  Â  }

Â  Â  cacheDOMElements() {
Â  Â  Â  Â  this.dom = {
Â  Â  Â  Â  Â  Â  // Main Containers
Â  Â  Â  Â  Â  Â  editorContainer: document.getElementById('editor-container'),
Â  Â  Â  Â  Â  Â  welcomeMessage: document.getElementById('welcome-message'),
Â  Â  Â  Â  Â  Â  htmlEditor: document.getElementById('html-editor'),
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Note Lists
Â  Â  Â  Â  Â  Â  htmlNotesList: document.getElementById('htmlNotesList'),
Â  Â  Â  Â  Â  Â  searchHtmlNotesInput: document.getElementById('searchHtmlNotes'),
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Buttons
Â  Â  Â  Â  Â  Â  addHtmlNoteBtn: document.getElementById('addHtmlNoteBtn'),
Â  Â  Â  Â  Â  Â  runBtn: document.getElementById('runBtn'),
Â  Â  Â  Â  Â  Â  saveHtmlNoteBtn: document.getElementById('saveHtmlNoteBtn'),
Â  Â  Â  Â  Â  Â  exportBtn: document.getElementById('exportBtn'),
Â  Â  Â  Â  Â  Â  exportMenu: document.getElementById('export-menu'),
Â  Â  Â  Â  Â  Â  exportHtmlBtn: document.getElementById('exportHtmlBtn'),
Â  Â  Â  Â  Â  Â  exportPdfBtn: document.getElementById('exportPdfBtn'),
Â  Â  Â  Â  Â  Â  exportPdfCodeBtn: document.getElementById('exportPdfCodeBtn'),

Â  Â  Â  Â  Â  Â  // Editor Fields
Â  Â  Â  Â  Â  Â  htmlNoteTitle: document.getElementById('htmlNoteTitle'),
Â  Â  Â  Â  Â  Â  htmlCode: document.getElementById('htmlCode'),
Â  Â  Â  Â  Â  Â  cssCode: document.getElementById('cssCode'),
Â  Â  Â  Â  Â  Â  jsCode: document.getElementById('jsCode'),
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Tabs & Panels
Â  Â  Â  Â  Â  Â  codeEditorTabs: document.querySelector('.code-editor-tabs'),
Â  Â  Â  Â  Â  Â  codePanels: document.getElementById('code-panels'),
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Preview
Â  Â  Â  Â  Â  Â  previewPanel: document.getElementById('preview-panel'),
Â  Â  Â  Â  Â  Â  htmlPreviewIframe: document.getElementById('html-preview-iframe'),
Â  Â  Â  Â  Â  Â  fullscreenBtn: document.getElementById('fullscreen-btn'),
Â  Â  Â  Â  Â  Â  autoRefreshToggle: document.getElementById('auto-refresh-toggle'),

Â  Â  Â  Â  Â  Â  // Toolbar
Â  Â  Â  Â  Â  Â  toolbar: document.getElementById('html-editor-toolbar'),
Â  Â  Â  Â  Â  Â  addFileBtn: document.getElementById('html-add-file-btn'),
Â  Â  Â  Â  Â  Â  undoBtn: document.getElementById('html-undo-btn'),
Â  Â  Â  Â  Â  Â  redoBtn: document.getElementById('html-redo-btn'),
Â  Â  Â  Â  Â  Â  cursorPrevBtn: document.getElementById('html-cursor-prev-btn'),
Â  Â  Â  Â  Â  Â  cursorNextBtn: document.getElementById('html-cursor-next-btn'),
Â  Â  Â  Â  Â  Â  searchBtn: document.getElementById('html-search-btn'),
Â  Â  Â  Â  Â  Â  searchWrapper: document.getElementById('html-search-wrapper'),
Â  Â  Â  Â  Â  Â  searchInput: document.getElementById('html-search-input'),
Â  Â  Â  Â  };
Â  Â  }

Â  Â  bindEvents() {
Â  Â  Â  Â  this.dom.addHtmlNoteBtn.addEventListener('click', () => this.createNewHtmlNote());
Â  Â  Â  Â  this.dom.runBtn.addEventListener('click', () => this.runCode());
Â  Â  Â  Â  this.dom.saveHtmlNoteBtn.addEventListener('click', () => this.saveCurrentHtmlNote());
Â  Â  Â  Â  this.dom.codeEditorTabs.addEventListener('click', (e) => this.switchTab(e));
Â  Â  Â  Â  this.dom.searchHtmlNotesInput.addEventListener('input', () => this.renderHtmlNotesList());

Â  Â  Â  Â  this.dom.exportBtn.addEventListener('click', (e) => this.toggleExportMenu(e));
Â  Â  Â  Â  document.addEventListener('click', (e) => this.closeExportMenu(e));
Â  Â  Â  Â  this.dom.exportHtmlBtn.addEventListener('click', () => this.exportToHtmlFile());
Â  Â  Â  Â  this.dom.exportPdfBtn.addEventListener('click', () => this.exportPreviewToPdfFile());
Â  Â  Â  Â  this.dom.exportPdfCodeBtn.addEventListener('click', () => this.exportCodeToPdfFile());

Â  Â  Â  Â  this.dom.fullscreenBtn.addEventListener('click', () => this.toggleFullscreen());
Â  Â  Â  Â  this.dom.autoRefreshToggle.addEventListener('change', (e) => this.toggleAutoRefresh(e.target.checked));

Â  Â  Â  Â  // Toolbar Events
Â  Â  Â  Â  this.dom.addFileBtn.addEventListener('click', () => this.createNewHtmlNote());
Â  Â  Â  Â  this.dom.undoBtn.addEventListener('click', () => this.undo());
Â  Â  Â  Â  this.dom.redoBtn.addEventListener('click', () => this.redo());
Â  Â  Â  Â  this.dom.cursorPrevBtn.addEventListener('click', () => this.navigateCursorHistory(false));
Â  Â  Â  Â  this.dom.cursorNextBtn.addEventListener('click', () => this.navigateCursorHistory(true));
Â  Â  Â  Â  this.dom.searchBtn.addEventListener('click', () => this.toggleSearchView());

Â  Â  Â  Â  // Editor Events
Â  Â  Â  Â  [this.dom.htmlCode, this.dom.cssCode, this.dom.jsCode].forEach(editor => {
Â  Â  Â  Â  Â  Â  editor.addEventListener('input', () => this.handleEditorInput());
Â  Â  Â  Â  Â  Â  editor.addEventListener('click', () => this.recordCursorPosition());
Â  Â  Â  Â  Â  Â  editor.addEventListener('keyup', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'PageUp', 'PageDown', 'Home', 'End'].includes(e.key)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.recordCursorPosition();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  }

Â  Â  showWelcomeOrLastNote() {
Â  Â  Â  Â  const lastNoteId = localStorage.getItem('lifeHub_lastHtmlNoteId_v6.2.0');
Â  Â  Â  Â  if (this.notes.length > 0 && lastNoteId && this.notes.some(n => n.id === lastNoteId)) {
Â  Â  Â  Â  Â  Â  this.loadHtmlNoteIntoEditor(lastNoteId);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  this.displayWelcomeMessage();
Â  Â  Â  Â  }
Â  Â  }

Â  Â  switchTab(e) {
Â  Â  Â  Â  if (e.target.tagName !== 'BUTTON') return;
Â  Â  Â  Â  const tabName = e.target.dataset.tab;
Â  Â  Â  Â  if (this.activeTab === tabName) return;
Â  Â  Â  Â  this.dom.codeEditorTabs.querySelector('.active').classList.remove('active');
Â  Â  Â  Â  e.target.classList.add('active');
Â  Â  Â  Â  this.dom.codePanels.querySelectorAll('.code-panel').forEach(panel => {
Â  Â  Â  Â  Â  Â  panel.classList.toggle('hidden', panel.dataset.panel !== tabName);
Â  Â  Â  Â  });
Â  Â  Â  Â  this.activeTab = tabName;
Â  Â  }

Â  Â  displayWelcomeMessage() {
Â  Â  Â  Â  this.dom.welcomeMessage.classList.remove('hidden');
Â  Â  Â  Â  this.dom.htmlEditor.classList.add('hidden');
Â  Â  Â  Â  this.currentNoteId = null;
Â  Â  }

Â  Â  displayHtmlEditor() {
Â  Â  Â  Â  this.dom.welcomeMessage.classList.add('hidden');
Â  Â  Â  Â  this.dom.htmlEditor.classList.remove('hidden');
Â  Â  }

Â  Â  createNewHtmlNote() {
Â  Â  Â  Â  this.currentNoteId = `note_${Date.now()}`;
Â  Â  Â  Â  const newNote = {
Â  Â  Â  Â  Â  Â  id: this.currentNoteId,
Â  Â  Â  Â  Â  Â  title: 'Catatan HTML Baru',
Â  Â  Â  Â  Â  Â  html: `<h1>Halo Dunia!</h1>\n<p>Ini adalah editor HTML Anda.</p>`,
Â  Â  Â  Â  Â  Â  css: `body {\nÂ  Â  font-family: sans-serif;\nÂ  Â  padding: 20px;\nÂ  Â  background-color: #f0f0f0;\n}\nh1 {\nÂ  Â  color: #333;\n}`,
Â  Â  Â  Â  Â  Â  js: `console.log("Selamat datang di konsol JavaScript!");`,
Â  Â  Â  Â  Â  Â  lastEdited: new Date().toISOString()
Â  Â  Â  Â  };
Â  Â  Â  Â  this.notes.push(newNote);
Â  Â  Â  Â  this.saveNotesToStorage();
Â  Â  Â  Â  this.loadHtmlNoteIntoEditor(this.currentNoteId);
Â  Â  Â  Â  this.dom.htmlNoteTitle.focus();
Â  Â  Â  Â  this.dom.htmlNoteTitle.select();
Â  Â  }

Â  Â  loadHtmlNoteIntoEditor(noteId) {
Â  Â  Â  Â  const note = this.notes.find(n => n.id === noteId);
Â  Â  Â  Â  if (!note) {
Â  Â  Â  Â  Â  Â  showMessage('Error: Catatan tidak ditemukan.', 'error');
Â  Â  Â  Â  Â  Â  this.displayWelcomeMessage();
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  this.currentNoteId = note.id;
Â  Â  Â  Â  localStorage.setItem('lifeHub_lastHtmlNoteId_v6.2.0', note.id);
Â  Â  Â  Â  this.dom.htmlNoteTitle.value = note.title;
Â  Â  Â  Â  this.dom.htmlCode.value = note.html;
Â  Â  Â  Â  this.dom.cssCode.value = note.css;
Â  Â  Â  Â  this.dom.jsCode.value = note.js;
Â  Â  Â  Â  this.runCode();
Â  Â  Â  Â  this.displayHtmlEditor();
Â  Â  Â  Â  this.clearCursorHistory();
Â  Â  Â  Â  this.initializeHistory(note.id); // [BARU] Inisialisasi riwayat untuk catatan ini
Â  Â  Â  Â  this.renderHtmlNotesList();
Â  Â  }

Â  Â  runCode() {
Â  Â  Â  Â  const html = this.dom.htmlCode.value;
Â  Â  Â  Â  const css = this.dom.cssCode.value;
Â  Â  Â  Â  const js = this.dom.jsCode.value;
Â  Â  Â  Â  const jsWithErrorHandling = `
Â  Â  Â  Â  Â  Â  window.addEventListener('error', function(event) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Caught error from user code:', event.error);
Â  Â  Â  Â  Â  Â  Â  Â  let errorDiv = document.getElementById('runtime-error-overlay');
Â  Â  Â  Â  Â  Â  Â  Â  if (!errorDiv) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  errorDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  errorDiv.id = 'runtime-error-overlay';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Object.assign(errorDiv.style, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  position: 'fixed', top: '10px', left: '10px', padding: '10px',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: 'rgba(255, 0, 0, 0.8)', color: 'white',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fontFamily: 'monospace', zIndex: '9999', borderRadius: '5px',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maxWidth: 'calc(100% - 20px)'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.body.appendChild(errorDiv);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  errorDiv.innerText = 'JS Error: ' + event.message;
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { if (errorDiv) errorDiv.remove(); }, 5000);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  try { ${js} } catch (e) { console.error('Initial execution error:', e); }
Â  Â  Â  Â  `;
Â  Â  Â  Â  const combinedHtml = `<!DOCTYPE html><html><head><style>${css}</style></head><body>${html}<script>${jsWithErrorHandling}<\/script></body></html>`;
Â  Â  Â  Â  this.dom.htmlPreviewIframe.srcdoc = combinedHtml;
Â  Â  }

Â  Â  saveCurrentHtmlNote() {
Â  Â  Â  Â  if (!this.currentNoteId) {
Â  Â  Â  Â  Â  Â  this.createNewHtmlNote();
Â  Â  Â  Â  }
Â  Â  Â  Â  const title = this.dom.htmlNoteTitle.value.trim();
Â  Â  Â  Â  if (!title) {
Â  Â  Â  Â  Â  Â  showMessage('Judul catatan tidak boleh kosong.', 'error');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  const noteData = {
Â  Â  Â  Â  Â  Â  title: title,
Â  Â  Â  Â  Â  Â  html: this.dom.htmlCode.value,
Â  Â  Â  Â  Â  Â  css: this.dom.cssCode.value,
Â  Â  Â  Â  Â  Â  js: this.dom.jsCode.value,
Â  Â  Â  Â  Â  Â  lastEdited: new Date().toISOString()
Â  Â  Â  Â  };
Â  Â  Â  Â  const index = this.notes.findIndex(n => n.id === this.currentNoteId);
Â  Â  Â  Â  if (index !== -1) {
Â  Â  Â  Â  Â  Â  this.notes[index] = { ...this.notes[index], ...noteData };
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â // Ini seharusnya tidak terjadi jika createNewHtmlNote dipanggil
Â  Â  Â  Â  Â  Â  Â this.notes.push({ id: this.currentNoteId, ...noteData });
Â  Â  Â  Â  }
Â  Â  Â  Â  this.saveNotesToStorage();
Â  Â  Â  Â  this.renderHtmlNotesList();
Â  Â  Â  Â  showMessage(`Catatan "${title}" berhasil disimpan.`, 'success');
Â  Â  }

Â  Â  toggleExportMenu(e) {
Â  Â  Â  Â  e.stopPropagation();
Â  Â  Â  Â  if (!this.currentNoteId) {
Â  Â  Â  Â  Â  Â  showMessage('Simpan catatan terlebih dahulu sebelum mengekspor.', 'error');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  this.dom.exportMenu.classList.toggle('hidden');
Â  Â  }
Â  Â Â 
Â  Â  closeExportMenu(e) {
Â  Â  Â  Â  if (!this.dom.exportBtn.contains(e.target) && !this.dom.exportMenu.contains(e.target)) {
Â  Â  Â  Â  Â  Â  this.dom.exportMenu.classList.add('hidden');
Â  Â  Â  Â  }
Â  Â  }

Â  Â  exportToHtmlFile() {
Â  Â  Â  Â  if (!this.currentNoteId) { showMessage('Tidak ada catatan untuk diekspor.', 'error'); return; }
Â  Â  Â  Â  const note = this.notes.find(n => n.id === this.currentNoteId);
Â  Â  Â  Â  const combinedHtml = `<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>${note.title}</title><style>${note.css}</style></head><body>${note.html}<script>${note.js}<\/script></body></html>`;
Â  Â  Â  Â  const blob = new Blob([combinedHtml], { type: 'text/html' });
Â  Â  Â  Â  const url = URL.createObjectURL(blob);
Â  Â  Â  Â  const a = document.createElement('a');
Â  Â  Â  Â  a.href = url;
Â  Â  Â  Â  a.download = `${note.title.replace(/\s+/g, '_') || 'catatan'}.html`;
Â  Â  Â  Â  document.body.appendChild(a);
Â  Â  Â  Â  a.click();
Â  Â  Â  Â  document.body.removeChild(a);
Â  Â  Â  Â  URL.revokeObjectURL(url);
Â  Â  Â  Â  showMessage('File .html berhasil diekspor.', 'success');
Â  Â  }

Â  Â  exportPreviewToPdfFile() {
Â  Â  Â  Â  if (!this.currentNoteId) { showMessage('Tidak ada catatan untuk diekspor.', 'error'); return; }
Â  Â  Â  Â  showMessage('Mempersiapkan PDF dari pratinjau...', 'info');
Â  Â  Â  Â  const iframe = this.dom.htmlPreviewIframe;
Â  Â  Â  Â  const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
Â  Â  Â  Â  html2canvas(iframeDoc.body, { useCORS: true, scale: 2 }).then(canvas => {
Â  Â  Â  Â  Â  Â  const imgData = canvas.toDataURL('image/png');
Â  Â  Â  Â  Â  Â  const { jsPDF } = window.jspdf;
Â  Â  Â  Â  Â  Â  const doc = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
Â  Â  Â  Â  Â  Â  const imgProps = doc.getImageProperties(imgData);
Â  Â  Â  Â  Â  Â  const pdfWidth = doc.internal.pageSize.getWidth();
Â  Â  Â  Â  Â  Â  const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
Â  Â  Â  Â  Â  Â  doc.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
Â  Â  Â  Â  Â  Â  const note = this.notes.find(n => n.id === this.currentNoteId);
Â  Â  Â  Â  Â  Â  doc.save(`${note.title.replace(/\s+/g, '_') || 'catatan'}_pratinjau.pdf`);
Â  Â  Â  Â  Â  Â  showMessage('File PDF dari pratinjau berhasil diekspor.', 'success');
Â  Â  Â  Â  }).catch(err => {
Â  Â  Â  Â  Â  Â  console.error("Gagal membuat PDF:", err);
Â  Â  Â  Â  Â  Â  showMessage('Gagal membuat PDF. Lihat konsol untuk error.', 'error');
Â  Â  Â  Â  });
Â  Â  }

Â  Â  exportCodeToPdfFile() {
Â  Â  Â  Â  if (!this.currentNoteId) { showMessage('Tidak ada catatan untuk diekspor.', 'error'); return; }
Â  Â  Â  Â  const note = this.notes.find(n => n.id === this.currentNoteId);
Â  Â  Â  Â  const { jsPDF } = window.jspdf;
Â  Â  Â  Â  const doc = new jsPDF();
Â  Â  Â  Â  let y = 15;
Â  Â  Â  Â  const margin = 10;
Â  Â  Â  Â  const maxWidth = doc.internal.pageSize.getWidth() - margin * 2;

Â  Â  Â  Â  doc.setFontSize(16);
Â  Â  Â  Â  doc.text(note.title, margin, y);
Â  Â  Â  Â  y += 10;

Â  Â  Â  Â  const addCodeSection = (title, code) => {
Â  Â  Â  Â  Â  Â  if (y > 270) { doc.addPage(); y = 15; }
Â  Â  Â  Â  Â  Â  doc.setFontSize(12);
Â  Â  Â  Â  Â  Â  doc.setFont('helvetica', 'bold');
Â  Â  Â  Â  Â  Â  doc.text(title, margin, y);
Â  Â  Â  Â  Â  Â  y += 7;
Â  Â  Â  Â  Â  Â  doc.setFontSize(8);
Â  Â  Â  Â  Â  Â  doc.setFont('courier', 'normal');
Â  Â  Â  Â  Â  Â  const lines = doc.splitTextToSize(code, maxWidth);
Â  Â  Â  Â  Â  Â  lines.forEach(line => {
Â  Â  Â  Â  Â  Â  Â  Â  if (y > 280) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  doc.addPage();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  y = 15;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  doc.text(line, margin, y);
Â  Â  Â  Â  Â  Â  Â  Â  y += 4;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  y += 5;
Â  Â  Â  Â  };

Â  Â  Â  Â  if (note.html) addCodeSection('HTML', note.html);
Â  Â  Â  Â  if (note.css) addCodeSection('CSS', note.css);
Â  Â  Â  Â  if (note.js) addCodeSection('JavaScript', note.js);

Â  Â  Â  Â  doc.save(`${note.title.replace(/\s+/g, '_') || 'catatan'}_kode.pdf`);
Â  Â  Â  Â  showMessage('File PDF dari kode berhasil diekspor.', 'success');
Â  Â  }

Â  Â  saveNotesToStorage() {
Â  Â  Â  Â  localStorage.setItem('lifeHub_htmlNotes_v6.2.0', JSON.stringify(this.notes));
Â  Â  }

Â  Â  loadNotesFromStorage() {
Â  Â  Â  Â  const savedNotes = localStorage.getItem('lifeHub_htmlNotes_v6.2.0');
Â  Â  Â  Â  if (savedNotes) {
Â  Â  Â  Â  Â  Â  this.notes = JSON.parse(savedNotes);
Â  Â  Â  Â  Â  Â  this.renderHtmlNotesList();
Â  Â  Â  Â  }
Â  Â  }

renderHtmlNotesList() {
Â  Â  Â  Â  const searchQuery = this.dom.searchHtmlNotesInput.value.toLowerCase();
Â  Â  Â  Â  const filteredNotes = this.notes.filter(note => note.title.toLowerCase().includes(searchQuery));
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (filteredNotes.length === 0) {
Â  Â  Â  Â  Â  Â  this.dom.htmlNotesList.innerHTML = '<p class="text-center text-gray-500">Tidak ada catatan yang cocok.</p>';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  this.dom.htmlNotesList.innerHTML = filteredNotes
Â  Â  Â  Â  Â  Â  .sort((a, b) => new Date(b.lastEdited) - new Date(a.lastEdited))
Â  Â  Â  Â  Â  Â  .map(note => `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="html-note-item p-3 rounded-lg cursor-pointer ${note.id === this.currentNoteId ? 'active' : ''}" data-id="${note.id}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-start">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong class="text-md text-purple-300">${note.title}</strong>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="block text-xs text-gray-400">${new Date(note.lastEdited).toLocaleString('id-ID')}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="delete-html-note-btn text-red-500 hover:text-red-400 text-xs" data-id="${note.id}" title="Hapus Catatan">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-trash"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `).join('');
Â  Â  Â  Â  this.dom.htmlNotesList.querySelectorAll('.html-note-item').forEach(item => {
Â  Â  Â  Â  Â  Â  item.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (e.target.closest('.delete-html-note-btn')) return;
Â  Â  Â  Â  Â  Â  Â  Â  this.loadHtmlNoteIntoEditor(item.dataset.id);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  Â  Â  this.dom.htmlNotesList.querySelectorAll('.delete-html-note-btn').forEach(btn => {
Â  Â  Â  Â  Â  Â  btn.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation();
Â  Â  Â  Â  Â  Â  Â  Â  this.deleteHtmlNote(btn.dataset.id);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  }

Â  Â  deleteHtmlNote(noteId) {
Â  Â  Â  Â  const noteToDelete = this.notes.find(n => n.id === noteId);
Â  Â  Â  Â  if (!noteToDelete) return;
Â  Â  Â  Â  showConfirm(`Hapus Catatan HTML?`, `Yakin ingin menghapus "${noteToDelete.title}"?`, () => {
Â  Â  Â  Â  Â  Â  this.notes = this.notes.filter(note => note.id !== noteId);
Â  Â  Â  Â  Â  Â  this.saveNotesToStorage();
Â  Â  Â  Â  Â  Â  this.renderHtmlNotesList();
Â  Â  Â  Â  Â  Â  if (this.currentNoteId === noteId) {
Â  Â  Â  Â  Â  Â  Â  Â  this.currentNoteId = null;
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.removeItem('lifeHub_lastHtmlNoteId_v6.2.0');
Â  Â  Â  Â  Â  Â  Â  Â  this.displayWelcomeMessage();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  showMessage('Catatan HTML berhasil dihapus.', 'success');
Â  Â  Â  Â  });
Â  Â  }

Â  Â  toggleFullscreen() {
Â  Â  Â  Â  const elem = this.dom.previewPanel;
Â  Â  Â  Â  if (!document.fullscreenElement) {
Â  Â  Â  Â  Â  Â  elem.requestFullscreen().catch(err => {
Â  Â  Â  Â  Â  Â  Â  Â  alert(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  this.dom.fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i>';
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  document.exitFullscreen();
Â  Â  Â  Â  Â  Â  this.dom.fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i>';
Â  Â  Â  Â  }
Â  Â  }

Â  Â  toggleAutoRefresh(isEnabled) {
Â  Â  Â  Â  this.autoRefreshEnabled = isEnabled;
Â  Â  Â  Â  if (isEnabled) {
Â  Â  Â  Â  Â  Â  this.runCode();
Â  Â  Â  Â  Â  Â  showMessage('Auto-refresh diaktifkan.', 'success');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  showMessage('Auto-refresh dinonaktifkan.', 'info');
Â  Â  Â  Â  }
Â  Â  }

Â  Â  handleEditorInput() {
Â  Â  Â  Â  if (this.autoRefreshEnabled) {
Â  Â  Â  Â  Â  Â  clearTimeout(this.debounceTimeout);
Â  Â  Â  Â  Â  Â  this.debounceTimeout = setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  this.runCode();
Â  Â  Â  Â  Â  Â  }, 500); // 500ms debounce
Â  Â  Â  Â  }
Â  Â  Â  Â  this.recordHistory();
Â  Â  Â  Â  this.recordCursorPosition();
Â  Â  }

Â  Â  getActiveEditor() {
Â  Â  Â  Â  return this.dom.codePanels.querySelector(`.code-panel:not(.hidden) textarea`);
Â  Â  }

Â  Â  // [BARU] Fungsi untuk Undo/Redo
Â  Â  initializeHistory(noteId) {
Â  Â  Â  Â  if (!this.history[noteId]) {
Â  Â  Â  Â  Â  Â  const initial_state = {
Â  Â  Â  Â  Â  Â  Â  Â  html: this.dom.htmlCode.value,
Â  Â  Â  Â  Â  Â  Â  Â  css: this.dom.cssCode.value,
Â  Â  Â  Â  Â  Â  Â  Â  js: this.dom.jsCode.value,
Â  Â  Â  Â  Â  Â  Â  Â  activeTab: this.activeTab,
Â  Â  Â  Â  Â  Â  Â  Â  cursor: this.getActiveEditor().selectionStart
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  this.history[noteId] = {
Â  Â  Â  Â  Â  Â  Â  Â  stack: [initial_state],
Â  Â  Â  Â  Â  Â  Â  Â  index: 0
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  }
Â  Â  Â  Â  this.updateUndoRedoButtons();
Â  Â  }

Â  Â  recordHistory() {
Â  Â  Â  Â  if (this.isNavigatingHistory || !this.currentNoteId) return;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const noteHistory = this.history[this.currentNoteId];
Â  Â  Â  Â  if (!noteHistory) return;

Â  Â  Â  Â  const currentState = {
Â  Â  Â  Â  Â  Â  html: this.dom.htmlCode.value,
Â  Â  Â  Â  Â  Â  css: this.dom.cssCode.value,
Â  Â  Â  Â  Â  Â  js: this.dom.jsCode.value,
Â  Â  Â  Â  Â  Â  activeTab: this.activeTab,
Â  Â  Â  Â  Â  Â  cursor: this.getActiveEditor().selectionStart
Â  Â  Â  Â  };

Â  Â  Â  Â  // Hapus riwayat "masa depan" jika ada perubahan baru
Â  Â  Â  Â  if (noteHistory.index < noteHistory.stack.length - 1) {
Â  Â  Â  Â  Â  Â  noteHistory.stack = noteHistory.stack.slice(0, noteHistory.index + 1);
Â  Â  Â  Â  }

Â  Â  Â  Â  // Hindari duplikasi state yang sama persis
Â  Â  Â  Â  const lastState = noteHistory.stack[noteHistory.stack.length - 1];
Â  Â  Â  Â  if (lastState && lastState.html === currentState.html && lastState.css === currentState.css && lastState.js === currentState.js) {
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  noteHistory.stack.push(currentState);
Â  Â  Â  Â  noteHistory.index = noteHistory.stack.length - 1;

Â  Â  Â  Â  this.updateUndoRedoButtons();
Â  Â  }

Â  Â  applyHistoryState(state) {
Â  Â  Â  Â  this.isNavigatingHistory = true;
Â  Â  Â  Â  this.dom.htmlCode.value = state.html;
Â  Â  Â  Â  this.dom.cssCode.value = state.css;
Â  Â  Â  Â  this.dom.jsCode.value = state.js;

Â  Â  Â  Â  if (this.activeTab !== state.activeTab) {
Â  Â  Â  Â  Â  Â  this.dom.codeEditorTabs.querySelector(`[data-tab="${state.activeTab}"]`).click();
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  const editor = this.getActiveEditor();
Â  Â  Â  Â  Â  Â  editor.focus();
Â  Â  Â  Â  Â  Â  editor.setSelectionRange(state.cursor, state.cursor);
Â  Â  Â  Â  Â  Â  this.isNavigatingHistory = false;
Â  Â  Â  Â  }, 0);
Â  Â  }

Â  Â  undo() {
Â  Â  Â  Â  if (!this.currentNoteId) return;
Â  Â  Â  Â  const noteHistory = this.history[this.currentNoteId];
Â  Â  Â  Â  if (noteHistory && noteHistory.index > 0) {
Â  Â  Â  Â  Â  Â  noteHistory.index--;
Â  Â  Â  Â  Â  Â  this.applyHistoryState(noteHistory.stack[noteHistory.index]);
Â  Â  Â  Â  Â  Â  this.updateUndoRedoButtons();
Â  Â  Â  Â  }
Â  Â  }

Â  Â  redo() {
Â  Â  Â  Â  if (!this.currentNoteId) return;
Â  Â  Â  Â  const noteHistory = this.history[this.currentNoteId];
Â  Â  Â  Â  if (noteHistory && noteHistory.index < noteHistory.stack.length - 1) {
Â  Â  Â  Â  Â  Â  noteHistory.index++;
Â  Â  Â  Â  Â  Â  this.applyHistoryState(noteHistory.stack[noteHistory.index]);
Â  Â  Â  Â  Â  Â  this.updateUndoRedoButtons();
Â  Â  Â  Â  }
Â  Â  }

Â  Â  updateUndoRedoButtons() {
Â  Â  Â  Â  if (!this.currentNoteId) {
Â  Â  Â  Â  Â  Â  this.dom.undoBtn.disabled = true;
Â  Â  Â  Â  Â  Â  this.dom.redoBtn.disabled = true;
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  const noteHistory = this.history[this.currentNoteId];
Â  Â  Â  Â  this.dom.undoBtn.disabled = !noteHistory || noteHistory.index <= 0;
Â  Â  Â  Â  this.dom.redoBtn.disabled = !noteHistory || noteHistory.index >= noteHistory.stack.length - 1;
Â  Â  }

Â  Â  recordCursorPosition() {
Â  Â  Â  Â  if (this.isNavigatingCursorHistory) return;
Â  Â  Â  Â  const editor = this.getActiveEditor();
Â  Â  Â  Â  const position = {
Â  Â  Â  Â  Â  Â  tab: this.activeTab,
Â  Â  Â  Â  Â  Â  pos: editor.selectionStart
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (this.currentCursorIndex < this.cursorHistory.length - 1) {
Â  Â  Â  Â  Â  Â  this.cursorHistory = this.cursorHistory.slice(0, this.currentCursorIndex + 1);
Â  Â  Â  Â  }

Â  Â  Â  Â  const lastPos = this.cursorHistory[this.cursorHistory.length - 1];
Â  Â  Â  Â  if (!lastPos || lastPos.tab !== position.tab || lastPos.pos !== position.pos) {
Â  Â  Â  Â  Â  Â  this.cursorHistory.push(position);
Â  Â  Â  Â  Â  Â  this.currentCursorIndex = this.cursorHistory.length - 1;
Â  Â  Â  Â  }
Â  Â  Â  Â  this.updateCursorNavButtons();
Â  Â  }

Â  Â  navigateCursorHistory(forward) {
Â  Â  Â  Â  if (forward) {
Â  Â  Â  Â  Â  Â  if (this.currentCursorIndex < this.cursorHistory.length - 1) {
Â  Â  Â  Â  Â  Â  Â  Â  this.currentCursorIndex++;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  if (this.currentCursorIndex > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  this.currentCursorIndex--;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  const position = this.cursorHistory[this.currentCursorIndex];
Â  Â  Â  Â  if (position) {
Â  Â  Â  Â  Â  Â  this.isNavigatingCursorHistory = true;
Â  Â  Â  Â  Â  Â  if (this.activeTab !== position.tab) {
Â  Â  Â  Â  Â  Â  Â  Â  this.dom.codeEditorTabs.querySelector(`[data-tab="${position.tab}"]`).click();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  const editor = this.getActiveEditor();
Â  Â  Â  Â  Â  Â  Â  Â  editor.focus();
Â  Â  Â  Â  Â  Â  Â  Â  editor.setSelectionRange(position.pos, position.pos);
Â  Â  Â  Â  Â  Â  Â  Â  this.isNavigatingCursorHistory = false;
Â  Â  Â  Â  Â  Â  }, 0);
Â  Â  Â  Â  }
Â  Â  Â  Â  this.updateCursorNavButtons();
Â  Â  }

Â  Â  clearCursorHistory() {
Â  Â  Â  Â  this.cursorHistory = [];
Â  Â  Â  Â  this.currentCursorIndex = -1;
Â  Â  Â  Â  this.updateCursorNavButtons();
Â  Â  }

Â  Â  updateCursorNavButtons() {
Â  Â  Â  Â  this.dom.cursorPrevBtn.disabled = this.currentCursorIndex <= 0;
Â  Â  Â  Â  this.dom.cursorNextBtn.disabled = this.currentCursorIndex >= this.cursorHistory.length - 1;
Â  Â  }

Â  Â  toggleSearchView() {
Â  Â  Â  Â  const wrapper = this.dom.searchWrapper;
Â  Â  Â  Â  const isVisible = wrapper.style.display === 'block';
Â  Â  Â  Â  wrapper.style.display = isVisible ? 'none' : 'block';
Â  Â  Â  Â  if (!isVisible) {
Â  Â  Â  Â  Â  Â  this.dom.searchInput.focus();
Â  Â  Â  Â  }
Â  Â  }
}

// --- WATERMARK SCRIPT START ---
(function() {
Â  Â  function initializeWatermark() {
Â  Â  Â  Â  const watermarkHTML = `
Â  Â  Â  Â  Â  <div id="futuristic-watermark" title="Design by Â©URANUSFAZRY">
Â  Â  Â  Â  Â  Â  <canvas id="particle-canvas"></canvas>
Â  Â  Â  Â  Â  Â  <div class="f-content-wrapper">
Â  Â  Â  Â  Â  Â  Â  <div id="f-main-content" class="f-content">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="f-logo-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <path d="M20 20 L80 20 L80 80 L20 80 Z" stroke-opacity="0.5"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <path d="M50 5 L95 50 L50 95 L5 50 Z"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </svg>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <span id="f-watermark-text">Â©URANUSFAZRY</span>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div id="f-follow-content" class="f-content hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="f-follow-message"></span>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  Â  document.body.insertAdjacentHTML('beforeend', watermarkHTML);

Â  Â  Â  Â  const watermarkEl = document.getElementById('futuristic-watermark');
Â  Â  Â  Â  const textEl = document.getElementById('f-watermark-text');
Â  Â  Â  Â  const logoEl = watermarkEl.querySelector('.f-logo-container');
Â  Â  Â  Â  const mainContentEl = document.getElementById('f-main-content');
Â  Â  Â  Â  const followContentEl = document.getElementById('f-follow-content');
Â  Â  Â  Â  const followMessageEl = document.getElementById('f-follow-message');
Â  Â  Â  Â Â 
Â  Â  Â  Â  let isAnimating = false;
Â  Â  Â  Â  let autoPlayInterval = null;
Â  Â  Â  Â  let currentSequence = 0;
Â  Â  Â  Â  const sequenceActions = ['scramble', 'logo', 'youtube', 'tiktok', 'reset'];

Â  Â  Â  Â  const canvas = document.getElementById('particle-canvas');
Â  Â  Â  Â  const ctx = canvas.getContext('2d');
Â  Â  Â  Â  let particles = [];
Â  Â  Â  Â  const resizeCanvas = () => { if (watermarkEl) { canvas.width = watermarkEl.offsetWidth; canvas.height = watermarkEl.offsetHeight; } };
Â  Â  Â  Â  class Particle {
Â  Â  Â  Â  Â  Â  constructor() { this.reset(); this.baseSpeedX = (Math.random() - 0.5) * 0.5; this.baseSpeedY = (Math.random() - 0.5) * 0.5; this.speedX = this.baseSpeedX; this.speedY = this.baseSpeedY; }
Â  Â  Â  Â  Â  Â  update() {
Â  Â  Â  Â  Â  Â  Â  Â  this.x += this.speedX; this.y += this.speedY; this.opacity -= this.fadeSpeed;
Â  Â  Â  Â  Â  Â  Â  Â  if (this.opacity <= 0 || this.x < 0 || this.x > canvas.width || this.y < 0 || this.y > canvas.height) { this.reset(); }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  draw() {
Â  Â  Â  Â  Â  Â  Â  Â  const style = getComputedStyle(watermarkEl);
Â  Â  Â  Â  Â  Â  Â  Â  const hue = style.getPropertyValue('--particle-base-hue').trim();
Â  Â  Â  Â  Â  Â  Â  Â  const lightness = parseFloat(style.getPropertyValue('--particle-base-lightness').trim());
Â  Â  Â  Â  Â  Â  Â  Â  ctx.globalAlpha = this.opacity;
Â  Â  Â  Â  Â  Â  Â  Â  ctx.fillStyle = `hsl(${hue}, 100%, ${lightness + this.opacity * 40}%)`;
Â  Â  Â  Â  Â  Â  Â  Â  ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  reset() { this.x = Math.random() * canvas.width; this.y = Math.random() * canvas.height; this.opacity = Math.random() * 0.5 + 0.2; this.size = Math.random() * 1.5 + 0.5; this.fadeSpeed = Math.random() * 0.015 + 0.005; }
Â  Â  Â  Â  }
Â  Â  Â  Â  const animateParticles = () => { ctx.clearRect(0, 0, canvas.width, canvas.height); particles.forEach(p => { p.update(); p.draw(); }); ctx.globalAlpha = 1.0; requestAnimationFrame(animateParticles); };
Â  Â  Â  Â Â 
Â  Â  Â  Â  const textScramble = (el) => {
Â  Â  Â  Â  Â  Â  const originalText = "Â©URANUSFAZRY";
Â  Â  Â  Â  Â  Â  const chars = '!<>*#{}[]'; let frame = 0; isAnimating = true;
Â  Â  Â  Â  Â  Â  const interval = setInterval(() => {
Â  Â  Â  Â  Â  Â  Â  Â  el.innerText = originalText.split('').map((char, i) => { const p = (frame - i * 2) / 15; if (p < 0) return ' '; if (p > 1) return char; return chars[Math.floor(Math.random() * chars.length)]; }).join('');
Â  Â  Â  Â  Â  Â  Â  Â  if (frame >= originalText.length * 2 + 15) { clearInterval(interval); el.innerText = originalText; isAnimating = false; } frame++;
Â  Â  Â  Â  Â  Â  }, 30);
Â  Â  Â  Â  };

Â  Â  Â  Â  const typewriter = (el, text) => {
Â  Â  Â  Â  Â  Â  let i = 0; el.innerHTML = ""; isAnimating = true;
Â  Â  Â  Â  Â  Â  const interval = setInterval(() => {
Â  Â  Â  Â  Â  Â  Â  Â  if (i < text.length) { el.innerHTML += text.charAt(i); i++; }Â 
Â  Â  Â  Â  Â  Â  Â  Â  else { clearInterval(interval); isAnimating = false; }
Â  Â  Â  Â  Â  Â  }, 50);
Â  Â  Â  Â  };

Â  Â  Â  Â  const runAutoSequence = () => {
Â  Â  Â  Â  Â  Â  if (isAnimating) return;
Â  Â  Â  Â  Â  Â  const action = sequenceActions[currentSequence];
Â  Â  Â  Â  Â  Â  switch (action) {
Â  Â  Â  Â  Â  Â  Â  Â  case 'scramble': textScramble(textEl); break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'logo':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isAnimating = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  logoEl.classList.add('reacting');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  logoEl.addEventListener('animationend', () => { logoEl.classList.remove('reacting'); isAnimating = false; }, { once: true });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'youtube':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isAnimating = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mainContentEl.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  followContentEl.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  typewriter(followMessageEl, "Follow uranusfazry YouTube");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 400);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'tiktok':Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  typewriter(followMessageEl, "Follow uranusfazry TikTok");Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'reset':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isAnimating = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  followContentEl.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mainContentEl.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isAnimating = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 400);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  currentSequence = (currentSequence + 1) % sequenceActions.length;
Â  Â  Â  Â  };

Â  Â  Â  Â  const startAutoPlay = () => {
Â  Â  Â  Â  Â  Â  if (autoPlayInterval) clearInterval(autoPlayInterval);
Â  Â  Â  Â  Â  Â  runAutoSequence();
Â  Â  Â  Â  Â  Â  autoPlayInterval = setInterval(runAutoSequence, 3500);
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Sync watermark theme with main theme
Â  Â  Â  Â  const syncTheme = () => {
Â  Â  Â  Â  Â  Â  if (document.body.classList.contains('light-mode')) {
Â  Â  Â  Â  Â  Â  Â  Â  watermarkEl.classList.add('light-mode');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  watermarkEl.classList.remove('light-mode');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Observe body class changes to sync theme
Â  Â  Â  Â  const observer = new MutationObserver(syncTheme);
Â  Â  Â  Â  observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });

Â  Â  Â  Â  const init = () => {
Â  Â  Â  Â  Â  Â  resizeCanvas();
Â  Â  Â  Â  Â  Â  for (let i = 0; i < 40; i++) particles.push(new Particle());
Â  Â  Â  Â  Â  Â  animateParticles();
Â  Â  Â  Â  Â  Â  window.addEventListener('resize', resizeCanvas);
Â  Â  Â  Â  Â  Â  startAutoPlay();
Â  Â  Â  Â  Â  Â  syncTheme(); // Initial sync
Â  Â  Â  Â  };
Â  Â  Â  Â  init();
Â  Â  }

Â  Â  if (document.readyState === 'loading') {
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', initializeWatermark);
Â  Â  } else {
Â  Â  Â  Â  initializeWatermark();
Â  Â  }
})();
// --- WATERMARK SCRIPT END ---
</script>
</body>
</html>
